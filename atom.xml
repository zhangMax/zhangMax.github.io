<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Wonkey Zhang</title>
  <icon>https://www.gravatar.com/avatar/52f4c6aa1dd1284f9fdf1f9ff8036d97</icon>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://wonkeyz.com/"/>
  <updated>2017-11-07T08:26:58.343Z</updated>
  <id>http://wonkeyz.com/</id>
  
  <author>
    <name>Wonkey Zhang</name>
    <email>zhangQiangView@163.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>适配iOS11&amp;iPhoneX的一些坑</title>
    <link href="http://wonkeyz.com/2017/09/17/%E9%80%82%E9%85%8DiOS11-iPhoneX%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/"/>
    <id>http://wonkeyz.com/2017/09/17/适配iOS11-iPhoneX的一些坑/</id>
    <published>2017-09-17T08:09:08.000Z</published>
    <updated>2017-11-07T08:26:58.343Z</updated>
    
    <content type="html"><![CDATA[<p>前阵子项目开发忙成狗，就一直没做iOS11的适配，直到XcodeGM版发布后，我胸有成竹的在iPhoneX上跑起项目，整个人都凉透了…下面总结一下我遇到的坑，不是很全面，日后补充。</p><a id="more"></a><h3 id="导航栏"><a href="#导航栏" class="headerlink" title="导航栏"></a>导航栏</h3><h4 id="导航栏高度的变化"><a href="#导航栏高度的变化" class="headerlink" title="导航栏高度的变化"></a>导航栏高度的变化</h4><p>iOS11之前导航栏默认高度为64pt(<strong>这里高度指statusBar + NavigationBar</strong>)，iOS11之后如果设置了<code>prefersLargeTitles = YES</code>则为96pt，默认情况下还是64pt，但在iPhoneX上由于刘海的出现statusBar由以前的20pt变成了44pt，所以iPhoneX上高度变为88pt，如果项目里隐藏了导航栏加了自定义按钮之类的，这里需要注意适配一下。</p><h4 id="导航栏图层及对titleView布局的影响"><a href="#导航栏图层及对titleView布局的影响" class="headerlink" title="导航栏图层及对titleView布局的影响"></a>导航栏图层及对titleView布局的影响</h4><p>iOS11之前导航栏的title是添加在<code>UINavigationItemView</code>上面，而navigationBarButton则直接添加在<code>UINavigationBar</code>上面，如果设置了titleView，则titleView也是直接添加在<code>UINavigationBar</code>上面。iOS11之后，大概因为<code>largeTitle</code>的原因，视图层级发生了变化，如果没有给titleView赋值，则titleView会直接添加在<code>_UINavigationBarContentView</code>上面，如果赋值了titleView，则会把titleView添加在<code>_UITAMICAdaptorView</code>上，而navigationBarButton被加在了<code>_UIButtonBarStackView</code>上，然后他们都被加在了<code>_UINavigationBarContentView</code>上，如图：<br><img src="http://upload-images.jianshu.io/upload_images/702870-11488fe68c9d145b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图1"><br>所以如果你的项目是自定义的navigationBar，那么在iOS11上运行就可能出现布局错乱的bug，解决办法是重写<code>UINavigationBar</code>的<code>layoutSubviews</code>方法，调整布局，上代码：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)layoutSubviews &#123;</div><div class="line">    [<span class="keyword">super</span> layoutSubviews];</div><div class="line"></div><div class="line">    <span class="comment">//注意导航栏及状态栏高度适配</span></div><div class="line">    <span class="keyword">self</span>.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="built_in">CGRectGetWidth</span>(<span class="keyword">self</span>.frame), naviBarHeight);</div><div class="line">    <span class="keyword">for</span> (<span class="built_in">UIView</span> *view <span class="keyword">in</span> <span class="keyword">self</span>.subviews) &#123;</div><div class="line">        <span class="keyword">if</span>([<span class="built_in">NSStringFromClass</span>([view <span class="keyword">class</span>]) containsString:<span class="string">@"Background"</span>]) &#123;</div><div class="line">            view.frame = <span class="keyword">self</span>.bounds;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ([<span class="built_in">NSStringFromClass</span>([view <span class="keyword">class</span>]) containsString:<span class="string">@"ContentView"</span>]) &#123;</div><div class="line">            <span class="built_in">CGRect</span> frame = view.frame;</div><div class="line">            frame.origin.y = statusBarHeight;</div><div class="line">            frame.size.height = <span class="keyword">self</span>.bounds.size.height - frame.origin.y;</div><div class="line">            view.frame = frame;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>再补充一点，看了<a href="http://www.jianshu.com/p/26fc39135c34" target="_blank" rel="external">简书App适配iOS11</a>发现titleView支持<code>autolayout</code>，这要求titleView必须是能够自撑开的或实现了<code>- intrinsicContentSize</code>方法<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">CGSize</span>)intrinsicContentSize &#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">UILayoutFittingExpandedSize</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><h3 id="继承自UIScrollView的视图偏移问题"><a href="#继承自UIScrollView的视图偏移问题" class="headerlink" title="继承自UIScrollView的视图偏移问题"></a>继承自UIScrollView的视图偏移问题</h3><p>大家在iOS11设备上运行出现最多问题应该就是<code>tableview</code>莫名奇妙的偏移20pt或者64pt了。。原因是iOS11弃用了<code>automaticallyAdjustsScrollViewInsets</code>属性，取而代之的是<code>UIScrollView</code>新增了<code>contentInsetAdjustmentBehavior</code>属性，这一切的罪魁祸首都是新引入的<code>safeArea</code>，关于<code>safeArea</code>适配这篇文章<a href="http://www.jianshu.com/p/efbc8619d56b" target="_blank" rel="external">iOS 11 安全区域适配总结</a>讲的很详细，感兴趣的可以看下，我直接贴适配代码，因为低版本直接用<code>contentInsetAdjustmentBehavior</code>会报警告，所有定义了如下的宏（感谢<a href="http://www.jianshu.com/u/634f3d1c7c22" target="_blank" rel="external">@炒鸡范</a>的指正，之前的宏犯了个低级错误…现改为）<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#define  adjustsScrollViewInsets(scrollView)\</span></div><div class="line"><span class="keyword">do</span> &#123;\</div><div class="line">_Pragma(<span class="string">"clang diagnostic push"</span>)\</div><div class="line">_Pragma(<span class="string">"clang diagnostic ignored \"-Warc-performSelector-leaks\""</span>)\</div><div class="line"><span class="keyword">if</span> ([scrollView respondsToSelector:<span class="built_in">NSSelectorFromString</span>(<span class="string">@"setContentInsetAdjustmentBehavior:"</span>)]) &#123;\</div><div class="line"><span class="built_in">NSMethodSignature</span> *signature = [<span class="built_in">UIScrollView</span> instanceMethodSignatureForSelector:<span class="keyword">@selector</span>(setContentInsetAdjustmentBehavior:)];\</div><div class="line"><span class="built_in">NSInvocation</span> *invocation = [<span class="built_in">NSInvocation</span> invocationWithMethodSignature:signature];\</div><div class="line"><span class="built_in">NSInteger</span> argument = <span class="number">2</span>;\</div><div class="line">invocation.target = scrollView;\</div><div class="line">invocation.selector = <span class="keyword">@selector</span>(setContentInsetAdjustmentBehavior:);\</div><div class="line">[invocation setArgument:&amp;argument atIndex:<span class="number">2</span>];\</div><div class="line">[invocation retainArguments];\</div><div class="line">[invocation invoke];\</div><div class="line">&#125;\</div><div class="line">_Pragma(<span class="string">"clang diagnostic pop"</span>)\</div><div class="line">&#125; <span class="keyword">while</span> (<span class="number">0</span>)</div></pre></td></tr></table></figure></p><p>还有的发现某些界面<code>tableView</code>的<code>sectionHeader</code>、<code>sectionFooter</code>高度与设置不符的问题，在iOS11中如果不实现 <code>-tableView: viewForHeaderInSection:</code>和<code>-tableView: viewForFooterInSection:</code> ，则<code>-tableView: heightForHeaderInSection:</code>和<code>- tableView: heightForFooterInSection:</code>不会被调用，导致它们都变成了默认高度，这是因为<code>tableView</code>在iOS11默认使用<code>Self-Sizing</code>，<code>tableView</code>的<code>estimatedRowHeight</code>、<code>estimatedSectionHeaderHeight</code>、 <code>estimatedSectionFooterHeight</code>三个高度估算属性由默认的0变成了<code>UITableViewAutomaticDimension</code>，解决办法简单粗暴，就是在对应界面实现对应方法或把<code>tableView</code>的这三个属性设为0。如果你想全局关闭<code>Self-Sizing</code>可使用下面这段代码：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">UITableView</span>.appearance.estimatedRowHeight = <span class="number">0</span>; </div><div class="line"><span class="built_in">UITableView</span>.appearance.estimatedSectionFooterHeight = <span class="number">0</span>;</div><div class="line"><span class="built_in">UITableView</span>.appearance.estimatedSectionHeaderHeight = <span class="number">0</span>;</div></pre></td></tr></table></figure></p><p>如果你使用了<code>Masonry</code>，某些界面需要适配需要适配<code>safeArea</code>，可以试试下面这段代码<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (@available(iOS <span class="number">11.0</span>, *)) &#123;</div><div class="line">    make.edges.equalTo()(<span class="keyword">self</span>.view.safeAreaInsets)</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    make.edges.equalTo()(<span class="keyword">self</span>.view)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><h3 id="相册访问权限"><a href="#相册访问权限" class="headerlink" title="相册访问权限"></a>相册访问权限</h3><p>看其他适配文章上对iOS11相册权限调整的说明是“iOS11把 <a href="https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html#//apple_ref/doc/uid/TP40009251-SW17" target="_blank" rel="external">NSPhotoLibraryUsageDescription</a> 替换成了<a href="https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html#//apple_ref/doc/uid/TP40009251-SW73" target="_blank" rel="external">NSPhotoLibraryAddUsageDescription</a>”，奇怪的是我的项目并没有添加<code>NSPhotoLibraryAddUsageDescription</code>，在访问相册时也没发生crash，后来在仔细阅读了官方文档才发现<code>NSPhotoLibraryAddUsageDescription</code>只针对相册存储权限，在iOS11上系统默认打开了用户相册的访问权限，如果应用需要存储权限就需要添加这个key，否则就会crash。</p><h3 id="AppIcon"><a href="#AppIcon" class="headerlink" title="AppIcon"></a>AppIcon</h3><p>在iOS11上发现了一个奇怪的现象，APP在启动图标会出现黑边，如图（处女座实在忍不了…）<br><img src="http://owgqmweju.bkt.clouddn.com/17-10-23/31263530.jpg" alt="图2"><br>原因是iOS11修改了App启动动画，如果你的App图标有圆角那么就会变成这个鸟样了…所有图标都换成直角就好了，具体规范见<a href="https://developer.apple.com/design/" target="_blank" rel="external">Human Interface Guidelines-App Icon</a>，还是要听苹果爸爸的话啊…</p><h3 id="iPhoneX"><a href="#iPhoneX" class="headerlink" title="iPhoneX"></a>iPhoneX</h3><h4 id="LaunchImage"><a href="#LaunchImage" class="headerlink" title="LaunchImage"></a>LaunchImage</h4><p>关于iPhoneX(我就不吐槽刘海了…)，如果你的APP在iPhoneX上运行发现没有充满屏幕，上下有黑色区域，那么你应该也像我一样<code>LaunchImage</code>没有用<code>storyboard</code>而是用的<code>Assets</code>，解决办法如图，启动图的尺寸为<code>1125x2436</code>，or you can <a href="http://www.jianshu.com/p/77054dccafdb" target="_blank" rel="external">iOS开发时如何使用 Launch Screen Storyboard</a>。<br><img src="http://upload-images.jianshu.io/upload_images/702870-71705661b4518de5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图2"></p><h4 id="TabBarController"><a href="#TabBarController" class="headerlink" title="TabBarController"></a>TabBarController</h4><p>如果你使用了原生tabBar，系统会自动适配，因为我们的项目用了第三方的<code>TabBarController</code>，在iPhoneX运行，tabBar看起来怪怪的(<strong>如果不确定你的项目tabBar在iPhoneX上看起来是否正常，可以参照模拟器的照片APP，一看便知</strong>)…估计作者要等到猴年马月才适配iPhoneX，项目又着急上线，就自己改了下，主要是<code>tabBar</code>高度及<code>tabBarItem</code>偏移适配，iPhoneX由于底部安全区的原因<code>UITabBar</code>高度由49pt变成了83pt，多出来的34pt是空白手势区域。可以通过判断机型来修改相关界面代码，方式有两种，通过分辨率判断：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#define kDevice_Is_iPhoneX ([UIScreen instancesRespondToSelector:@selector(currentMode)] ? CGSizeEqualToSize(CGSizeMake(1125, 2436), [[UIScreen mainScreen] currentMode].size) : NO)</span></div></pre></td></tr></table></figure></p><p>通过设备名称判断：<br>@”iPhone10,1” : @”iPhone 8”,<br>@”iPhone10,4” : @”iPhone 8”,<br>@”iPhone10,2” : @”iPhone 8 Plus”,<br>@”iPhone10,5” : @”iPhone 8 Plus”,<br>@”iPhone10,3” : @”iPhone X”,<br>@”iPhone10,6” : @”iPhone X”,<br>这里推荐使用<a href="https://github.com/squarefrog/UIDeviceIdentifier" target="_blank" rel="external">UIDeviceIdentifier</a>。</p><p>目前遇到的就这些坑，欢迎大家指正补充~</p><p>作为一名iOS开发人员，想到当年嘲笑Android开发蛋疼的适配各种机型心情如图…<br><img src="http://upload-images.jianshu.io/upload_images/702870-4db780c96ed7f4b5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p><p>最后奉上WWDC官方视频：</p><p><a href="https://developer.apple.com/videos/play/wwdc2017/204/" target="_blank" rel="external">Updating Your App for iOS 11</a></p><p><a href="https://developer.apple.com/videos/play/fall2017/201/" target="_blank" rel="external">Building Apps for iPhone X</a></p><p><a href="https://developer.apple.com/videos/play/fall2017/801/" target="_blank" rel="external">Designing for iPhone X</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前阵子项目开发忙成狗，就一直没做iOS11的适配，直到XcodeGM版发布后，我胸有成竹的在iPhoneX上跑起项目，整个人都凉透了…下面总结一下我遇到的坑，不是很全面，日后补充。&lt;/p&gt;
    
    </summary>
    
    
      <category term="适配iOS11" scheme="http://wonkeyz.com/tags/%E9%80%82%E9%85%8DiOS11/"/>
    
      <category term="适配iPhoneX" scheme="http://wonkeyz.com/tags/%E9%80%82%E9%85%8DiPhoneX/"/>
    
  </entry>
  
  <entry>
    <title>在对象dealloc时做一些操作</title>
    <link href="http://wonkeyz.com/2017/07/28/%E5%9C%A8%E5%AF%B9%E8%B1%A1dealloc%E6%97%B6%E5%81%9A%E4%B8%80%E4%BA%9B%E6%93%8D%E4%BD%9C/"/>
    <id>http://wonkeyz.com/2017/07/28/在对象dealloc时做一些操作/</id>
    <published>2017-07-28T06:53:00.000Z</published>
    <updated>2017-10-19T07:14:06.505Z</updated>
    
    <content type="html"><![CDATA[<p>最近做直播间优化时遇到个奇葩需求，需要在评论输入视图释放时做一些操作，当时没想太多直接在CommentView外部公开一个block，然后在CommentView的<code>dealloc</code>方法里调用该block，简单粗暴…<a id="more"></a>事后想了想能不能封装一个通用的方法给对象添加一个释放时调用的block呢？第一时间想到用Method Swizzling来hook对象的<code>dealloc</code>方法，马上领悟到这样未免侵入性太强，日后也许会导致难以排查的bug，仔细思考后想到了一个巧妙的方法，通过Category给<code>NSObject</code>公开一个添加block的方法，利用runtime的AssociatedObject给对象搭配一个‘‘小伙伴’’，在对象释放时，这个‘‘小伙伴’’负责调用block，这样既做到了与对象的共存亡又简单干净，上代码~<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^DeallocBlock)(<span class="keyword">void</span>);</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSObject</span> (<span class="title">Associate</span>)</span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">给对象添加释放时调用的block</div><div class="line">*/</div><div class="line">- (<span class="keyword">void</span>)addDeallocBlock:(DeallocBlock)deallocBlock;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"NSObject+Associate.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Partner</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) DeallocBlock deallocBlock;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Partner</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)dealloc &#123;</div><div class="line">    <span class="keyword">if</span> (_deallocBlock) &#123;</div><div class="line">        _deallocBlock();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">void</span> *kPartnerArrayKey = &amp;kPartnerArrayKey;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">Associate</span>)</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)addDeallocBlock:(DeallocBlock)deallocBlock &#123;</div><div class="line">    <span class="keyword">@synchronized</span> (<span class="keyword">self</span>) &#123;</div><div class="line">        <span class="built_in">NSMutableArray</span> *partnerArray = objc_getAssociatedObject(<span class="keyword">self</span>, kPartnerArrayKey);</div><div class="line">        <span class="keyword">if</span> (!partnerArray) &#123;</div><div class="line">            partnerArray = [<span class="built_in">NSMutableArray</span> array];</div><div class="line">            objc_setAssociatedObject(<span class="keyword">self</span>, kPartnerArrayKey, partnerArray, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">        &#125;</div><div class="line">        Partner *partner = [[Partner alloc] init];</div><div class="line">        partner.deallocBlock = deallocBlock;</div><div class="line">        [partnerArray addObject:partner];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure><p>这里有几点<strong>注意事项</strong>：<br>1.block触发时的线程与对象释放时的线程一致，注意后续操作的线程安全。<br>2.如果你想在block里引用对象，那么无论强弱引用都是不可行的，强引用会造成循环引用，弱引用则获取不到对象，因为已经被至为nil，可以使用<code>__unsafe_unretained</code>修饰：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">__<span class="keyword">unsafe_unretained</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) unsafeSelf = <span class="keyword">self</span>;</div></pre></td></tr></table></figure></p><p>现在看起来比最开始的直接在CommentView的dealloc里做操作的想法成熟多了，但之后我再查阅相关资料时还是发现自己<em>too young too native</em>了…其实早就有大佬写了类似的框架，放个链接供大家膜<a href="https://github.com/ChenYilong/CYLDeallocBlockExecutor#%E4%BD%BF%E7%94%A8cyldeallocblockexecutor" target="_blank" rel="external">CYLDeallocBlockExecutor</a>，代码不是很复杂，但是考虑的点和实现思路很赞，也许这就是差距吧…其中涉及到了<code>NSHashTable</code>，不了解的可以看南大的<a href="http://southpeak.github.io/2015/05/10/ios-techset-1/" target="_blank" rel="external">iOS知识小集 第1期(2015.05.10)-NSHashTable部分</a>。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近做直播间优化时遇到个奇葩需求，需要在评论输入视图释放时做一些操作，当时没想太多直接在CommentView外部公开一个block，然后在CommentView的&lt;code&gt;dealloc&lt;/code&gt;方法里调用该block，简单粗暴…
    
    </summary>
    
    
      <category term="runitme" scheme="http://wonkeyz.com/tags/runitme/"/>
    
  </entry>
  
  <entry>
    <title>iOS性能优化UI篇（二）</title>
    <link href="http://wonkeyz.com/2017/06/29/iOS%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96UI%E7%AF%87%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>http://wonkeyz.com/2017/06/29/iOS性能优化UI篇（二）/</id>
    <published>2017-06-29T08:59:23.000Z</published>
    <updated>2017-10-27T10:36:55.000Z</updated>
    
    <content type="html"><![CDATA[<p>书接上回，我们来聊一下UI性能优化的几大重点对象。</p><h3 id="UITableView"><a href="#UITableView" class="headerlink" title="UITableView"></a>UITableView</h3><p>我相信每一位iOS开发人员写<code>UITableView</code>肯定都要写吐了，但是大家确定在写的时候都注意到这些原则or细节了吗？</p><ul><li>尽量避免动态高度的cell，如果已确定控件的高度，直接使用<code>tableView</code>的<code>rowHeight</code>、<code>sectionHeaderHeight</code>和<code>sectionFooterHeight</code>设置高度，避免请求delegate。在<code>heightForRowAtIndexPath:</code>中尽量不使用<code>cellForRowAtIndexPath:</code>，如果你需要用到它，最好只用一次然后缓存结果。<a id="more"></a></li><li>使用<code>dequeueReusableCellWithIdentifier:</code>或<code>dequeueReusableCellWithIdentifier:forIndexPath:</code>复用cell，后者需要搭配<code>registerClass/Nib:forCellReuseIdentifier:</code>使用，该方法会在默认没有cell可复用的时候自动创建一个新的cell出来，推荐使用后者。</li><li>对于动态高度的cell，做对应标记，缓存行高。推荐使用sunnyxx大神的<a href="https://github.com/forkingdog/UITableView-FDTemplateLayoutCell" target="_blank" rel="external">UITableView-FDTemplateLayoutCell</a>。如果cell对应的模型没有发生变化，则不做相应的计算渲染处理。</li><li>使用自定义视图构造的cell，要避免调用<code>layoutIfNeeded</code>每次对其进行布局。尽量固定cell子视图的尺寸，确保每个cell渲染所需时间最小化。<br>尽量使用不透明的子视图，包括cell本身，这点已经在上篇基本法中提过。<br>确保cell的子视图数量最少，避免耗费性能的操作，如图片的缩放、渐变等。<br>如果自定义cell的样式基本确定不会发生大的布局变化，或者在滑动时有明显的性能问题，那么你可能需要异步绘制这个cell，我会在自定义视图部分讲解。</li><li>在快速滚动时如果出现了卡顿，那么你除了使用异步绘制cell，还可以考虑使用‘‘占位’’cell，这种方式在国内的App比较少见，如图：<br><img src="http://owgqmweju.bkt.clouddn.com/17-10-26/41893848.jpg" alt="图1"><br>‘‘占位’’cell类似于占位图，它告诉用户这部分即将展示一些信息，当滚动速度降低到一定值时，再展示最终数据。部分代码实现如下：<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</div><div class="line">    <span class="comment">// 通过scrollView的panGestureRecognizer获取滑动速率</span></div><div class="line">    <span class="keyword">self</span>.velocity = [scrollView.panGestureRecognizer velocityInView:<span class="keyword">self</span>.view];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</div><div class="line">    <span class="comment">// 根据滑动速率做相应内容展示</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.velocity.y &gt; maxVelocity) &#123;</div><div class="line">        <span class="keyword">return</span> placeholderCell;</div><div class="line">    &#125;<span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> cell;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><p>还有一种sao套路是按需加载cell<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 按需加载 - 如果目标行与当前行相差超过指定行数，只在目标滚动范围的前后指定3行加载。</span></div><div class="line">- (<span class="keyword">void</span>)scrollViewWillEndDragging:(<span class="built_in">UIScrollView</span> *)scrollView withVelocity:(<span class="built_in">CGPoint</span>)velocity targetContentOffset:(<span class="keyword">inout</span> <span class="built_in">CGPoint</span> *)targetContentOffset&#123;</div><div class="line">    <span class="built_in">NSIndexPath</span> *ip = [<span class="keyword">self</span> indexPathForRowAtPoint:<span class="built_in">CGPointMake</span>(<span class="number">0</span>, targetContentOffset-&gt;y)];</div><div class="line">    <span class="built_in">NSIndexPath</span> *cip = [[<span class="keyword">self</span> indexPathsForVisibleRows] firstObject];</div><div class="line">    <span class="built_in">NSInteger</span> skipCount = <span class="number">8</span>;</div><div class="line">    <span class="keyword">if</span> (labs(cip.row - ip.row) &gt; skipCount) &#123;</div><div class="line">        <span class="built_in">NSArray</span> *temp = [<span class="keyword">self</span> indexPathsForRowsInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, targetContentOffset-&gt;y, <span class="keyword">self</span>.width, <span class="keyword">self</span>.height)];</div><div class="line">        <span class="built_in">NSMutableArray</span> *arr = [<span class="built_in">NSMutableArray</span> arrayWithArray:temp];</div><div class="line">        <span class="keyword">if</span> (velocity.y &lt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="built_in">NSIndexPath</span> *indexPath = [temp lastObject];</div><div class="line">            <span class="keyword">if</span> (indexPath.row + <span class="number">3</span> &lt; datas.count) &#123;</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row+<span class="number">1</span> inSection:<span class="number">0</span>]];</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row+<span class="number">2</span> inSection:<span class="number">0</span>]];</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row+<span class="number">3</span> inSection:<span class="number">0</span>]];</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">NSIndexPath</span> *indexPath = [temp firstObject];</div><div class="line">            <span class="keyword">if</span> (indexPath.row &gt; <span class="number">3</span>) &#123;</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row<span class="number">-3</span> inSection:<span class="number">0</span>]];</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row<span class="number">-2</span> inSection:<span class="number">0</span>]];</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row<span class="number">-1</span> inSection:<span class="number">0</span>]];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        [needLoadArr addObjectsFromArray:arr];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 在`tableView:cellForRowAtIndexPath:`方法中加入判断：，修改样式</span></div><div class="line"><span class="keyword">if</span> (needLoadArr.count &gt; <span class="number">0</span></div><div class="line">    &amp;&amp;</div><div class="line">    [needLoadArr indexOfObject:indexPath] == <span class="built_in">NSNotFound</span>) &#123;</div><div class="line">        [cell clear];</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p><p>详见<a href="https://github.com/johnil/VVeboTableViewDemo" target="_blank" rel="external">VVeboTableViewDemo</a></p><h3 id="UIWebView、WKWebView"><a href="#UIWebView、WKWebView" class="headerlink" title="UIWebView、WKWebView"></a>UIWebView、WKWebView</h3><p>由于H5具有动态化，不用发版等优势，越来越多的H5页面出现的原生App中。苹果提供了两种加载H5的控件，<code>UIWebView</code>,<code>WKWebView</code>，<code>WKWebView</code>是iOS8的新特性，通过简单的测试即可发现UIWebView占用过多内存，且内存峰值更是夸张。WKWebView网页加载速度更快，占用内存更小，下面列举一些其它的优势：</p><ul><li>支持更多的H5特性</li><li>60fps的滚动刷新率及内置手势</li><li>与Safari相同的JavaScript引擎</li><li>将<code>UIWebView</code>和<code>UIWebViewDelegate</code>重构成了14个类，3个协议，可以让开发者进行更细致的配置</li></ul><p>简直完爆<code>UIWebView</code>，所以想要优化你的webView，那么从现在开始弃<code>UIWebView</code>，用<code>WKWebView</code>吧！下面简单介绍一下<code>WKWebView</code>。  </p><h4 id="加载页面"><a href="#加载页面" class="headerlink" title="加载页面"></a>加载页面</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import<span class="meta-string">&lt;WebKit/WebKit.h&gt;</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)loadRequest &#123;</div><div class="line">    _wkWebView = [[<span class="built_in">WKWebView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds configuration:[<span class="built_in">WKWebViewConfiguration</span> new]]; </div><div class="line">    <span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://www.wonkeyz.com/"</span>]];</div><div class="line">    [_wkWebView loadRequest:request];</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="原生调用JS"><a href="#原生调用JS" class="headerlink" title="原生调用JS"></a>原生调用JS</h4><p>1.使用<code>WKUserScript</code><br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// JS代码</span></div><div class="line"><span class="built_in">NSString</span> *js = <span class="string">@"window.alert('测试原生调用JS');"</span>;</div><div class="line"><span class="comment">// 根据JS代码初始化WKUserScript对象</span></div><div class="line"><span class="built_in">WKUserScript</span> *script = [[<span class="built_in">WKUserScript</span> alloc] initWithSource:js injectionTime:<span class="built_in">WKUserScriptInjectionTimeAtDocumentEnd</span> forMainFrameOnly:<span class="literal">YES</span>];</div><div class="line"><span class="comment">// 根据生成的WKUserScript对象，初始化WKWebViewConfiguration</span></div><div class="line"><span class="built_in">WKWebViewConfiguration</span> *config = [<span class="built_in">WKWebViewConfiguration</span> new];</div><div class="line">[config.userContentController addUserScript:script];</div></pre></td></tr></table></figure></p><p>2.直接调用JS代码<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[_wkWebView evaluateJavaScript:js completionHandler:^(<span class="keyword">id</span> _Nullable, <span class="built_in">NSError</span> * _Nullable error) &#123;</div><div class="line">        <span class="comment">// 获取js方法返回值，回调操作等</span></div><div class="line">    &#125;];</div></pre></td></tr></table></figure></p><h4 id="JS调用原生"><a href="#JS调用原生" class="headerlink" title="JS调用原生"></a>JS调用原生</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 向JS注入OC方法</span></div><div class="line">[[_webView configuration].userContentController addScriptMessageHandler:<span class="keyword">self</span> name:<span class="string">@"ocMethod"</span>];</div><div class="line"></div><div class="line"><span class="comment">// JS调用</span></div><div class="line">window.webkit.messageHandlers.ocMethod.postMessage(value);</div><div class="line"></div><div class="line"><span class="comment">// 接收JS调用</span></div><div class="line">- (<span class="keyword">void</span>)userContentController:(<span class="built_in">WKUserContentController</span> *)userContentController didReceiveScriptMessage:(<span class="built_in">WKScriptMessage</span> *)message &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"JS 调用了 %@ 方法，传回参数 %@"</span>,message.name,message.body);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>就是这么简单！不过<code>WKWebView</code>还是有一些坑的，有很多相关文章，这里奉上几篇大佬的总结<a href="http://www.jianshu.com/p/403853b63537" target="_blank" rel="external">WKWebView的使用和各种坑的解决方法（OC＋Swift）</a>，<a href="http://www.jianshu.com/p/7bb5f15f1daa" target="_blank" rel="external">WKWebView学习笔记</a>。</p><h3 id="自定义视图的绘制"><a href="#自定义视图的绘制" class="headerlink" title="自定义视图的绘制"></a>自定义视图的绘制</h3><p>我们来做一个简单的demo，如图：<img src="http://owgqmweju.bkt.clouddn.com/17-10-27/22309726.jpg" alt="图2"><br>正常代码布局就不写了，这里给出绘制代码<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"drink.jpg"</span>];</div><div class="line">        <span class="built_in">CGRect</span> imageFrame = <span class="built_in">CGRectMake</span>(<span class="number">15</span>, <span class="number">15</span>, <span class="number">80</span>, <span class="number">80</span>);</div><div class="line">        [image drawInRect:imageFrame];</div><div class="line">    &#125;</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">NSString</span> *title = <span class="string">@"This is title,This is title,This is title,This is title"</span>;</div><div class="line">        <span class="built_in">UIFont</span> *titleFont = [<span class="built_in">UIFont</span> boldSystemFontOfSize:<span class="number">17</span>];</div><div class="line">        <span class="built_in">NSDictionary</span> *attrs = @&#123;<span class="built_in">NSFontAttributeName</span> : titleFont,</div><div class="line">                                <span class="built_in">NSForegroundColorAttributeName</span> : kTextColor</div><div class="line">                                &#125;;</div><div class="line">        <span class="built_in">CGRect</span> titleFrame = <span class="built_in">CGRectMake</span>(<span class="number">105</span>, <span class="number">10</span>, <span class="keyword">self</span>.width - <span class="number">125</span>, <span class="number">30</span>);</div><div class="line">        [title drawInRect:titleFrame withAttributes:attrs];</div><div class="line">    &#125;</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">NSString</span> *content = <span class="string">@"This is content,This is content,This is content,This is content,This is content"</span>;</div><div class="line">        <span class="built_in">UIFont</span> *contentFont = [<span class="built_in">UIFont</span> boldSystemFontOfSize:<span class="number">13</span>];</div><div class="line">        <span class="built_in">NSDictionary</span> *attrs = @&#123;<span class="built_in">NSFontAttributeName</span> : contentFont,</div><div class="line">                                <span class="built_in">NSForegroundColorAttributeName</span> : kLigthTextColor</div><div class="line">                                &#125;;</div><div class="line">        <span class="built_in">CGRect</span> contentFrame = <span class="built_in">CGRectMake</span>(<span class="number">105</span>, <span class="number">40</span>, <span class="keyword">self</span>.width - <span class="number">125</span>, <span class="number">40</span>);</div><div class="line">        [content drawInRect:contentFrame withAttributes:attrs];</div><div class="line">    &#125;</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">NSString</span> *time = <span class="string">@"This is time"</span>;</div><div class="line">        <span class="built_in">UIFont</span> *timeFont = [<span class="built_in">UIFont</span> boldSystemFontOfSize:<span class="number">12</span>];</div><div class="line">        <span class="built_in">NSDictionary</span> *attrs = @&#123;<span class="built_in">NSFontAttributeName</span> : timeFont,</div><div class="line">                                <span class="built_in">NSForegroundColorAttributeName</span> : kLigthTextColor</div><div class="line">                                &#125;;</div><div class="line">        <span class="built_in">CGRect</span> timeFrame = <span class="built_in">CGRectMake</span>(<span class="number">105</span>, <span class="number">80</span>, <span class="keyword">self</span>.width - <span class="number">125</span>, <span class="number">20</span>);</div><div class="line">        [time drawInRect:timeFrame withAttributes:attrs];</div><div class="line">    &#125;</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line">        <span class="built_in">CGContextSetStrokeColorWithColor</span>(context, kLineBackColor.CGColor);</div><div class="line">        <span class="built_in">CGContextStrokeRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="keyword">self</span>.height - kLineHeight, <span class="keyword">self</span>.width, kLineHeight));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>对比一下渲染时间，左为复合视图方式，右为直接绘制<br><img src="http://owgqmweju.bkt.clouddn.com/17-10-27/34929283.jpg" alt="图3"><br>通过对比发现绘制得到的cell渲染时间缩短明显，对于更复杂的界面性能优势可想而知。因此，从性能角度来看，直接绘制视图是个不错的选择，但从维护角度来看，代码会比较难维护迭代，所以在某些界面样式稳定下来，你可以考虑重构成绘制视图。或者直接使用上文提到的高性能框架<a href="https://github.com/ibireme/YYKit" target="_blank" rel="external">YYkit</a>、<a href="https://github.com/TextureGroup/Texture" target="_blank" rel="external">Texture</a>。</p><h3 id="Auto-Layout"><a href="#Auto-Layout" class="headerlink" title="Auto Layout"></a>Auto Layout</h3><p>再补充一下比较具有争议性的Auto Layout，它给我们日常开发带来了很大的便利，但便利的代价就是耗费更多的性能。<br>Auto Layout使用Cassowary算法作为约束求解工具包，他的复杂度为O（N），其中N是约束的数目，而不是元素的数目。这意味着，在一般情况下，为了确定视图中所有元素的位置和大小，可能有大概4N个方程要求解，而且方程花费的时间与元素的个数和包含的约束个数是不成比例的。当视图数量增加至几百个，直接设设置结构大小要比用自动布局快1000倍左右！(测试demo<a href="https://github.com/floriankugler/AutoLayoutProfiling" target="_blank" rel="external">AutoLayoutProfiling</a>)<br>更详细的分析请见<a href="https://draveness.me/layout-performance" target="_blank" rel="external">从 Auto Layout 的布局算法谈性能</a>。<br>所以当你为某个使用Auto Layout的界面性能消耗苦恼时，那么请改为代码布局吧😂  </p><p>UI篇的性能优化就总结到这，菜鸟第一次写这类文章还请各位大佬多包涵，只求别辣到各位大佬的双眼😂</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;书接上回，我们来聊一下UI性能优化的几大重点对象。&lt;/p&gt;
&lt;h3 id=&quot;UITableView&quot;&gt;&lt;a href=&quot;#UITableView&quot; class=&quot;headerlink&quot; title=&quot;UITableView&quot;&gt;&lt;/a&gt;UITableView&lt;/h3&gt;&lt;p&gt;我相信每一位iOS开发人员写&lt;code&gt;UITableView&lt;/code&gt;肯定都要写吐了，但是大家确定在写的时候都注意到这些原则or细节了吗？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;尽量避免动态高度的cell，如果已确定控件的高度，直接使用&lt;code&gt;tableView&lt;/code&gt;的&lt;code&gt;rowHeight&lt;/code&gt;、&lt;code&gt;sectionHeaderHeight&lt;/code&gt;和&lt;code&gt;sectionFooterHeight&lt;/code&gt;设置高度，避免请求delegate。在&lt;code&gt;heightForRowAtIndexPath:&lt;/code&gt;中尽量不使用&lt;code&gt;cellForRowAtIndexPath:&lt;/code&gt;，如果你需要用到它，最好只用一次然后缓存结果。
    
    </summary>
    
    
      <category term="性能优化" scheme="http://wonkeyz.com/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
      <category term="UITableView" scheme="http://wonkeyz.com/tags/UITableView/"/>
    
      <category term="UIWebView" scheme="http://wonkeyz.com/tags/UIWebView/"/>
    
      <category term="WKWebView" scheme="http://wonkeyz.com/tags/WKWebView/"/>
    
  </entry>
  
  <entry>
    <title>iOS性能优化UI篇（一）</title>
    <link href="http://wonkeyz.com/2017/06/24/iOS%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96UI%E7%AF%87%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>http://wonkeyz.com/2017/06/24/iOS性能优化UI篇（一）/</id>
    <published>2017-06-24T06:22:03.000Z</published>
    <updated>2017-10-26T09:16:53.935Z</updated>
    
    <content type="html"><![CDATA[<p> 这是一个老生常谈的话题，程序猿的一生除了在编译、写bug、改bug，就是在不断地重构优化，优化的点也多种多样，其中最直观有效的就是UI部分的优化了，这方面有很多相关资料，也有如<a href="https://github.com/ibireme/YYKit" target="_blank" rel="external">YYkit</a>、<a href="https://github.com/TextureGroup/Texture" target="_blank" rel="external">Texture</a>这种神级框架从根源上解决了卡顿的问题。作为菜鸟的我无法像大佬们一样从根源上分析解决UI性能问题，只能写一篇比较基础的文章，总结一下常用的控件的使用注意点，希望对你的日常开发有帮助~<br> <a id="more"></a></p><h3 id="基本法"><a href="#基本法" class="headerlink" title="基本法"></a>基本法</h3><p>先来一波UI操作的基本法则：</p><ul><li>尽量减少在主线程中的操作，避免阻塞主线程。执行的操作越多就意味着越高的丢帧率，从而导致丢帧卡顿。</li><li>尽量保持视图的扁平化，避免视图的多层嵌套。<br>只要给视图添加子视图，或其子视图布局发生变化都会触发父视图的<code>layoutSubviews</code>方法，如果一个视图被塞了很多子视图，性能消耗可想而知。那么这种情况如何避免呢？最好的方法是自定义视图绘制。这样只会触发一个视图的绘制方法，而不是多个子视图的，同时避免了父视图多次调用<code>layoutSubviews</code>和<code>drawRect:</code>方法，具体操作文中会给出demo。  </li><li>尽量使用不透明视图。<br>当一个view是透明的，iOS需要渲染一个像素两次或多次，这是因为一个像素同时属于很多subviews。这是一个非常耗时的过程。不透明的视图可以极大地提高渲染的速度。因此如非必要，可以将table cell及其子视图的<code>opaque</code>属性设为YES（默认值）。</li><li>一些情况下避免使用具有通用目的及功能丰富的控件，系统控件虽然方便，但有时也会带来不必要的消耗，你可以通过封装视图绘制内容来代替。如只显示大段纯文本，那么不必使用功能复杂的<code>UILabel</code>。</li><li>尽量延迟加载、重用复杂视图。<br>这点我相信大家在使用<code>UITableView</code>、<code>UICollectionView</code>时都深有体会，如果你对机制足够了解，那么在使用<code>UIScrollView</code>时也可以尝试使用重用机制。</li><li>尽量避免出现较大的xib或storyboard。sb固然强大，但整个XML文件在使用之前必须被解析和加载，所以应该最小化sb中的单元数目，创建多个sb或xib，这样不仅有助于减少应用启动时间，还能降低整体内存消耗。</li></ul><p>聊完基本法，我们来聊一下几个常见视图，看看有哪些性能小技巧。</p><h4 id="UILabel"><a href="#UILabel" class="headerlink" title="UILabel"></a>UILabel</h4><p>这绝对是你用的最多的控件，看似简单，但你真的了解它的性能消耗点吗？先来看看他有多复杂。<br><img src="http://owgqmweju.bkt.clouddn.com/17-10-19/50317192.jpg" alt="图1"><br>图中的每一项设置都会增加<code>UILabel</code>的渲染代价，具体步骤如下：<br>1.使用字体样式及要被渲染的文本时，计算需要的像素数，这是一个消耗较大的过程，应尽量少做。<br>2.检查要被渲染的宽度。<br>3.检查<code>numberOfLines</code>，计算将要展示的行数。<br>4.<code>sizeToFit</code>是否被调用，调用则计算高度，未调用则检查当前尺寸是否能展示完整内容。<br>5.如果size不够展示，则使用<code>lineBreakMode</code>确定隐藏或截断的位置。<br>6.检查其他配置选项，如纯文本or富文本，富文本的样式，对齐方式，自动收缩等。<br>7.最后使用字体、类型及颜色等渲染最终显示的文本。<br>整个过程下来的渲染代价不容小觑，所以平时使用要避免一些不必要的性能浪费。<br>ps：有时会发现label的文字变模糊，那么你需要检查一下label的frame是否都为整数。</p><h4 id="UIButton"><a href="#UIButton" class="headerlink" title="UIButton"></a>UIButton</h4><p>按钮同样无处不在，样式多变、功能强大的它渲染方式主要有以下四种：</p><ul><li>使用自定义文本默认渲染</li><li>全尺寸资源渲染</li><li>可变尺寸资源渲染</li><li>使用<code>CALayer</code>和贝塞尔曲线自定义绘制</li></ul><p>下表简单列出了几种渲染方式的利弊。具体见<a href="https://robots.thoughtbot.com/designing-for-ios-taming-uibutton#advantages-of-bezier-approach" target="_blank" rel="external">Designing for iOS: Taming UIButton</a>。</p><table><thead><tr><th>渲染方式</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>自定义文本</td><td>简单易用</td><td>样式单一</td></tr><tr><td>全尺寸资源</td><td>可自定义背景图 <br> 样式多变 <br> 可实现A/B测试</td><td>图片导致ipa包变大</td></tr><tr><td>可变尺寸资源</td><td>ipa包大小增量较全尺寸小</td><td>资源的任何更改可能都会重新计算<code>UIEdgeInsets</code></td></tr><tr><td>自定义绘制</td><td>高度自定义样式</td><td>随着迭代代码回越发臃肿</td></tr></tbody></table><p>通过上面的比较，你需要权衡一下利弊，到底是要性能能还是要ipa包保持合适的大小。</p><h4 id="UIImageView"><a href="#UIImageView" class="headerlink" title="UIImageView"></a>UIImageView</h4><p>图像的使用也很简单，但在渲染代价较大的UI元素中，图像首屈一指。在使用UIImage、UIImageView时，注意以下几点有助于性能提升：</p><ul><li>加载图片的方式有三种<code>imageNamed:</code>、<code>imageWithContentsOfFile:</code>、<code>imageWithData:</code>，正确选择图片加载方式能够对内存优化起到很大的作用。<br><code>imageNamed:</code>优点在于可以缓存已经加载的图片，确保内容只被加载至内存一次，这对于图像的重复利用是非常有优势的。对于常用的小图推荐使用该方法，可以节省出每次都从磁盘加载图片的时间，这样能更好的响应用户的操作。<br><code>imageWithContentsOfFile:</code>和<code>imageWithData:</code>这两种方法的本质是一样的， 都是简单的加载图片，并不会将图片缓存起来，图像会被系统以数据方式加载到界面。一些不常用的大图推荐使用这两种方法，这样就不会缓存这些图片占用内存。</li><li>对于网络图像，使用高性能的图像缓存库，如<a href="https://github.com/ibireme/YYWebImage" target="_blank" rel="external">YYWebImage</a>、<a href="https://github.com/rs/SDWebImage" target="_blank" rel="external">SDWebImage</a>。</li><li>在图片格式的选择上同样很有讲究，选择合适的格式能够为你的应用带来最佳体验，这里奉上YY大神的博文<a href="https://blog.ibireme.com/2015/11/02/mobile_image_benchmark/" target="_blank" rel="external">移动端图片格式调研</a>。</li><li>载入的图片与<code>UIImageView</code>尺寸相同。因为调整图片尺寸是一个性能消耗较大的操作，如果图像在<code>UIScrollView</code>中，则消耗更大。如果图片来自网络下载，那么尽量做到下载的图片与视图尺寸匹配，或者对图片进行预处理，调整尺寸。</li><li>在非主线程中解压JPG/PNG图片，最好在一个专用队列中执行。</li><li>在一些界面的实现上，确定是否真的需要图片。如展示一个评分控件<img src="http://owgqmweju.bkt.clouddn.com/17-10-20/33841778.jpg" alt="enter image description here">，那么最好通过直接绘制，调整透明度或覆盖来实现，而不是使用多张图片。类似情况的取舍既可以优化性能，还能给安装包瘦身。</li></ul><p>先总结到这里，下篇我会总结一些关于<code>UITableView</code>、<code>WebView</code>和自定义视图的性能优化点，敬请期待！</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt; 这是一个老生常谈的话题，程序猿的一生除了在编译、写bug、改bug，就是在不断地重构优化，优化的点也多种多样，其中最直观有效的就是UI部分的优化了，这方面有很多相关资料，也有如&lt;a href=&quot;https://github.com/ibireme/YYKit&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;YYkit&lt;/a&gt;、&lt;a href=&quot;https://github.com/TextureGroup/Texture&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Texture&lt;/a&gt;这种神级框架从根源上解决了卡顿的问题。作为菜鸟的我无法像大佬们一样从根源上分析解决UI性能问题，只能写一篇比较基础的文章，总结一下常用的控件的使用注意点，希望对你的日常开发有帮助~&lt;br&gt;
    
    </summary>
    
    
      <category term="性能优化" scheme="http://wonkeyz.com/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>仿Facebook点赞动画</title>
    <link href="http://wonkeyz.com/2017/06/20/%E4%BB%BFFacebook%E7%82%B9%E8%B5%9E%E5%8A%A8%E7%94%BB/"/>
    <id>http://wonkeyz.com/2017/06/20/仿Facebook点赞动画/</id>
    <published>2017-06-20T07:13:44.000Z</published>
    <updated>2017-10-19T07:13:40.909Z</updated>
    
    <content type="html"><![CDATA[<p>一个简单的点赞动画，网上有很多实现方式，但觉得不对路，于是自己动起手来写了一个，效果如图：<br><img src="http://owgqmweju.bkt.clouddn.com/17-10-16/8652901.jpg" alt="图1"></p><a id="more"></a><h3 id="拆解动画"><a href="#拆解动画" class="headerlink" title="拆解动画"></a>拆解动画</h3><p>无论动画多复杂（虽然这个并不复杂😂），我相信都是由若干简单的动画组成的，下面来拆解一下这个动画，逐一实现效果自然就达到了~</p><ul><li>按钮缩放动画</li><li>粒子爆炸动画</li></ul><h3 id="缩放动画"><a href="#缩放动画" class="headerlink" title="缩放动画"></a>缩放动画</h3><p>缩放动画实现起来很简单，这里用到了帧动画，直接上代码，一目了然~<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#pragma mark - Target Method</span></div><div class="line">- (<span class="keyword">void</span>)clickButtonAction &#123;</div><div class="line">    <span class="keyword">self</span>.selected = !<span class="keyword">self</span>.selected;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.selected) &#123;</div><div class="line">        [<span class="keyword">self</span> popOutside];</div><div class="line">        [_explodeView animate];</div><div class="line">    &#125;<span class="keyword">else</span> &#123;</div><div class="line">        [<span class="keyword">self</span> popInside];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - Animate Methods</span></div><div class="line">- (<span class="keyword">void</span>)popInside &#123;</div><div class="line">    <span class="keyword">self</span>.transform = <span class="built_in">CGAffineTransformIdentity</span>;</div><div class="line">    </div><div class="line">    [<span class="built_in">UIView</span> animateKeyframesWithDuration:<span class="number">.5</span>f delay:<span class="number">0</span> options:<span class="number">0</span> animations:^&#123;</div><div class="line">        </div><div class="line">        [<span class="built_in">UIView</span> addKeyframeWithRelativeStartTime:<span class="number">0</span></div><div class="line">                                relativeDuration:<span class="number">1</span> / <span class="number">2.</span>f</div><div class="line">                                      animations:^&#123;</div><div class="line">                                          <span class="keyword">self</span>.transform = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">.7</span>f, <span class="number">.7</span>f);</div><div class="line">                                      &#125;];</div><div class="line">        [<span class="built_in">UIView</span> addKeyframeWithRelativeStartTime:<span class="number">1</span> / <span class="number">2.</span>f</div><div class="line">                                relativeDuration:<span class="number">1</span> / <span class="number">2.</span>f</div><div class="line">                                      animations:^&#123;</div><div class="line">                                          <span class="keyword">self</span>.transform = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">1.</span>f, <span class="number">1.</span>f);</div><div class="line">                                      &#125;];</div><div class="line">    &#125; completion:<span class="literal">nil</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)popOutside &#123;</div><div class="line">    <span class="keyword">self</span>.transform = <span class="built_in">CGAffineTransformIdentity</span>;</div><div class="line">    </div><div class="line">    [<span class="built_in">UIView</span> animateKeyframesWithDuration:<span class="number">.5</span>f delay:<span class="number">0</span> options: <span class="built_in">UIViewKeyframeAnimationOptionCalculationModeCubicPaced</span> animations: ^&#123;</div><div class="line">        </div><div class="line">        [<span class="built_in">UIView</span> addKeyframeWithRelativeStartTime:<span class="number">0</span></div><div class="line">                                relativeDuration:<span class="number">1</span> / <span class="number">3.</span>f</div><div class="line">                                      animations:^&#123;</div><div class="line">                                          <span class="keyword">self</span>.transform = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">1.5</span>f, <span class="number">1.5</span>f);</div><div class="line">                                      &#125;];</div><div class="line">        [<span class="built_in">UIView</span> addKeyframeWithRelativeStartTime:<span class="number">1</span> / <span class="number">3.</span>f</div><div class="line">                                relativeDuration:<span class="number">1</span> / <span class="number">3.</span>f</div><div class="line">                                      animations:^&#123;</div><div class="line">                                          <span class="keyword">self</span>.transform = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">.8</span>f, <span class="number">.8</span>f);</div><div class="line">                                      &#125;];</div><div class="line">        [<span class="built_in">UIView</span> addKeyframeWithRelativeStartTime:<span class="number">2</span> / <span class="number">3.</span>f</div><div class="line">                                relativeDuration:<span class="number">1</span> / <span class="number">3.</span>f</div><div class="line">                                      animations:^&#123;</div><div class="line">                                          <span class="keyword">self</span>.transform = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">1.</span>f, <span class="number">1.</span>f);</div><div class="line">                                      &#125;];</div><div class="line">    &#125; completion:<span class="literal">nil</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><h3 id="粒子动画"><a href="#粒子动画" class="headerlink" title="粒子动画"></a>粒子动画</h3><p>这个爆炸效果是不是看起来很眼熟？没错其实它跟烟花、下雪的动画实现是一样的，都用到了<code>CALayer</code>的一个高性能原生粒子引擎<a href="https://developer.apple.com/documentation/quartzcore/caemitterlayer" target="_blank" rel="external">CAEmitterLayer</a>。<br>简单介绍一下<code>CAEmitterLayer</code>，<code>CAEmitterLayer</code>相当于<code>CAEmitterCell</code>的容器，每一个cell相当于一个粒子，我们只需要定义一个<code>CAEmitterCell</code>粒子效果来作为粒子样式模板，比如粒子的图片、生成率、生命周期等参数，<code>CAEmitterLayer</code>会基于模板实例化该样式的粒子流，根据设置好的发射位置、发射模式、形状使他们动起来。具体代码如下：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setupEmitterLayer &#123;</div><div class="line">    <span class="keyword">self</span>.clipsToBounds = <span class="literal">NO</span>;</div><div class="line">    <span class="keyword">self</span>.userInteractionEnabled = <span class="literal">NO</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//创建粒子</span></div><div class="line">    <span class="built_in">CAEmitterCell</span> *emitter = [<span class="built_in">CAEmitterCell</span> emitterCell];</div><div class="line">    emitter.contents        = (<span class="keyword">id</span>)[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"like_dot"</span>].CGImage;</div><div class="line">    emitter.name            = <span class="string">@"emitterCell"</span>;</div><div class="line">    emitter.birthRate       = <span class="number">0</span>;</div><div class="line">    emitter.lifetime        = <span class="number">.7</span>f;</div><div class="line">    emitter.lifetimeRange   = <span class="number">.3</span>f;</div><div class="line">    emitter.alphaRange      = <span class="number">.2</span>f;</div><div class="line">    emitter.alphaSpeed      = <span class="number">-1.</span>f;</div><div class="line">    emitter.velocity        = <span class="number">40.</span>f;</div><div class="line">    emitter.velocityRange   = <span class="number">10.</span>f;</div><div class="line">    emitter.emissionRange   = M_PI_4;</div><div class="line">    emitter.scale           = <span class="number">.05</span>f;</div><div class="line">    emitter.scaleRange      = <span class="number">.02</span>f;</div><div class="line">    </div><div class="line">    <span class="comment">//创建粒子图层</span></div><div class="line">    _emitterLayer = [<span class="built_in">CAEmitterLayer</span> layer];</div><div class="line">    _emitterLayer.name              = <span class="string">@"emitterLayer"</span>;</div><div class="line">    _emitterLayer.frame             = <span class="keyword">self</span>.bounds;</div><div class="line">    _emitterLayer.emitterShape      = kCAEmitterLayerCircle;</div><div class="line">    _emitterLayer.emitterMode       = kCAEmitterLayerOutline;</div><div class="line">    _emitterLayer.emitterPosition   = <span class="keyword">self</span>.center;</div><div class="line">    _emitterLayer.emitterSize       = <span class="built_in">CGSizeMake</span>(<span class="number">25</span>, <span class="number">0</span>);</div><div class="line">    _emitterLayer.renderMode        = kCAEmitterLayerOldestFirst;</div><div class="line">    _emitterLayer.masksToBounds     = <span class="literal">NO</span>;</div><div class="line">    _emitterLayer.emitterCells      = @[emitter];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span>.layer addSublayer: _emitterLayer];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - Public Methods</span></div><div class="line">- (<span class="keyword">void</span>)animate &#123;</div><div class="line">    [_emitterLayer removeAnimationForKey:<span class="string">@"likeAnimation"</span>];</div><div class="line">    dispatch_time_t delay = dispatch_time(DISPATCH_TIME_NOW, <span class="number">.2</span>f * <span class="built_in">NSEC_PER_SEC</span>);</div><div class="line">    dispatch_after(delay, dispatch_get_main_queue(), ^&#123;</div><div class="line">        <span class="keyword">self</span>.emitterLayer.beginTime = <span class="built_in">CACurrentMediaTime</span>();</div><div class="line">        <span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath: <span class="string">@"emitterCells.emitterCell.birthRate"</span>];</div><div class="line">        animation.fromValue = @<span class="number">0</span>;</div><div class="line">        animation.toValue = @<span class="number">600</span>;</div><div class="line">        [_emitterLayer addAnimation:animation forKey:<span class="string">@"likeAnimation"</span>];</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>搞定！如果对帧动画和粒子动画有疑问可以看下面两篇文章：<br><a href="http://www.jianshu.com/p/a071bba99a1b" target="_blank" rel="external">Transform和KeyFrame动画</a><br><a href="https://segmentfault.com/a/1190000008580771" target="_blank" rel="external">CAEmitterLayer和CAEmitterCell的基本用法</a></p><p>demo地址：<a href="https://github.com/zhangMax/WZLikeButton" target="_blank" rel="external">WZLikeButton</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;一个简单的点赞动画，网上有很多实现方式，但觉得不对路，于是自己动起手来写了一个，效果如图：&lt;br&gt;&lt;img src=&quot;http://owgqmweju.bkt.clouddn.com/17-10-16/8652901.jpg&quot; alt=&quot;图1&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="animation" scheme="http://wonkeyz.com/tags/animation/"/>
    
  </entry>
  
  <entry>
    <title>Stay hungry, Stay foolish.</title>
    <link href="http://wonkeyz.com/2017/06/13/Stay-hungry-Stay-foolish/"/>
    <id>http://wonkeyz.com/2017/06/13/Stay-hungry-Stay-foolish/</id>
    <published>2017-06-13T08:11:03.000Z</published>
    <updated>2017-10-19T07:13:24.645Z</updated>
    
    <content type="html"><![CDATA[<p>做了一年多iOS开发的菜鸟一只，平时喜欢看各种大佬的博客，获益良多，但随着年龄的增长，记性越来越差…看过的东西如果不记在小本本上，怕不是要忘光…所以弄了个博客，记录平时工作中遇到的坑，以及拜读大佬博客的一些‘‘领悟’’，希望自己能坚持下去，也希望能给大家带来一些帮助。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;做了一年多iOS开发的菜鸟一只，平时喜欢看各种大佬的博客，获益良多，但随着年龄的增长，记性越来越差…看过的东西如果不记在小本本上，怕不是要忘光…所以弄了个博客，记录平时工作中遇到的坑，以及拜读大佬博客的一些‘‘领悟’’，希望自己能坚持下去，也希望能给大家带来一些帮助。&lt;/p
      
    
    </summary>
    
    
      <category term="iOS" scheme="http://wonkeyz.com/tags/iOS/"/>
    
  </entry>
  
</feed>
