<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[é€‚é…iOS11&iPhoneXçš„ä¸€äº›å‘]]></title>
      <url>/2017/09/17/%E9%80%82%E9%85%8DiOS11-iPhoneX%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/</url>
      <content type="html"><![CDATA[<p>å‰é˜µå­é¡¹ç›®å¼€å‘å¿™æˆç‹—ï¼Œå°±ä¸€ç›´æ²¡åšiOS11çš„é€‚é…ï¼Œç›´åˆ°XcodeGMç‰ˆå‘å¸ƒåï¼Œæˆ‘èƒ¸æœ‰æˆç«¹çš„åœ¨iPhoneXä¸Šè·‘èµ·é¡¹ç›®ï¼Œæ•´ä¸ªäººéƒ½å‡‰é€äº†â€¦ä¸‹é¢æ€»ç»“ä¸€ä¸‹æˆ‘é‡åˆ°çš„å‘ï¼Œä¸æ˜¯å¾ˆå…¨é¢ï¼Œæ—¥åè¡¥å……ã€‚</p>
<a id="more"></a>
<h3 id="å¯¼èˆªæ "><a href="#å¯¼èˆªæ " class="headerlink" title="å¯¼èˆªæ "></a>å¯¼èˆªæ </h3><h4 id="å¯¼èˆªæ é«˜åº¦çš„å˜åŒ–"><a href="#å¯¼èˆªæ é«˜åº¦çš„å˜åŒ–" class="headerlink" title="å¯¼èˆªæ é«˜åº¦çš„å˜åŒ–"></a>å¯¼èˆªæ é«˜åº¦çš„å˜åŒ–</h4><p>iOS11ä¹‹å‰å¯¼èˆªæ é»˜è®¤é«˜åº¦ä¸º64pt(<strong>è¿™é‡Œé«˜åº¦æŒ‡statusBar + NavigationBar</strong>)ï¼ŒiOS11ä¹‹åå¦‚æœè®¾ç½®äº†<code>prefersLargeTitles = YES</code>åˆ™ä¸º96ptï¼Œé»˜è®¤æƒ…å†µä¸‹è¿˜æ˜¯64ptï¼Œä½†åœ¨iPhoneXä¸Šç”±äºåˆ˜æµ·çš„å‡ºç°statusBarç”±ä»¥å‰çš„20ptå˜æˆäº†44ptï¼Œæ‰€ä»¥iPhoneXä¸Šé«˜åº¦å˜ä¸º88ptï¼Œå¦‚æœé¡¹ç›®é‡Œéšè—äº†å¯¼èˆªæ åŠ äº†è‡ªå®šä¹‰æŒ‰é’®ä¹‹ç±»çš„ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„é€‚é…ä¸€ä¸‹ã€‚</p>
<h4 id="å¯¼èˆªæ å›¾å±‚åŠå¯¹titleViewå¸ƒå±€çš„å½±å“"><a href="#å¯¼èˆªæ å›¾å±‚åŠå¯¹titleViewå¸ƒå±€çš„å½±å“" class="headerlink" title="å¯¼èˆªæ å›¾å±‚åŠå¯¹titleViewå¸ƒå±€çš„å½±å“"></a>å¯¼èˆªæ å›¾å±‚åŠå¯¹titleViewå¸ƒå±€çš„å½±å“</h4><p>iOS11ä¹‹å‰å¯¼èˆªæ çš„titleæ˜¯æ·»åŠ åœ¨<code>UINavigationItemView</code>ä¸Šé¢ï¼Œè€ŒnavigationBarButtonåˆ™ç›´æ¥æ·»åŠ åœ¨<code>UINavigationBar</code>ä¸Šé¢ï¼Œå¦‚æœè®¾ç½®äº†titleViewï¼Œåˆ™titleViewä¹Ÿæ˜¯ç›´æ¥æ·»åŠ åœ¨<code>UINavigationBar</code>ä¸Šé¢ã€‚iOS11ä¹‹åï¼Œå¤§æ¦‚å› ä¸º<code>largeTitle</code>çš„åŸå› ï¼Œè§†å›¾å±‚çº§å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰ç»™titleViewèµ‹å€¼ï¼Œåˆ™titleViewä¼šç›´æ¥æ·»åŠ åœ¨<code>_UINavigationBarContentView</code>ä¸Šé¢ï¼Œå¦‚æœèµ‹å€¼äº†titleViewï¼Œåˆ™ä¼šæŠŠtitleViewæ·»åŠ åœ¨<code>_UITAMICAdaptorView</code>ä¸Šï¼Œè€ŒnavigationBarButtonè¢«åŠ åœ¨äº†<code>_UIButtonBarStackView</code>ä¸Šï¼Œç„¶åä»–ä»¬éƒ½è¢«åŠ åœ¨äº†<code>_UINavigationBarContentView</code>ä¸Šï¼Œå¦‚å›¾ï¼š<br><img src="http://upload-images.jianshu.io/upload_images/702870-11488fe68c9d145b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾1"><br>æ‰€ä»¥å¦‚æœä½ çš„é¡¹ç›®æ˜¯è‡ªå®šä¹‰çš„navigationBarï¼Œé‚£ä¹ˆåœ¨iOS11ä¸Šè¿è¡Œå°±å¯èƒ½å‡ºç°å¸ƒå±€é”™ä¹±çš„bugï¼Œè§£å†³åŠæ³•æ˜¯é‡å†™<code>UINavigationBar</code>çš„<code>layoutSubviews</code>æ–¹æ³•ï¼Œè°ƒæ•´å¸ƒå±€ï¼Œä¸Šä»£ç ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)layoutSubviews &#123;</div><div class="line">    [<span class="keyword">super</span> layoutSubviews];</div><div class="line"></div><div class="line">    <span class="comment">//æ³¨æ„å¯¼èˆªæ åŠçŠ¶æ€æ é«˜åº¦é€‚é…</span></div><div class="line">    <span class="keyword">self</span>.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="built_in">CGRectGetWidth</span>(<span class="keyword">self</span>.frame), naviBarHeight);</div><div class="line">    <span class="keyword">for</span> (<span class="built_in">UIView</span> *view <span class="keyword">in</span> <span class="keyword">self</span>.subviews) &#123;</div><div class="line">        <span class="keyword">if</span>([<span class="built_in">NSStringFromClass</span>([view <span class="keyword">class</span>]) containsString:<span class="string">@"Background"</span>]) &#123;</div><div class="line">            view.frame = <span class="keyword">self</span>.bounds;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ([<span class="built_in">NSStringFromClass</span>([view <span class="keyword">class</span>]) containsString:<span class="string">@"ContentView"</span>]) &#123;</div><div class="line">            <span class="built_in">CGRect</span> frame = view.frame;</div><div class="line">            frame.origin.y = statusBarHeight;</div><div class="line">            frame.size.height = <span class="keyword">self</span>.bounds.size.height - frame.origin.y;</div><div class="line">            view.frame = frame;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å†è¡¥å……ä¸€ç‚¹ï¼Œçœ‹äº†<a href="http://www.jianshu.com/p/26fc39135c34" target="_blank" rel="external">ç®€ä¹¦Appé€‚é…iOS11</a>å‘ç°titleViewæ”¯æŒ<code>autolayout</code>ï¼Œè¿™è¦æ±‚titleViewå¿…é¡»æ˜¯èƒ½å¤Ÿè‡ªæ’‘å¼€çš„æˆ–å®ç°äº†<code>- intrinsicContentSize</code>æ–¹æ³•<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">CGSize</span>)intrinsicContentSize &#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">UILayoutFittingExpandedSize</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="ç»§æ‰¿è‡ªUIScrollViewçš„è§†å›¾åç§»é—®é¢˜"><a href="#ç»§æ‰¿è‡ªUIScrollViewçš„è§†å›¾åç§»é—®é¢˜" class="headerlink" title="ç»§æ‰¿è‡ªUIScrollViewçš„è§†å›¾åç§»é—®é¢˜"></a>ç»§æ‰¿è‡ªUIScrollViewçš„è§†å›¾åç§»é—®é¢˜</h3><p>å¤§å®¶åœ¨iOS11è®¾å¤‡ä¸Šè¿è¡Œå‡ºç°æœ€å¤šé—®é¢˜åº”è¯¥å°±æ˜¯<code>tableview</code>è«åå¥‡å¦™çš„åç§»20ptæˆ–è€…64ptäº†ã€‚ã€‚åŸå› æ˜¯iOS11å¼ƒç”¨äº†<code>automaticallyAdjustsScrollViewInsets</code>å±æ€§ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯<code>UIScrollView</code>æ–°å¢äº†<code>contentInsetAdjustmentBehavior</code>å±æ€§ï¼Œè¿™ä¸€åˆ‡çš„ç½ªé­ç¥¸é¦–éƒ½æ˜¯æ–°å¼•å…¥çš„<code>safeArea</code>ï¼Œå…³äº<code>safeArea</code>é€‚é…è¿™ç¯‡æ–‡ç« <a href="http://www.jianshu.com/p/efbc8619d56b" target="_blank" rel="external">iOS 11 å®‰å…¨åŒºåŸŸé€‚é…æ€»ç»“</a>è®²çš„å¾ˆè¯¦ç»†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ä¸‹ï¼Œæˆ‘ç›´æ¥è´´é€‚é…ä»£ç ï¼Œå› ä¸ºä½ç‰ˆæœ¬ç›´æ¥ç”¨<code>contentInsetAdjustmentBehavior</code>ä¼šæŠ¥è­¦å‘Šï¼Œæ‰€æœ‰å®šä¹‰äº†å¦‚ä¸‹çš„å®ï¼ˆæ„Ÿè°¢<a href="http://www.jianshu.com/u/634f3d1c7c22" target="_blank" rel="external">@ç‚’é¸¡èŒƒ</a>çš„æŒ‡æ­£ï¼Œä¹‹å‰çš„å®çŠ¯äº†ä¸ªä½çº§é”™è¯¯â€¦ç°æ”¹ä¸ºï¼‰<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#define  adjustsScrollViewInsets(scrollView)\</span></div><div class="line"><span class="keyword">do</span> &#123;\</div><div class="line">_Pragma(<span class="string">"clang diagnostic push"</span>)\</div><div class="line">_Pragma(<span class="string">"clang diagnostic ignored \"-Warc-performSelector-leaks\""</span>)\</div><div class="line"><span class="keyword">if</span> ([scrollView respondsToSelector:<span class="built_in">NSSelectorFromString</span>(<span class="string">@"setContentInsetAdjustmentBehavior:"</span>)]) &#123;\</div><div class="line"><span class="built_in">NSMethodSignature</span> *signature = [<span class="built_in">UIScrollView</span> instanceMethodSignatureForSelector:<span class="keyword">@selector</span>(setContentInsetAdjustmentBehavior:)];\</div><div class="line"><span class="built_in">NSInvocation</span> *invocation = [<span class="built_in">NSInvocation</span> invocationWithMethodSignature:signature];\</div><div class="line"><span class="built_in">NSInteger</span> argument = <span class="number">2</span>;\</div><div class="line">invocation.target = scrollView;\</div><div class="line">invocation.selector = <span class="keyword">@selector</span>(setContentInsetAdjustmentBehavior:);\</div><div class="line">[invocation setArgument:&amp;argument atIndex:<span class="number">2</span>];\</div><div class="line">[invocation retainArguments];\</div><div class="line">[invocation invoke];\</div><div class="line">&#125;\</div><div class="line">_Pragma(<span class="string">"clang diagnostic pop"</span>)\</div><div class="line">&#125; <span class="keyword">while</span> (<span class="number">0</span>)</div></pre></td></tr></table></figure></p>
<p>è¿˜æœ‰çš„å‘ç°æŸäº›ç•Œé¢<code>tableView</code>çš„<code>sectionHeader</code>ã€<code>sectionFooter</code>é«˜åº¦ä¸è®¾ç½®ä¸ç¬¦çš„é—®é¢˜ï¼Œåœ¨iOS11ä¸­å¦‚æœä¸å®ç° <code>-tableView: viewForHeaderInSection:</code>å’Œ<code>-tableView: viewForFooterInSection:</code> ï¼Œåˆ™<code>-tableView: heightForHeaderInSection:</code>å’Œ<code>- tableView: heightForFooterInSection:</code>ä¸ä¼šè¢«è°ƒç”¨ï¼Œå¯¼è‡´å®ƒä»¬éƒ½å˜æˆäº†é»˜è®¤é«˜åº¦ï¼Œè¿™æ˜¯å› ä¸º<code>tableView</code>åœ¨iOS11é»˜è®¤ä½¿ç”¨<code>Self-Sizing</code>ï¼Œ<code>tableView</code>çš„<code>estimatedRowHeight</code>ã€<code>estimatedSectionHeaderHeight</code>ã€ <code>estimatedSectionFooterHeight</code>ä¸‰ä¸ªé«˜åº¦ä¼°ç®—å±æ€§ç”±é»˜è®¤çš„0å˜æˆäº†<code>UITableViewAutomaticDimension</code>ï¼Œè§£å†³åŠæ³•ç®€å•ç²—æš´ï¼Œå°±æ˜¯åœ¨å¯¹åº”ç•Œé¢å®ç°å¯¹åº”æ–¹æ³•æˆ–æŠŠ<code>tableView</code>çš„è¿™ä¸‰ä¸ªå±æ€§è®¾ä¸º0ã€‚å¦‚æœä½ æƒ³å…¨å±€å…³é—­<code>Self-Sizing</code>å¯ä½¿ç”¨ä¸‹é¢è¿™æ®µä»£ç ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">UITableView</span>.appearance.estimatedRowHeight = <span class="number">0</span>; </div><div class="line"><span class="built_in">UITableView</span>.appearance.estimatedSectionFooterHeight = <span class="number">0</span>;</div><div class="line"><span class="built_in">UITableView</span>.appearance.estimatedSectionHeaderHeight = <span class="number">0</span>;</div></pre></td></tr></table></figure></p>
<p>å¦‚æœä½ ä½¿ç”¨äº†<code>Masonry</code>ï¼ŒæŸäº›ç•Œé¢éœ€è¦é€‚é…éœ€è¦é€‚é…<code>safeArea</code>ï¼Œå¯ä»¥è¯•è¯•ä¸‹é¢è¿™æ®µä»£ç <br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (@available(iOS <span class="number">11.0</span>, *)) &#123;</div><div class="line">    make.edges.equalTo()(<span class="keyword">self</span>.view.safeAreaInsets)</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    make.edges.equalTo()(<span class="keyword">self</span>.view)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="ç›¸å†Œè®¿é—®æƒé™"><a href="#ç›¸å†Œè®¿é—®æƒé™" class="headerlink" title="ç›¸å†Œè®¿é—®æƒé™"></a>ç›¸å†Œè®¿é—®æƒé™</h3><p>çœ‹å…¶ä»–é€‚é…æ–‡ç« ä¸Šå¯¹iOS11ç›¸å†Œæƒé™è°ƒæ•´çš„è¯´æ˜æ˜¯â€œiOS11æŠŠ <a href="https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html#//apple_ref/doc/uid/TP40009251-SW17" target="_blank" rel="external">NSPhotoLibraryUsageDescription</a> æ›¿æ¢æˆäº†<a href="https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html#//apple_ref/doc/uid/TP40009251-SW73" target="_blank" rel="external">NSPhotoLibraryAddUsageDescription</a>â€ï¼Œå¥‡æ€ªçš„æ˜¯æˆ‘çš„é¡¹ç›®å¹¶æ²¡æœ‰æ·»åŠ <code>NSPhotoLibraryAddUsageDescription</code>ï¼Œåœ¨è®¿é—®ç›¸å†Œæ—¶ä¹Ÿæ²¡å‘ç”Ÿcrashï¼Œåæ¥åœ¨ä»”ç»†é˜…è¯»äº†å®˜æ–¹æ–‡æ¡£æ‰å‘ç°<code>NSPhotoLibraryAddUsageDescription</code>åªé’ˆå¯¹ç›¸å†Œå­˜å‚¨æƒé™ï¼Œåœ¨iOS11ä¸Šç³»ç»Ÿé»˜è®¤æ‰“å¼€äº†ç”¨æˆ·ç›¸å†Œçš„è®¿é—®æƒé™ï¼Œå¦‚æœåº”ç”¨éœ€è¦å­˜å‚¨æƒé™å°±éœ€è¦æ·»åŠ è¿™ä¸ªkeyï¼Œå¦åˆ™å°±ä¼šcrashã€‚</p>
<h3 id="AppIcon"><a href="#AppIcon" class="headerlink" title="AppIcon"></a>AppIcon</h3><p>åœ¨iOS11ä¸Šå‘ç°äº†ä¸€ä¸ªå¥‡æ€ªçš„ç°è±¡ï¼ŒAPPåœ¨å¯åŠ¨å›¾æ ‡ä¼šå‡ºç°é»‘è¾¹ï¼Œå¦‚å›¾ï¼ˆå¤„å¥³åº§å®åœ¨å¿ä¸äº†â€¦ï¼‰<br><img src="http://owgqmweju.bkt.clouddn.com/17-10-23/31263530.jpg" alt="å›¾2"><br>åŸå› æ˜¯iOS11ä¿®æ”¹äº†Appå¯åŠ¨åŠ¨ç”»ï¼Œå¦‚æœä½ çš„Appå›¾æ ‡æœ‰åœ†è§’é‚£ä¹ˆå°±ä¼šå˜æˆè¿™ä¸ªé¸Ÿæ ·äº†â€¦æ‰€æœ‰å›¾æ ‡éƒ½æ¢æˆç›´è§’å°±å¥½äº†ï¼Œå…·ä½“è§„èŒƒè§<a href="https://developer.apple.com/design/" target="_blank" rel="external">Human Interface Guidelines-App Icon</a>ï¼Œè¿˜æ˜¯è¦å¬è‹¹æœçˆ¸çˆ¸çš„è¯å•Šâ€¦</p>
<h3 id="iPhoneX"><a href="#iPhoneX" class="headerlink" title="iPhoneX"></a>iPhoneX</h3><h4 id="LaunchImage"><a href="#LaunchImage" class="headerlink" title="LaunchImage"></a>LaunchImage</h4><p>å…³äºiPhoneX(æˆ‘å°±ä¸åæ§½åˆ˜æµ·äº†â€¦)ï¼Œå¦‚æœä½ çš„APPåœ¨iPhoneXä¸Šè¿è¡Œå‘ç°æ²¡æœ‰å……æ»¡å±å¹•ï¼Œä¸Šä¸‹æœ‰é»‘è‰²åŒºåŸŸï¼Œé‚£ä¹ˆä½ åº”è¯¥ä¹Ÿåƒæˆ‘ä¸€æ ·<code>LaunchImage</code>æ²¡æœ‰ç”¨<code>storyboard</code>è€Œæ˜¯ç”¨çš„<code>Assets</code>ï¼Œè§£å†³åŠæ³•å¦‚å›¾ï¼Œå¯åŠ¨å›¾çš„å°ºå¯¸ä¸º<code>1125x2436</code>ï¼Œor you can <a href="http://www.jianshu.com/p/77054dccafdb" target="_blank" rel="external">iOSå¼€å‘æ—¶å¦‚ä½•ä½¿ç”¨ Launch Screen Storyboard</a>ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/702870-71705661b4518de5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾2"></p>
<h4 id="TabBarController"><a href="#TabBarController" class="headerlink" title="TabBarController"></a>TabBarController</h4><p>å¦‚æœä½ ä½¿ç”¨äº†åŸç”ŸtabBarï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€‚é…ï¼Œå› ä¸ºæˆ‘ä»¬çš„é¡¹ç›®ç”¨äº†ç¬¬ä¸‰æ–¹çš„<code>TabBarController</code>ï¼Œåœ¨iPhoneXè¿è¡Œï¼ŒtabBarçœ‹èµ·æ¥æ€ªæ€ªçš„(<strong>å¦‚æœä¸ç¡®å®šä½ çš„é¡¹ç›®tabBaråœ¨iPhoneXä¸Šçœ‹èµ·æ¥æ˜¯å¦æ­£å¸¸ï¼Œå¯ä»¥å‚ç…§æ¨¡æ‹Ÿå™¨çš„ç…§ç‰‡APPï¼Œä¸€çœ‹ä¾¿çŸ¥</strong>)â€¦ä¼°è®¡ä½œè€…è¦ç­‰åˆ°çŒ´å¹´é©¬æœˆæ‰é€‚é…iPhoneXï¼Œé¡¹ç›®åˆç€æ€¥ä¸Šçº¿ï¼Œå°±è‡ªå·±æ”¹äº†ä¸‹ï¼Œä¸»è¦æ˜¯<code>tabBar</code>é«˜åº¦åŠ<code>tabBarItem</code>åç§»é€‚é…ï¼ŒiPhoneXç”±äºåº•éƒ¨å®‰å…¨åŒºçš„åŸå› <code>UITabBar</code>é«˜åº¦ç”±49ptå˜æˆäº†83ptï¼Œå¤šå‡ºæ¥çš„34ptæ˜¯ç©ºç™½æ‰‹åŠ¿åŒºåŸŸã€‚å¯ä»¥é€šè¿‡åˆ¤æ–­æœºå‹æ¥ä¿®æ”¹ç›¸å…³ç•Œé¢ä»£ç ï¼Œæ–¹å¼æœ‰ä¸¤ç§ï¼Œé€šè¿‡åˆ†è¾¨ç‡åˆ¤æ–­ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#define kDevice_Is_iPhoneX ([UIScreen instancesRespondToSelector:@selector(currentMode)] ? CGSizeEqualToSize(CGSizeMake(1125, 2436), [[UIScreen mainScreen] currentMode].size) : NO)</span></div></pre></td></tr></table></figure></p>
<p>é€šè¿‡è®¾å¤‡åç§°åˆ¤æ–­ï¼š<br>@â€iPhone10,1â€ : @â€iPhone 8â€,<br>@â€iPhone10,4â€ : @â€iPhone 8â€,<br>@â€iPhone10,2â€ : @â€iPhone 8 Plusâ€,<br>@â€iPhone10,5â€ : @â€iPhone 8 Plusâ€,<br>@â€iPhone10,3â€ : @â€iPhone Xâ€,<br>@â€iPhone10,6â€ : @â€iPhone Xâ€,<br>è¿™é‡Œæ¨èä½¿ç”¨<a href="https://github.com/squarefrog/UIDeviceIdentifier" target="_blank" rel="external">UIDeviceIdentifier</a>ã€‚</p>
<p>ç›®å‰é‡åˆ°çš„å°±è¿™äº›å‘ï¼Œæ¬¢è¿å¤§å®¶æŒ‡æ­£è¡¥å……~</p>
<p>ä½œä¸ºä¸€åiOSå¼€å‘äººå‘˜ï¼Œæƒ³åˆ°å½“å¹´å˜²ç¬‘Androidå¼€å‘è›‹ç–¼çš„é€‚é…å„ç§æœºå‹å¿ƒæƒ…å¦‚å›¾â€¦<br><img src="http://upload-images.jianshu.io/upload_images/702870-4db780c96ed7f4b5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>æœ€åå¥‰ä¸ŠWWDCå®˜æ–¹è§†é¢‘ï¼š</p>
<p><a href="https://developer.apple.com/videos/play/wwdc2017/204/" target="_blank" rel="external">Updating Your App for iOS 11</a></p>
<p><a href="https://developer.apple.com/videos/play/fall2017/201/" target="_blank" rel="external">Building Apps for iPhone X</a></p>
<p><a href="https://developer.apple.com/videos/play/fall2017/801/" target="_blank" rel="external">Designing for iPhone X</a></p>
]]></content>
      
        
        <tags>
            
            <tag> é€‚é…iOS11 </tag>
            
            <tag> é€‚é…iPhoneX </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[åœ¨å¯¹è±¡deallocæ—¶åšä¸€äº›æ“ä½œ]]></title>
      <url>/2017/07/28/%E5%9C%A8%E5%AF%B9%E8%B1%A1dealloc%E6%97%B6%E5%81%9A%E4%B8%80%E4%BA%9B%E6%93%8D%E4%BD%9C/</url>
      <content type="html"><![CDATA[<p>æœ€è¿‘åšç›´æ’­é—´ä¼˜åŒ–æ—¶é‡åˆ°ä¸ªå¥‡è‘©éœ€æ±‚ï¼Œéœ€è¦åœ¨è¯„è®ºè¾“å…¥è§†å›¾é‡Šæ”¾æ—¶åšä¸€äº›æ“ä½œï¼Œå½“æ—¶æ²¡æƒ³å¤ªå¤šç›´æ¥åœ¨CommentViewå¤–éƒ¨å…¬å¼€ä¸€ä¸ªblockï¼Œç„¶ååœ¨CommentViewçš„<code>dealloc</code>æ–¹æ³•é‡Œè°ƒç”¨è¯¥blockï¼Œç®€å•ç²—æš´â€¦<a id="more"></a>äº‹åæƒ³äº†æƒ³èƒ½ä¸èƒ½å°è£…ä¸€ä¸ªé€šç”¨çš„æ–¹æ³•ç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªé‡Šæ”¾æ—¶è°ƒç”¨çš„blockå‘¢ï¼Ÿç¬¬ä¸€æ—¶é—´æƒ³åˆ°ç”¨Method Swizzlingæ¥hookå¯¹è±¡çš„<code>dealloc</code>æ–¹æ³•ï¼Œé©¬ä¸Šé¢†æ‚Ÿåˆ°è¿™æ ·æœªå…ä¾µå…¥æ€§å¤ªå¼ºï¼Œæ—¥åä¹Ÿè®¸ä¼šå¯¼è‡´éš¾ä»¥æ’æŸ¥çš„bugï¼Œä»”ç»†æ€è€ƒåæƒ³åˆ°äº†ä¸€ä¸ªå·§å¦™çš„æ–¹æ³•ï¼Œé€šè¿‡Categoryç»™<code>NSObject</code>å…¬å¼€ä¸€ä¸ªæ·»åŠ blockçš„æ–¹æ³•ï¼Œåˆ©ç”¨runtimeçš„AssociatedObjectç»™å¯¹è±¡æ­é…ä¸€ä¸ªâ€˜â€˜å°ä¼™ä¼´â€™â€™ï¼Œåœ¨å¯¹è±¡é‡Šæ”¾æ—¶ï¼Œè¿™ä¸ªâ€˜â€˜å°ä¼™ä¼´â€™â€™è´Ÿè´£è°ƒç”¨blockï¼Œè¿™æ ·æ—¢åšåˆ°äº†ä¸å¯¹è±¡çš„å…±å­˜äº¡åˆç®€å•å¹²å‡€ï¼Œä¸Šä»£ç ~<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^DeallocBlock)(<span class="keyword">void</span>);</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSObject</span> (<span class="title">Associate</span>)</span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">ç»™å¯¹è±¡æ·»åŠ é‡Šæ”¾æ—¶è°ƒç”¨çš„block</div><div class="line">*/</div><div class="line">- (<span class="keyword">void</span>)addDeallocBlock:(DeallocBlock)deallocBlock;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"NSObject+Associate.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Partner</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) DeallocBlock deallocBlock;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Partner</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)dealloc &#123;</div><div class="line">    <span class="keyword">if</span> (_deallocBlock) &#123;</div><div class="line">        _deallocBlock();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">void</span> *kPartnerArrayKey = &amp;kPartnerArrayKey;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">Associate</span>)</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)addDeallocBlock:(DeallocBlock)deallocBlock &#123;</div><div class="line">    <span class="keyword">@synchronized</span> (<span class="keyword">self</span>) &#123;</div><div class="line">        <span class="built_in">NSMutableArray</span> *partnerArray = objc_getAssociatedObject(<span class="keyword">self</span>, kPartnerArrayKey);</div><div class="line">        <span class="keyword">if</span> (!partnerArray) &#123;</div><div class="line">            partnerArray = [<span class="built_in">NSMutableArray</span> array];</div><div class="line">            objc_setAssociatedObject(<span class="keyword">self</span>, kPartnerArrayKey, partnerArray, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">        &#125;</div><div class="line">        Partner *partner = [[Partner alloc] init];</div><div class="line">        partner.deallocBlock = deallocBlock;</div><div class="line">        [partnerArray addObject:partner];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰å‡ ç‚¹<strong>æ³¨æ„äº‹é¡¹</strong>ï¼š<br>1.blockè§¦å‘æ—¶çš„çº¿ç¨‹ä¸å¯¹è±¡é‡Šæ”¾æ—¶çš„çº¿ç¨‹ä¸€è‡´ï¼Œæ³¨æ„åç»­æ“ä½œçš„çº¿ç¨‹å®‰å…¨ã€‚<br>2.å¦‚æœä½ æƒ³åœ¨blocké‡Œå¼•ç”¨å¯¹è±¡ï¼Œé‚£ä¹ˆæ— è®ºå¼ºå¼±å¼•ç”¨éƒ½æ˜¯ä¸å¯è¡Œçš„ï¼Œå¼ºå¼•ç”¨ä¼šé€ æˆå¾ªç¯å¼•ç”¨ï¼Œå¼±å¼•ç”¨åˆ™è·å–ä¸åˆ°å¯¹è±¡ï¼Œå› ä¸ºå·²ç»è¢«è‡³ä¸ºnilï¼Œå¯ä»¥ä½¿ç”¨<code>__unsafe_unretained</code>ä¿®é¥°ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">__<span class="keyword">unsafe_unretained</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) unsafeSelf = <span class="keyword">self</span>;</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨çœ‹èµ·æ¥æ¯”æœ€å¼€å§‹çš„ç›´æ¥åœ¨CommentViewçš„deallocé‡Œåšæ“ä½œçš„æƒ³æ³•æˆç†Ÿå¤šäº†ï¼Œä½†ä¹‹åæˆ‘å†æŸ¥é˜…ç›¸å…³èµ„æ–™æ—¶è¿˜æ˜¯å‘ç°è‡ªå·±<em>too young too native</em>äº†â€¦å…¶å®æ—©å°±æœ‰å¤§ä½¬å†™äº†ç±»ä¼¼çš„æ¡†æ¶ï¼Œæ”¾ä¸ªé“¾æ¥ä¾›å¤§å®¶è†œ<a href="https://github.com/ChenYilong/CYLDeallocBlockExecutor#%E4%BD%BF%E7%94%A8cyldeallocblockexecutor" target="_blank" rel="external">CYLDeallocBlockExecutor</a>ï¼Œä»£ç ä¸æ˜¯å¾ˆå¤æ‚ï¼Œä½†æ˜¯è€ƒè™‘çš„ç‚¹å’Œå®ç°æ€è·¯å¾ˆèµï¼Œä¹Ÿè®¸è¿™å°±æ˜¯å·®è·å§â€¦å…¶ä¸­æ¶‰åŠåˆ°äº†<code>NSHashTable</code>ï¼Œä¸äº†è§£çš„å¯ä»¥çœ‹å—å¤§çš„<a href="http://southpeak.github.io/2015/05/10/ios-techset-1/" target="_blank" rel="external">iOSçŸ¥è¯†å°é›† ç¬¬1æœŸ(2015.05.10)-NSHashTableéƒ¨åˆ†</a>ã€‚</p>
]]></content>
      
        
        <tags>
            
            <tag> runitme </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Runtimeå­¦ä¹ æ€»ç»“ï¼ˆä¸€ï¼‰]]></title>
      <url>/2017/07/09/Runtime%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      <content type="html"><![CDATA[<p><code>Runtime</code>åœ¨ä¸šå†…æœ‰iOSå¼€å‘â€˜â€˜é»‘ç§‘æŠ€â€™â€™ä¹‹ç§°ï¼Œä½†åœ¨å¹³æ—¶å¼€å‘ä¸­ä¹Ÿå°±æ¥è§¦äº†<code>Method Swizzling</code>ï¼Œ<code>AssociatedObject</code>è¿™å‡ ç§åº”ç”¨ï¼Œç”¨äº†è¿™ä¹ˆä¹…OCï¼Œå´å¯¹å®ƒçš„å†…åœ¨ä¸€æ— æ‰€çŸ¥ï¼Œå®åœ¨è¯´ä¸è¿‡å»â€¦ä»Šå¤©æˆ‘æ¥æ€»ç»“ä¸€ä¸‹æœ€è¿‘å­¦ä¹ <code>runtime</code>çš„çŸ¥è¯†ç‚¹ï¼Œçœ‹çœ‹å®ƒç©¶ç«Ÿâ€˜â€˜é»‘â€™â€™åœ¨å“ªé‡Œã€‚</p>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“Objective-Cæ˜¯ä¸€é—¨åŠ¨æ€è¯­è¨€ï¼Œå¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶åˆ›å»ºï¼Œæ£€æŸ¥ï¼Œä¿®æ”¹ç±»ã€å¯¹è±¡å’Œå®ƒä»¬çš„æ–¹æ³•ï¼Œè¿™ä¸€åˆ‡éƒ½å½’åŠŸäº<code>runtime</code>ï¼Œå®ƒæ˜¯ç”¨Cå’Œæ±‡ç¼–å†™çš„åº“ï¼Œè¿™ä¸ªåº“ä½¿Cå…·æœ‰äº†é¢å‘å¯¹è±¡çš„èƒ½åŠ›ã€‚æ€»ç»“èµ·æ¥ï¼Œ<code>Runtime</code>åº“ä¸»è¦åšäº†å‡ ä»¶äº‹:</p>
<ul>
<li>å°è£…ï¼šç”¨Cçš„ç»“æ„ä½“è¡¨ç¤ºOCçš„å¯¹è±¡ï¼Œç”¨Cçš„å‡½æ•°å®ç°OCçš„æ–¹æ³•ï¼Œè¿™äº›ç»“æ„ä½“å’Œå‡½æ•°è¢«<code>runtime</code>å‡½æ•°å°è£…åï¼ŒOCå°±å…·æœ‰äº†åŠ¨æ€çš„ç‰¹æ€§ã€‚</li>
<li>æ”¶å‘æ¶ˆæ¯ï¼šåœ¨å¯¹è±¡æ‰§è¡ŒæŸä¸ªæ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•è¢«<code>runtime</code>å½“åšä¸€æ¡æ¶ˆæ¯å‘é€ç»™æ¥æ”¶è€…ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡ï¼Œ<code>Runtime</code>ä¼šæ ¹æ®æ¥æ”¶è€…èƒ½å¦å“åº”è¯¥æ¶ˆæ¯è€Œåšå‡ºä¸åŒçš„ååº”ã€‚  </li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ä¸‹å¹³æ—¶å†ç†Ÿæ‚‰ä¸è¿‡çš„ç±»ä¸å¯¹è±¡ã€æˆå‘˜å˜é‡ä¸å±æ€§çš„æ•°æ®ç»“æ„å’Œæ“ä½œå‡½æ•°ã€‚<br><a id="more"></a></p>
<h2 id="ç±»ä¸å¯¹è±¡"><a href="#ç±»ä¸å¯¹è±¡" class="headerlink" title="ç±»ä¸å¯¹è±¡"></a>ç±»ä¸å¯¹è±¡</h2><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><h4 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h4><p>é€šè¿‡<code>objc.h</code>ä¸<code>runtime.h</code>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªæŒ‡å‘objc_classç»“æ„ä½“çš„æŒ‡é’ˆClassï¼Œä¹Ÿå°±æ˜¯OCä¸­çš„ç±»</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_class *Class;</div><div class="line"><span class="comment">// ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹</span></div><div class="line"><span class="keyword">struct</span> objc_class &#123;</div><div class="line">    Class isa  OBJC_ISA_AVAILABILITY;</div><div class="line">    </div><div class="line"><span class="meta">#if !__OBJC2__</span></div><div class="line">    Class super_class                   	OBJC2_UNAVAILABLE;	<span class="comment">// çˆ¶ç±»</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name                      	OBJC2_UNAVAILABLE;	<span class="comment">// ç±»å</span></div><div class="line">    <span class="keyword">long</span> version                          	OBJC2_UNAVAILABLE;	<span class="comment">// ç±»ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º0</span></div><div class="line">    <span class="keyword">long</span> info                            	OBJC2_UNAVAILABLE;	<span class="comment">// ç±»ä¿¡æ¯ï¼Œä¾›è¿è¡Œæ—¶ä½¿ç”¨çš„ä¸€äº›ä½æ ‡è¯†</span></div><div class="line">    <span class="keyword">long</span> instance_size                   	OBJC2_UNAVAILABLE;	<span class="comment">// å®ä¾‹å˜é‡å¤§å°</span></div><div class="line">    <span class="keyword">struct</span> objc_ivar_list *ivars         	OBJC2_UNAVAILABLE;	<span class="comment">// æˆå‘˜å˜é‡åˆ—è¡¨</span></div><div class="line">    <span class="keyword">struct</span> objc_method_list **methodLists 	OBJC2_UNAVAILABLE;	<span class="comment">// æ–¹æ³•åˆ—è¡¨</span></div><div class="line">    <span class="keyword">struct</span> objc_cache *cache              	OBJC2_UNAVAILABLE;	<span class="comment">// æ–¹æ³•ç¼“å­˜</span></div><div class="line">    <span class="keyword">struct</span> objc_protocol_list *protocols 	OBJC2_UNAVAILABLE;	<span class="comment">// åè®®åˆ—è¡¨</span></div><div class="line"><span class="meta">#endif</span></div><div class="line">&#125; OBJC2_UNAVAILABLE;</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹è¿™å‡ ä¸ªå­—æ®µï¼š</p>
<ul>
<li><code>isa</code>ï¼šæˆ‘ä»¬çŸ¥é“OCä¸­å¯¹è±¡çš„<code>isa</code>æŒ‡å‘ç±»ï¼ŒåŒæ ·ç±»ä¹Ÿæœ‰ä¸€ä¸ª<code>isa</code>æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘<code>meta Class</code>(å…ƒç±»)ï¼Œè¿™é‡Œç±»ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚</li>
<li><code>super_class</code>ï¼šæŒ‡å‘è¯¥ç±»çš„çˆ¶ç±»ï¼Œå¦‚æœè¯¥ç±»å·²ç»æ˜¯<code>Root Class</code>(å¦‚<code>NSObject</code>æˆ–<code>NSProxy</code>)ï¼Œåˆ™<code>super_class</code>ä¸º<code>NULL</code>ã€‚</li>
<li><p><code>cache</code>ï¼šè¯¥å­—æ®µç”¨äºç¼“å­˜è°ƒç”¨è¿‡çš„æ–¹æ³•ã€‚<code>cache</code>æŒ‡é’ˆæŒ‡å‘<code>objc_cache</code>ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> objc_cache &#123;</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> mask <span class="comment">/* total = mask + 1 */</span> OBJC2_UNAVAILABLE; <span class="comment">// æŒ‡å®šåˆ†é…ç¼“å­˜bucketçš„æ€»æ•°ã€‚runtimeä½¿ç”¨è¿™ä¸ªå­—æ®µç¡®å®šçº¿æ€§æŸ¥æ‰¾æ•°ç»„çš„ç´¢å¼•ä½ç½®</span></div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> occupied OBJC2_UNAVAILABLE; <span class="comment">// å®é™…å ç”¨ç¼“å­˜bucketæ€»æ•°</span></div><div class="line">    Method buckets[<span class="number">1</span>] OBJC2_UNAVAILABLE; <span class="comment">// æŒ‡å‘Methodæ•°æ®ç»“æ„æŒ‡é’ˆçš„æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„çš„å…ƒç´ æ€»æ•°ä¸èƒ½è¶…è¿‡mask+1ï¼Œå¦‚æœä¸ºç©ºåˆ™è¡¨ç¤ºç¼“å­˜bucketæ²¡æœ‰è¢«å ç”¨ï¼Œå®ƒæœ‰å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œä¼šéšç€æ—¶é—´è€Œå˜å¤§ã€‚</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>å½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šè¢«æ”¾åˆ°<code>cache</code>ä¸­ï¼Œä¸‹æ¬¡è°ƒç”¨<code>runtime</code>å°±ä¼šä¼˜å…ˆå»<code>cache</code>ä¸­æŸ¥æ‰¾ï¼Œè¿™æ ·å°±é¿å…äº†æ¯æ¬¡éƒ½ç›´æ¥å»<code>methodLists</code>ä¸­æŸ¥æ‰¾ï¼Œæé«˜äº†æ•ˆç‡ã€‚</p>
</li>
</ul>
<h4 id="objc-object"><a href="#objc-object" class="headerlink" title="objc_object"></a>objc_object</h4><p>çœ‹å®Œäº†<code>Class</code>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹å¯¹è±¡ï¼Œå‚è€ƒ<code>objc-private.h</code>éƒ¨åˆ†æºç ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> objc_object &#123;</div><div class="line">private:</div><div class="line">    isa_t isa;</div><div class="line"></div><div class="line">public:</div><div class="line">    <span class="comment">// ISA() assumes this is NOT a tagged pointer object</span></div><div class="line">    Class ISA();</div><div class="line"></div><div class="line">    <span class="comment">// getIsa() allows this to be a tagged pointer object</span></div><div class="line">    Class getIsa();</div><div class="line"></div><div class="line">    <span class="comment">// initIsa() should be used to init the isa of new objects only.</span></div><div class="line">    <span class="comment">// If this object already has an isa, use changeIsa() for correctness.</span></div><div class="line">    <span class="comment">// initInstanceIsa(): objects with no custom RR/AWZ</span></div><div class="line">    <span class="comment">// initClassIsa(): class objects</span></div><div class="line">    <span class="comment">// initProtocolIsa(): protocol objects</span></div><div class="line">    <span class="comment">// initIsa(): other objects</span></div><div class="line">    <span class="keyword">void</span> initIsa(Class cls <span class="comment">/*nonpointer=false*/</span>);</div><div class="line">    <span class="keyword">void</span> initClassIsa(Class cls <span class="comment">/*nonpointer=maybe*/</span>);</div><div class="line">    <span class="keyword">void</span> initProtocolIsa(Class cls <span class="comment">/*nonpointer=maybe*/</span>);</div><div class="line">    <span class="keyword">void</span> initInstanceIsa(Class cls, <span class="keyword">bool</span> hasCxxDtor);</div><div class="line">    <span class="comment">// çœç•¥å…¶ä»–æ–¹æ³•å£°æ˜...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_object *<span class="keyword">id</span>;</div></pre></td></tr></table></figure></p>
<p><code>objc_object</code>ç»“æ„ä½“åŒ…å«ä¸€ä¸ªç±»å‹ä¸º<code>isa_t</code>çš„<code>isa</code>æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„æŒ‡å‘è¿™ä¸ªå¯¹è±¡æ‰€å±ç±»çš„æŒ‡é’ˆã€‚publiché‡Œé¢å®šä¹‰äº†ä¸€äº›æ“ä½œ<code>isa</code>çš„æ–¹æ³•ã€‚<code>Runtime</code>åº“ä¼šåœ¨è¯¥ç±»çš„æ–¹æ³•åˆ—è¡¨åŠçˆ¶ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­å»å¯»æ‰¾ä¸æ¶ˆæ¯å¯¹åº”çš„<code>selector</code>ï¼Œæ‰¾åˆ°åå³æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚<br>ä¸‹é¢çš„<code>id</code>æ˜¯ä¸€ä¸ª<code>objc_object</code>ç»“æ„ä½“ç±»å‹çš„æŒ‡é’ˆï¼Œè¿™ä¸ªç±»å‹çš„å¯¹è±¡èƒ½å¤Ÿè½¬æ¢æˆä»»æ„ç±»å‹çš„å¯¹è±¡ï¼Œç±»ä¼¼äºCè¯­è¨€ä¸­void *æŒ‡é’ˆçš„ä½œç”¨ã€‚<br>è¿™é‡Œæœ‰ä¸€ç‚¹è¦ç‰¹æ®Šè¯´æ˜ï¼Œå…¶å®<code>isa</code>å¹¶ä¸æ€»æ˜¯æŒ‡å‘å®ä¾‹å¯¹è±¡æ‰€å±çš„ç±»ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨KVOæ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªä¸­é—´ç±»ï¼Œç³»ç»Ÿä¼šé€šè¿‡<code>isa-swizzling</code>æŠŠ<code>isa</code>æŒ‡å‘è¿™ä¸ªç±»è€Œä¸æ˜¯çœŸå®çš„ç±»ï¼Œæ‰€ä»¥ä¸èƒ½ä¾é å®ƒæ¥ç¡®å®šç±»å‹ï¼Œè€Œåº”è¯¥ç”¨<code>class</code>æ–¹æ³•æ¥ç¡®å®šå®ä¾‹å¯¹è±¡çš„ç±»ã€‚è¯¦è§<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/KeyValueObserving/Articles/KVOImplementation.html" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<h4 id="Meta-Class"><a href="#Meta-Class" class="headerlink" title="Meta Class"></a>Meta Class</h4><p>ä¸Šé¢æˆ‘ä»¬è¯´åˆ°ç±»æœ¬èº«ä¹Ÿæ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆä»–çš„<code>isa</code>æŒ‡å‘è°å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å…ƒç±»<code>Meta Class</code>ã€‚å½“æˆ‘ä»¬å‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯æ—¶ï¼Œ<code>runtime</code>ä¼šåœ¨è¿™ä¸ªå¯¹è±¡æ‰€å±ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾æ–¹æ³•ï¼Œè€Œå‘ä¸€ä¸ªç±»å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šåœ¨è¿™ä¸ªç±»çš„<code>Meta Class</code>çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾ã€‚<br><code>Meta Class</code>å­˜å‚¨ç€ä¸€ä¸ªç±»çš„æ‰€æœ‰ç±»æ–¹æ³•ï¼Œæ¯ä¸ªç±»éƒ½ä¼šæœ‰ä¸€ä¸ªå•ç‹¬çš„<code>Meta Class</code>ï¼Œå› ä¸ºæ¯ä¸ªç±»çš„ç±»æ–¹æ³•åŸºæœ¬ä¸å¯èƒ½å®Œå…¨ç›¸åŒã€‚<br>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ<code>Meta Class</code>çš„<code>isa</code>åˆæŒ‡å‘è°å‘¢ï¼Ÿè¿™ä¹ˆæä¸‹å»å²‚ä¸æ˜¯æ— ç©·æ— å°½â€¦ä¸ºäº†é¿å…è¿™ç§å°´å°¬çš„é—®é¢˜ï¼ŒObjective-Cçš„è®¾è®¡è€…è®©æ‰€æœ‰<code>Meta Class</code>çš„<code>isa</code>éƒ½æŒ‡å‘åŸºç±»ï¼ˆRoot Classï¼‰çš„<code>Meta Class</code>ï¼Œå³æ‰€æœ‰çš„ç±»çš„<code>Meta Class</code>ï¼ŒåŒ…æ‹¬Root Classï¼ŒSuperclassï¼ŒSubclassçš„<code>isa</code>éƒ½æŒ‡å‘Root classçš„<code>Meta Class</code>ï¼Œè€ŒRoot Classçš„<code>Meta Class</code>çš„<code>isa</code>æŒ‡é’ˆåˆæŒ‡å‘äº†å®ƒè‡ªå·±ï¼Œè¿™æ ·å°±å½¢æˆä¸€ä¸ªé—­ç¯ã€‚å¦‚å›¾ï¼š<br><img src="http://owgqmweju.bkt.clouddn.com/17-11-17/86473124.jpg" alt="å›¾1"><br>å†æ¥ä¸€ä¸ªå°demoæ¥éªŒè¯ä¸€ä¸‹ä¸Šå›¾ï¼ˆå–è‡ª<a href="http://blog.sunnyxx.com/2014/11/06/runtime-nuts/" target="_blank" rel="external">ç¥ç»ç—…é™¢objc runtimeå…¥é™¢è€ƒè¯•</a>ï¼‰<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Sark</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Sark</span></span></div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</div><div class="line">     <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">          <span class="built_in">BOOL</span> res1 = [(<span class="keyword">id</span>)[<span class="built_in">NSObject</span> <span class="keyword">class</span>] isKindOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]];</div><div class="line">          <span class="built_in">BOOL</span> res2 = [(<span class="keyword">id</span>)[<span class="built_in">NSObject</span> <span class="keyword">class</span>] isMemberOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]];</div><div class="line">          <span class="built_in">BOOL</span> res3 = [(<span class="keyword">id</span>)[Sark <span class="keyword">class</span>] isKindOfClass:[Sark <span class="keyword">class</span>]];</div><div class="line">          <span class="built_in">BOOL</span> res4 = [(<span class="keyword">id</span>)[Sark <span class="keyword">class</span>] isMemberOfClass:[Sark <span class="keyword">class</span>]];</div><div class="line">          <span class="built_in">NSLog</span>(<span class="string">@"%d %d %d %d"</span>, res1, res2, res3, res4);</div><div class="line">     &#125;</div><div class="line">     <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// ç»“æœä¸º1 0 0 0</span></div></pre></td></tr></table></figure></p>
<p>å…ˆæ¥çœ‹ä¸‹<code>isKindOfClass:</code>,<code>isMemberOfClass:</code>åœ¨<code>Object.mm</code>ä¸­çš„å®ç°ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)isKindOf:aClass &#123;</div><div class="line">     Class cls;</div><div class="line">     <span class="keyword">for</span> (cls = isa; cls; cls = cls-&gt;superclass)</div><div class="line">          <span class="keyword">if</span> (cls == (Class)aClass)</div><div class="line">               <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">     <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)isMemberOf:aClass &#123;</div><div class="line">     <span class="keyword">return</span> isa == (Class)aClass;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬ä»å¤´èµ°ä¸€éï¼Œres1ç¬¬ä¸€æ¬¡clsæ˜¯NSObjectçš„Meta Classï¼Œå› ä¸ºä»–æ˜¯åŸºç±»ï¼Œæ‰€æœ‰ç¬¬äºŒæ¬¡clsåˆæŒ‡å›äº†NSObjectï¼Œè¿”å›YESï¼›res2åªèµ°äº†ä¸€æ¬¡è¿”å›NOï¼›res3ç¬¬ä¸€æ¬¡clsæ˜¯Sarkçš„Meta Classï¼Œç¬¬äºŒæ¬¡clsæ˜¯NSObjectçš„Meta Classï¼Œç¬¬ä¸‰æ¬¡clsæ˜¯NSObjectï¼Œè¿”å›NOï¼›res4æ˜¾ç„¶è¿”å›NOã€‚</p>
<h3 id="æ“ä½œå‡½æ•°"><a href="#æ“ä½œå‡½æ•°" class="headerlink" title="æ“ä½œå‡½æ•°"></a>æ“ä½œå‡½æ•°</h3><h4 id="ç±»æ“ä½œå‡½æ•°"><a href="#ç±»æ“ä½œå‡½æ•°" class="headerlink" title="ç±»æ“ä½œå‡½æ•°"></a>ç±»æ“ä½œå‡½æ•°</h4><p>èŠå®Œç±»ä¸å¯¹è±¡çš„åŸºæœ¬ç»“æ„ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹éƒ½å¯ä»¥å¯¹å®ƒä»¬åšå“ªäº›æ“ä½œã€‚<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// è·å–ç±»å</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * class_getName ( Class cls );</div><div class="line"></div><div class="line"><span class="comment">// è·å–çˆ¶ç±»</span></div><div class="line">Class class_getSuperclass ( Class cls );</div><div class="line"><span class="comment">// è·å–å…ƒç±»</span></div><div class="line">Class objc_getMetaClass( Class cls );</div><div class="line"><span class="comment">// åˆ¤æ–­ç»™å®šçš„Classæ˜¯å¦æ˜¯ä¸€ä¸ªå…ƒç±»</span></div><div class="line"><span class="built_in">BOOL</span> class_isMetaClass ( Class cls );</div><div class="line"></div><div class="line"><span class="comment">// è·å–ç‰ˆæœ¬å·</span></div><div class="line"><span class="keyword">int</span> class_getVersion ( Class cls );</div><div class="line"><span class="comment">// è®¾ç½®ç‰ˆæœ¬å·</span></div><div class="line"><span class="keyword">void</span> class_setVersion ( Class cls, <span class="keyword">int</span> version );</div><div class="line"></div><div class="line"><span class="comment">// è·å–å®ä¾‹å¤§å°</span></div><div class="line">size_t class_getInstanceSize ( Class cls );</div><div class="line"></div><div class="line"><span class="comment">// æˆå‘˜å˜é‡æ“ä½œå‡½æ•°</span></div><div class="line"><span class="comment">// è·å–ç±»ä¸­æŒ‡å®šåç§°å®ä¾‹æˆå‘˜å˜é‡çš„ä¿¡æ¯</span></div><div class="line">Ivar class_getInstanceVariable ( Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name );</div><div class="line"><span class="comment">// è·å–ç±»æˆå‘˜å˜é‡çš„ä¿¡æ¯</span></div><div class="line">Ivar class_getClassVariable ( Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name );</div><div class="line"><span class="comment">// æ·»åŠ æˆå‘˜å˜é‡</span></div><div class="line"><span class="built_in">BOOL</span> class_addIvar ( Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name, size_t size, uint8_t alignment, <span class="keyword">const</span> <span class="keyword">char</span> *types ); </div><div class="line"><span class="comment">// è·å–æ•´ä¸ªæˆå‘˜å˜é‡åˆ—è¡¨</span></div><div class="line">Ivar * class_copyIvarList ( Class cls, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div><div class="line"></div><div class="line"><span class="comment">// å±æ€§æ“ä½œå‡½æ•°</span></div><div class="line"><span class="comment">// è·å–æŒ‡å®šçš„å±æ€§</span></div><div class="line">objc_property_t class_getProperty ( Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name );</div><div class="line"><span class="comment">// è·å–å±æ€§åˆ—è¡¨</span></div><div class="line">objc_property_t * class_copyPropertyList ( Class cls, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div><div class="line"><span class="comment">// æ·»åŠ å±æ€§</span></div><div class="line"><span class="built_in">BOOL</span> class_addProperty ( Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">const</span> objc_property_attribute_t *attributes, <span class="keyword">unsigned</span> <span class="keyword">int</span> attributeCount );</div><div class="line"><span class="comment">// æ›¿æ¢ç±»çš„å±æ€§</span></div><div class="line"><span class="keyword">void</span> class_replaceProperty ( Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">const</span> objc_property_attribute_t *attributes, <span class="keyword">unsigned</span> <span class="keyword">int</span> attributeCount );</div><div class="line"></div><div class="line"><span class="comment">// åè®®æ“ä½œå‡½æ•°</span></div><div class="line"><span class="comment">// æ·»åŠ åè®®</span></div><div class="line"><span class="built_in">BOOL</span> class_addProtocol ( Class cls, Protocol *protocol );</div><div class="line"><span class="comment">// è¿”å›ç±»æ˜¯å¦å®ç°æŒ‡å®šçš„åè®®</span></div><div class="line"><span class="built_in">BOOL</span> class_conformsToProtocol ( Class cls, Protocol *protocol );</div><div class="line"><span class="comment">// è¿”å›ç±»å®ç°çš„åè®®åˆ—è¡¨</span></div><div class="line">Protocol * class_copyProtocolList ( Class cls, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div></pre></td></tr></table></figure></p>
<p><code>Objective-C</code>ä¸æ”¯æŒå¾€å·²å­˜åœ¨çš„ç±»ä¸­æ·»åŠ æˆå‘˜ï¼Œå› æ­¤ä¸ç®¡æ˜¯ç³»ç»Ÿåº“æä¾›çš„ç±»ï¼Œè¿˜æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»ï¼Œéƒ½æ— æ³•åŠ¨æ€æ·»åŠ æˆå‘˜å˜é‡ã€‚æ‰€ä»¥<code>class_addIvar</code>åªæ”¯æŒç»™è¿è¡Œæ—¶åˆ›å»ºçš„éå…ƒç±»æ·»åŠ æˆå‘˜å˜é‡ï¼Œè¿˜éœ€è¦æ³¨æ„è¿™ä¸ªæ–¹æ³•åªèƒ½åœ¨<code>objc_allocateClassPair</code>å‡½æ•°ä¸<code>objc_registerClassPair</code>ä¹‹é—´è°ƒç”¨ã€‚<br>ç±»ä¼¼äº<code>class_copyIvarList</code>,<code>class_getClassVariable</code>çš„å‡½æ•°è¿”å›çš„æ•°ç»„åœ¨ä½¿ç”¨åéœ€è¦ä½¿ç”¨free()æ‰‹åŠ¨é‡Šæ”¾ï¼Œ<code>outCount</code>æŒ‡é’ˆè¿”å›æ•°ç»„çš„å¤§å°ã€‚<br><code>class_conformsToProtocol</code>ç›¸å½“äº<code>conformsToProtocol:</code>æ–¹æ³•ã€‚  </p>
<h4 id="å¯¹è±¡æ“ä½œå‡½æ•°"><a href="#å¯¹è±¡æ“ä½œå‡½æ•°" class="headerlink" title="å¯¹è±¡æ“ä½œå‡½æ•°"></a>å¯¹è±¡æ“ä½œå‡½æ•°</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// è¿”å›æŒ‡å®šå¯¹è±¡çš„ä¸€ä»½æ‹·è´</span></div><div class="line"><span class="keyword">id</span> object_copy ( <span class="keyword">id</span> obj, size_t size );</div><div class="line"><span class="comment">// é‡Šæ”¾æŒ‡å®šå¯¹è±¡å ç”¨çš„å†…å­˜</span></div><div class="line"><span class="keyword">id</span> object_dispose ( <span class="keyword">id</span> obj );</div><div class="line"></div><div class="line"><span class="comment">// ä¿®æ”¹å¯¹è±¡å®ä¾‹å˜é‡çš„å€¼</span></div><div class="line">Ivar object_setInstanceVariable ( <span class="keyword">id</span> obj, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">void</span> *value );</div><div class="line"><span class="comment">// è·å–å¯¹è±¡å®ä¾‹å˜é‡çš„å€¼</span></div><div class="line">Ivar object_getInstanceVariable ( <span class="keyword">id</span> obj, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">void</span> **outValue );</div><div class="line"><span class="comment">// è¿”å›æŒ‡å‘ç»™å®šå¯¹è±¡åˆ†é…çš„ä»»ä½•é¢å¤–å­—èŠ‚çš„æŒ‡é’ˆ</span></div><div class="line"><span class="keyword">void</span> * object_getIndexedIvars ( <span class="keyword">id</span> obj );</div><div class="line"><span class="comment">// ä¿®æ”¹å¯¹è±¡å®ä¾‹å˜é‡çš„å€¼ï¼Œå¦‚æœIvarå·²çŸ¥ï¼Œåˆ™è°ƒç”¨è¯¥å‡½æ•°ä¼šæ¯”object_setInstanceVariableå¿«ï¼Œä¸‹é¢ä¸€æ ·</span></div><div class="line"><span class="keyword">void</span> object_setIvar ( <span class="keyword">id</span> obj, Ivar ivar, <span class="keyword">id</span> value );</div><div class="line"><span class="comment">// è·å–å¯¹è±¡å®ä¾‹å˜é‡çš„å€¼</span></div><div class="line"><span class="keyword">id</span> object_getIvar ( <span class="keyword">id</span> obj, Ivar ivar );</div><div class="line"></div><div class="line"><span class="comment">// è¿”å›å¯¹è±¡çš„ç±»å</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * object_getClassName ( <span class="keyword">id</span> obj );</div><div class="line"><span class="comment">// è¿”å›å¯¹è±¡çš„ç±»</span></div><div class="line">Class object_getClass ( <span class="keyword">id</span> obj );</div><div class="line"><span class="comment">// è®¾ç½®å¯¹è±¡çš„ç±»</span></div><div class="line">Class object_setClass ( <span class="keyword">id</span> obj, Class cls );</div></pre></td></tr></table></figure>
<p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œåœ¨è¿è¡Œæ—¶è½¬æ¢å¯¹è±¡çš„ç±»å‹ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSObject</span> *a = [[<span class="built_in">NSObject</span> alloc] init];</div><div class="line"><span class="keyword">id</span> newB = object_copy(a, class_getInstanceSize(MyClass.class));</div><div class="line">object_setClass(newB, MyClass.class);</div><div class="line">object_dispose(a);</div></pre></td></tr></table></figure></p>
<h4 id="åŠ¨æ€åˆ›å»ºç±»å’Œå¯¹è±¡"><a href="#åŠ¨æ€åˆ›å»ºç±»å’Œå¯¹è±¡" class="headerlink" title="åŠ¨æ€åˆ›å»ºç±»å’Œå¯¹è±¡"></a>åŠ¨æ€åˆ›å»ºç±»å’Œå¯¹è±¡</h4><h5 id="åŠ¨æ€åˆ›å»ºç±»"><a href="#åŠ¨æ€åˆ›å»ºç±»" class="headerlink" title="åŠ¨æ€åˆ›å»ºç±»"></a>åŠ¨æ€åˆ›å»ºç±»</h5><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°ç±»å’Œå…ƒç±»</span></div><div class="line">Class objc_allocateClassPair ( Class superclass, <span class="keyword">const</span> <span class="keyword">char</span> *name, size_t extraBytes ); <span class="comment">// å¦‚æœåˆ›å»ºçš„æ˜¯root classï¼Œåˆ™superclassä¸ºNilã€‚extraBytesé€šå¸¸ä¸º0</span></div><div class="line"><span class="comment">// é”€æ¯ä¸€ä¸ªç±»åŠå…¶ç›¸å…³è”çš„ç±»</span></div><div class="line"><span class="keyword">void</span> objc_disposeClassPair ( Class cls ); <span class="comment">// å¦‚æœç¨‹åºä¸­è¿˜å­˜åœ¨è¯¥ç±»æˆ–å­ç±»çš„å®ä¾‹ï¼Œå°±ä¸èƒ½å¤Ÿè°ƒç”¨è¯¥æ–¹æ³•ã€‚</span></div><div class="line"><span class="comment">// åœ¨åº”ç”¨ä¸­æ³¨å†Œç”±objc_allocateClassPairåˆ›å»ºçš„ç±»</span></div><div class="line"><span class="keyword">void</span> objc_registerClassPair ( Class cls ); <span class="comment">// åˆ›å»ºäº†æ–°ç±»åï¼Œä½¿ç”¨class_addMethodï¼Œclass_addIvarå‡½æ•°ä¸ºæ–°ç±»æ·»åŠ æ–¹æ³•ï¼Œå®ä¾‹å˜é‡å’Œå±æ€§åå†è°ƒç”¨è¿™ä¸ªæ¥æ³¨å†Œç±»ã€‚</span></div></pre></td></tr></table></figure>
<p>ä»£ç ç¤ºä¾‹ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">Class cls = objc_allocateClassPair(MyClass.class, <span class="string">"MySubClass"</span>, <span class="number">0</span>);</div><div class="line"></div><div class="line">class_addMethod(cls, <span class="keyword">@selector</span>(submethod1), (IMP)imp_submethod1, <span class="string">"v@:"</span>);</div><div class="line">class_replaceMethod(cls, <span class="keyword">@selector</span>(method1), (IMP)imp_submethod1, <span class="string">"v@:"</span>);</div><div class="line"></div><div class="line">class_addIvar(cls, <span class="string">"_ivar1"</span>, <span class="keyword">sizeof</span>(<span class="built_in">NSString</span> *), log(<span class="keyword">sizeof</span>(<span class="built_in">NSString</span> *)), <span class="string">"i"</span>);</div><div class="line"></div><div class="line">objc_property_attribute_t type = &#123;<span class="string">"T"</span>, <span class="string">"@\"NSString\""</span>&#125;;</div><div class="line">objc_property_attribute_t ownership = &#123; <span class="string">"C"</span>, <span class="string">""</span> &#125;;</div><div class="line">objc_property_attribute_t backingivar = &#123; <span class="string">"V"</span>, <span class="string">"_ivar1"</span>&#125;;</div><div class="line">objc_property_attribute_t attrs[] = &#123;type, ownership, backingivar&#125;;</div><div class="line">class_addProperty(cls, <span class="string">"property2"</span>, attrs, <span class="number">3</span>);</div><div class="line"></div><div class="line">objc_registerClassPair(cls);</div><div class="line"></div><div class="line"><span class="keyword">id</span> instance = [[cls alloc] init];</div><div class="line">[instance performSelector:<span class="keyword">@selector</span>(submethod1)];</div><div class="line">[instance performSelector:<span class="keyword">@selector</span>(method1)];</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºç»“æœå‡ä¸ºrun sub method 1</span></div></pre></td></tr></table></figure></p>
<h5 id="åŠ¨æ€åˆ›å»ºå¯¹è±¡"><a href="#åŠ¨æ€åˆ›å»ºå¯¹è±¡" class="headerlink" title="åŠ¨æ€åˆ›å»ºå¯¹è±¡"></a>åŠ¨æ€åˆ›å»ºå¯¹è±¡</h5><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// åˆ›å»ºç±»å®ä¾‹</span></div><div class="line"><span class="keyword">id</span> class_createInstance ( Class cls, size_t extraBytes );</div><div class="line"><span class="comment">// åœ¨æŒ‡å®šä½ç½®åˆ›å»ºç±»å®ä¾‹</span></div><div class="line"><span class="keyword">id</span> objc_constructInstance ( Class cls, <span class="keyword">void</span> *bytes );</div><div class="line"><span class="comment">// é”€æ¯ç±»å®ä¾‹</span></div><div class="line"><span class="keyword">void</span> * objc_destructInstance ( <span class="keyword">id</span> obj ); <span class="comment">// ä¸ä¼šé‡Šæ”¾ç§»é™¤ä»»ä½•ä¸è¯¥å®ä¾‹ç›¸å…³çš„å¼•ç”¨</span></div></pre></td></tr></table></figure>
<p><code>class_createInstance</code>ï¼šåˆ›å»ºå®ä¾‹æ—¶ï¼Œä¼šåœ¨é»˜è®¤çš„å†…å­˜åŒºåŸŸä¸ºç±»åˆ†é…å†…å­˜ï¼Œæ— æ³•åœ¨ARCç¯å¢ƒä¸‹ä½¿ç”¨ã€‚è¿™é‡Œå»¶ä¼¸ä¸€ä¸ªçŸ¥è¯†ç‚¹<a href="http://www.jianshu.com/p/bab5e34e5ff0" target="_blank" rel="external">æ·±å…¥ç†è§£allocã€initæ–¹æ³•</a>ï¼Œ<code>class_createInstance</code>æ•ˆæœä¸<code>alloc</code>æ–¹æ³•ç±»ä¼¼ï¼Œæˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> theObject = class_createInstance(<span class="built_in">NSString</span>.class, <span class="keyword">sizeof</span>(<span class="keyword">unsigned</span>));</div><div class="line"> </div><div class="line"><span class="keyword">id</span> str1 = [theObject init];</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [str1 <span class="keyword">class</span>]);</div><div class="line"><span class="keyword">id</span> str2 = [[<span class="built_in">NSString</span> alloc] initWithString:<span class="string">@"test"</span>];</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [str2 <span class="keyword">class</span>]);</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºç»“æœä¸ºNSString,__NSCFConstantString</span></div></pre></td></tr></table></figure></p>
<p>åœ¨ä½¿ç”¨<code>objc_destructInstance</code>å‡½æ•°æ—¶å¹¶ä¸ä¼šé‡Šæ”¾å¹¶ç§»é™¤ä»»ä½•ä¸å…¶ç›¸å…³çš„å¼•ç”¨ã€‚</p>
<h4 id="è·å–ç±»å®šä¹‰"><a href="#è·å–ç±»å®šä¹‰" class="headerlink" title="è·å–ç±»å®šä¹‰"></a>è·å–ç±»å®šä¹‰</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// è·å–å·²æ³¨å†Œçš„ç±»å®šä¹‰çš„åˆ—è¡¨</span></div><div class="line"><span class="keyword">int</span> objc_getClassList ( Class *buffer, <span class="keyword">int</span> bufferCount );</div><div class="line"><span class="comment">// åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘æ‰€æœ‰å·²æ³¨å†Œç±»çš„æŒ‡é’ˆåˆ—è¡¨</span></div><div class="line">Class * objc_copyClassList ( <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div><div class="line"></div><div class="line"><span class="comment">// è¿”å›æŒ‡å®šç±»çš„ç±»å®šä¹‰</span></div><div class="line">Class objc_lookUpClass ( <span class="keyword">const</span> <span class="keyword">char</span> *name );</div><div class="line">Class objc_getClass ( <span class="keyword">const</span> <span class="keyword">char</span> *name );</div><div class="line">Class objc_getRequiredClass ( <span class="keyword">const</span> <span class="keyword">char</span> *name );</div><div class="line"></div><div class="line"><span class="comment">// è¿”å›æŒ‡å®šç±»çš„å…ƒç±»</span></div><div class="line">Class objc_getMetaClass ( <span class="keyword">const</span> <span class="keyword">char</span> *name );</div></pre></td></tr></table></figure>
<h2 id="æˆå‘˜å˜é‡ä¸å±æ€§"><a href="#æˆå‘˜å˜é‡ä¸å±æ€§" class="headerlink" title="æˆå‘˜å˜é‡ä¸å±æ€§"></a>æˆå‘˜å˜é‡ä¸å±æ€§</h2><h3 id="æ•°æ®ç»“æ„-1"><a href="#æ•°æ®ç»“æ„-1" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><h4 id="Ivar"><a href="#Ivar" class="headerlink" title="Ivar"></a>Ivar</h4><p><code>Ivar</code>è¡¨ç¤ºå®ä¾‹å˜é‡çš„ç±»å‹ï¼ŒæŒ‡å‘<code>objc_ivar</code>ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œ<code>ivar</code>æŒ‡é’ˆåœ°å€æ˜¯æ ¹æ®<code>class</code>ç»“æ„ä½“çš„åœ°å€åŠ ä¸ŠåŸºåœ°å€åç§»å­—èŠ‚å¾—åˆ°çš„ã€‚<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_ivar *Ivar;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> objc_ivar &#123;</div><div class="line">    <span class="keyword">char</span> *ivar_name               	OBJC2_UNAVAILABLE;	<span class="comment">// å˜é‡å</span></div><div class="line">    <span class="keyword">char</span> *ivar_type             	OBJC2_UNAVAILABLE;	<span class="comment">// å˜é‡ç±»å‹</span></div><div class="line">    <span class="keyword">int</span> ivar_offset            		OBJC2_UNAVAILABLE;	<span class="comment">// åŸºåœ°å€åç§»å­—èŠ‚</span></div><div class="line"><span class="meta">#ifdef __LP64__</span></div><div class="line">    <span class="keyword">int</span> space                 		OBJC2_UNAVAILABLE;</div><div class="line"><span class="meta">#endif</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="objc-property-tã€objc-property-attribute-t"><a href="#objc-property-tã€objc-property-attribute-t" class="headerlink" title="objc_property_tã€objc_property_attribute_t"></a>objc_property_tã€objc_property_attribute_t</h4><p><code>objc_property_t</code>ï¼šå£°æ˜çš„å±æ€§çš„ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªæŒ‡å‘objc_propertyç»“æ„ä½“çš„æŒ‡é’ˆï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_property *objc_property_t;</div><div class="line">```  </div><div class="line">`objc_property_attribute_t`ï¼šå®šä¹‰äº†å±æ€§çš„ç‰¹æ€§çš„ç»“æ„ä½“ï¼š</div><div class="line">```objc</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name;           <span class="comment">// å±æ€§ç‰¹æ€§å</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *value;          <span class="comment">// å±æ€§ç‰¹æ€§å€¼</span></div><div class="line">&#125; objc_property_attribute_t;</div></pre></td></tr></table></figure></p>
<p>åˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„attribureï¼š</p>
<table>
<thead>
<tr>
<th>attribure</th>
<th>name</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr>
<td>nonatomic</td>
<td>N</td>
<td>ç©º</td>
</tr>
<tr>
<td>strong/retain</td>
<td>&amp;</td>
<td>ç©º</td>
</tr>
<tr>
<td>weak</td>
<td>W</td>
<td>ç©º</td>
</tr>
<tr>
<td>copy</td>
<td>C</td>
<td>ç©º</td>
</tr>
<tr>
<td>å±æ€§çš„ç±»å‹type</td>
<td>T</td>
<td>@â€TypeNameâ€, å¦‚ @â€NSStringâ€</td>
</tr>
<tr>
<td>å±æ€§å¯¹åº”çš„å®ä¾‹å˜é‡Ivar</td>
<td>V</td>
<td>Ivar_name, å¦‚ _name</td>
</tr>
<tr>
<td>readonly</td>
<td>R</td>
<td>ç©º</td>
</tr>
<tr>
<td>getter</td>
<td>G</td>
<td>GetterName, å¦‚ isHighlight</td>
</tr>
<tr>
<td>setter</td>
<td>S</td>
<td>SetterName, å¦‚ setName</td>
</tr>
<tr>
<td>assign/atomic</td>
<td>é»˜è®¤å³ä¸ºassignå’Œatomic</td>
<td>ç©º</td>
</tr>
</tbody>
</table>
<h3 id="æ“ä½œå‡½æ•°-1"><a href="#æ“ä½œå‡½æ•°-1" class="headerlink" title="æ“ä½œå‡½æ•°"></a>æ“ä½œå‡½æ•°</h3><h4 id="æˆå‘˜å˜é‡"><a href="#æˆå‘˜å˜é‡" class="headerlink" title="æˆå‘˜å˜é‡"></a>æˆå‘˜å˜é‡</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// è·å–æˆå‘˜å˜é‡å</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * ivar_getName ( Ivar v );</div><div class="line"><span class="comment">// è·å–æˆå‘˜å˜é‡ç±»å‹ç¼–ç </span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * ivar_getTypeEncoding ( Ivar v );</div><div class="line"><span class="comment">// è·å–æˆå‘˜å˜é‡çš„åç§»é‡</span></div><div class="line">ptrdiff_t ivar_getOffset ( Ivar v );</div></pre></td></tr></table></figure>
<p>å…³äºç±»å‹ç¼–ç ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ä¸‹å®˜æ–¹æ–‡æ¡£<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html#//apple_ref/doc/uid/TP40008048-CH100-SW1" target="_blank" rel="external">Type Encodings</a>ã€<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtPropertyIntrospection.html#//apple_ref/doc/uid/TP40008048-CH101-SW6" target="_blank" rel="external">Property Type String</a>ã€‚</p>
<h4 id="å…³è”å¯¹è±¡"><a href="#å…³è”å¯¹è±¡" class="headerlink" title="å…³è”å¯¹è±¡"></a>å…³è”å¯¹è±¡</h4><p>å¦‚æœåœ¨å¼€å‘ä¸­ä½ å‡†å¤‡ç»™ç³»ç»Ÿçš„ç±»é¢å¤–æ·»åŠ ä¸€ä¸ªå±æ€§ï¼Œä½ å¯èƒ½ä¼šæƒ³åˆ°ä½¿ç”¨ç»§æ‰¿æ¥å®ç°ï¼Œä½†æ˜¯åªå¢åŠ ä¸€ä¸ªå±æ€§ï¼Œå°±å»ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œæœªå…å¤ªéº»çƒ¦äº†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œruntimeæä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼šå³å…³è”å¯¹è±¡(Associated Object)ã€‚å‡½æ•°å¦‚ä¸‹ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// è®¾ç½®å…³è”å¯¹è±¡</span></div><div class="line"><span class="keyword">void</span> objc_setAssociatedObject ( <span class="keyword">id</span> object, <span class="keyword">const</span> <span class="keyword">void</span> *key, <span class="keyword">id</span> value, objc_AssociationPolicy policy );</div><div class="line"><span class="comment">// è·å–å…³è”å¯¹è±¡</span></div><div class="line"><span class="keyword">id</span> objc_getAssociatedObject ( <span class="keyword">id</span> object, <span class="keyword">const</span> <span class="keyword">void</span> *key );</div><div class="line"><span class="comment">// ç§»é™¤å…³è”å¯¹è±¡</span></div><div class="line"><span class="keyword">void</span> objc_removeAssociatedObjects ( <span class="keyword">id</span> object );</div></pre></td></tr></table></figure></p>
<p>å…¶ä¸­å‚æ•°å«ä¹‰ä¸ºï¼š<br>1.<code>id object</code>ç»™è°æ·»åŠ å…³è”å¯¹è±¡ã€‚<br>2.<code>const void *key</code>å…³è”å¯¹è±¡å”¯ä¸€çš„keyï¼Œè·å–æ—¶ä¼šç”¨åˆ°ã€‚<br>3.<code>id value</code>å…³è”å¯¹è±¡ã€‚<br>4.<code>objc_AssociationPolicy</code>å…³è”ç­–ç•¥ï¼Œæœ‰ä»¥ä¸‹å‡ ç§ç­–ç•¥ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span> &#123;</div><div class="line">    OBJC_ASSOCIATION_ASSIGN = <span class="number">0</span>,</div><div class="line">    OBJC_ASSOCIATION_RETAIN_NONATOMIC = <span class="number">1</span>, </div><div class="line">    OBJC_ASSOCIATION_COPY_NONATOMIC = <span class="number">3</span>,</div><div class="line">    OBJC_ASSOCIATION_RETAIN = <span class="number">01401</span>,</div><div class="line">    OBJC_ASSOCIATION_COPY = <span class="number">01403</span> </div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>æ ¹æ®è¦å…³è”å¯¹è±¡çš„ç±»å‹æ¥é€‰æ‹©å…³è”ç­–ç•¥ã€‚æœ‰äº†ä¸Šé¢ä¸‰ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»™åˆ†ç±»æ·»åŠ /ç§»é™¤å…³è”å¯¹è±¡äº†ï¼Œç®€å•ä»£ç å®ä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//æ·»åŠ å…³è”å¯¹è±¡ï¼ˆå¯ä»¥ç”¨æ–¹æ³•åœ°å€ä½œä¸ºkeyï¼‰</span></div><div class="line">- (<span class="keyword">void</span>)addAssociatedObject:(<span class="keyword">id</span>)object&#123;</div><div class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(getAssociatedObject), object, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">&#125;</div><div class="line"><span class="comment">//è·å–å…³è”å¯¹è±¡ï¼ˆ_cmdä»£è¡¨å½“å‰è°ƒç”¨æ–¹æ³•çš„åœ°å€ï¼‰</span></div><div class="line">- (<span class="keyword">id</span>)getAssociatedObject&#123;</div><div class="line">    <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, _cmd);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// è·å–å±æ€§å</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * property_getName ( objc_property_t property );</div><div class="line"><span class="comment">// è·å–å±æ€§ç‰¹æ€§æè¿°å­—ç¬¦ä¸²</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * property_getAttributes ( objc_property_t property );</div><div class="line"><span class="comment">// è·å–å±æ€§ä¸­æŒ‡å®šçš„ç‰¹æ€§</span></div><div class="line"><span class="keyword">char</span> * property_copyAttributeValue ( objc_property_t property, <span class="keyword">const</span> <span class="keyword">char</span> *attributeName );</div><div class="line"><span class="comment">// è·å–å±æ€§çš„ç‰¹æ€§åˆ—è¡¨</span></div><div class="line">objc_property_attribute_t * property_copyAttributeList ( objc_property_t property, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div></pre></td></tr></table></figure>
<p>å®ä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> outCount = <span class="number">0</span>;</div><div class="line">objc_property_t * properties = class_copyPropertyList([Model <span class="keyword">class</span>], &amp;outCount);</div><div class="line"><span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; outCount; i ++) &#123;</div><div class="line">    objc_property_t property = properties[i];</div><div class="line">    <span class="comment">//å±æ€§å</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> * name = property_getName(property);</div><div class="line">    <span class="comment">//å±æ€§æè¿°</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> * propertyAttr = property_getAttributes(property);</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"å±æ€§ %s çš„æè¿°ä¸º %s"</span>, name, propertyAttr);</div><div class="line"></div><div class="line">    <span class="comment">//å±æ€§çš„ç‰¹æ€§</span></div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> attrCount = <span class="number">0</span>;</div><div class="line">    objc_property_attribute_t * attrs = property_copyAttributeList(property, &amp;attrCount);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> j = <span class="number">0</span>; j &lt; attrCount; j ++) &#123;</div><div class="line">        objc_property_attribute_t attr = attrs[j];</div><div class="line">        <span class="keyword">const</span> <span class="keyword">char</span> * name = attr.name;</div><div class="line">        <span class="keyword">const</span> <span class="keyword">char</span> * value = attr.value;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å±æ€§ç‰¹æ€§åç§°ï¼š%s å€¼ï¼š%s"</span>, name, value);</div><div class="line">    &#125;</div><div class="line">    free(attrs);</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"\n"</span>);</div><div class="line">&#125;</div><div class="line">free(properties);</div></pre></td></tr></table></figure></p>
<p>è¾“å‡ºç»“æœä¸ºï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// å¯ä»¥ç»“åˆä¸Šè¡¨ç†è§£</span></div><div class="line">[<span class="number">24076</span>:<span class="number">1005550</span>] å±æ€§ str çš„æè¿°ä¸º T<span class="string">@"NSString"</span>,C,N,V_str</div><div class="line">[<span class="number">24076</span>:<span class="number">1005550</span>] å±æ€§ç‰¹æ€§åç§°ï¼šT å€¼ï¼š<span class="string">@"NSString"</span></div><div class="line">[<span class="number">24076</span>:<span class="number">1005550</span>] å±æ€§ç‰¹æ€§åç§°ï¼šC å€¼ï¼š</div><div class="line">[<span class="number">24076</span>:<span class="number">1005550</span>] å±æ€§ç‰¹æ€§åç§°ï¼šN å€¼ï¼š</div><div class="line">[<span class="number">24076</span>:<span class="number">1005550</span>] å±æ€§ç‰¹æ€§åç§°ï¼šV å€¼ï¼š_str</div><div class="line"></div><div class="line">[<span class="number">24076</span>:<span class="number">1005550</span>] å±æ€§ array çš„æè¿°ä¸º T<span class="string">@"NSArray"</span>,R,N,V_array</div><div class="line">[<span class="number">24076</span>:<span class="number">1005550</span>] å±æ€§ç‰¹æ€§åç§°ï¼šT å€¼ï¼š<span class="string">@"NSArray"</span></div><div class="line">[<span class="number">24076</span>:<span class="number">1005550</span>] å±æ€§ç‰¹æ€§åç§°ï¼šR å€¼ï¼š</div><div class="line">[<span class="number">24076</span>:<span class="number">1005550</span>] å±æ€§ç‰¹æ€§åç§°ï¼šN å€¼ï¼š</div><div class="line">[<span class="number">24076</span>:<span class="number">1005550</span>] å±æ€§ç‰¹æ€§åç§°ï¼šV å€¼ï¼š_array</div></pre></td></tr></table></figure></p>
<p>é€šè¿‡ä¸Šé¢çš„ç®€å•æ€»ç»“ï¼Œæˆ‘å¯¹Objective-Cç±»ä¸å¯¹è±¡çš„åº•å±‚å®ç°æœ‰äº†æ›´æ·±çš„ç†è§£ï¼ŒåŒæ—¶ä¹Ÿæ„Ÿå—åˆ°äº†<code>runtime</code>çš„å¼ºå¤§ã€‚ä¸‹ç¯‡æ–‡ç« æˆ‘ä¼šæ€»ç»“ä¸€ä¸‹æ–¹æ³•ã€æ¶ˆæ¯çš„ç»“æ„ä¸æ“ä½œå‡½æ•°ï¼Œæ•¬è¯·æœŸå¾…~</p>
<p>å‚è€ƒé“¾æ¥ï¼š<br><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/ObjCRuntimeRef/index.html" target="_blank" rel="external">Objective-C Runtimeå®˜æ–¹æ–‡æ¡£</a><br><a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40008048" target="_blank" rel="external">Objective-C Runtime Programming Guide</a><br><a href="http://southpeak.github.io/categories/objectivec/" target="_blank" rel="external">å—å¤§runtimeæ€»ç»“</a></p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title><![CDATA[iOSæ€§èƒ½ä¼˜åŒ–UIç¯‡ï¼ˆäºŒï¼‰]]></title>
      <url>/2017/06/29/iOS%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96UI%E7%AF%87%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      <content type="html"><![CDATA[<p>ä¹¦æ¥ä¸Šå›ï¼Œæˆ‘ä»¬æ¥èŠä¸€ä¸‹UIæ€§èƒ½ä¼˜åŒ–çš„å‡ å¤§é‡ç‚¹å¯¹è±¡ã€‚</p>
<h3 id="UITableView"><a href="#UITableView" class="headerlink" title="UITableView"></a>UITableView</h3><p>æˆ‘ç›¸ä¿¡æ¯ä¸€ä½iOSå¼€å‘äººå‘˜å†™<code>UITableView</code>è‚¯å®šéƒ½è¦å†™åäº†ï¼Œä½†æ˜¯å¤§å®¶ç¡®å®šåœ¨å†™çš„æ—¶å€™éƒ½æ³¨æ„åˆ°è¿™äº›åŸåˆ™orç»†èŠ‚äº†å—ï¼Ÿ</p>
<ul>
<li>å°½é‡é¿å…åŠ¨æ€é«˜åº¦çš„cellï¼Œå¦‚æœå·²ç¡®å®šæ§ä»¶çš„é«˜åº¦ï¼Œç›´æ¥ä½¿ç”¨<code>tableView</code>çš„<code>rowHeight</code>ã€<code>sectionHeaderHeight</code>å’Œ<code>sectionFooterHeight</code>è®¾ç½®é«˜åº¦ï¼Œé¿å…è¯·æ±‚delegateã€‚åœ¨<code>heightForRowAtIndexPath:</code>ä¸­å°½é‡ä¸ä½¿ç”¨<code>cellForRowAtIndexPath:</code>ï¼Œå¦‚æœä½ éœ€è¦ç”¨åˆ°å®ƒï¼Œæœ€å¥½åªç”¨ä¸€æ¬¡ç„¶åç¼“å­˜ç»“æœã€‚<a id="more"></a></li>
<li>ä½¿ç”¨<code>dequeueReusableCellWithIdentifier:</code>æˆ–<code>dequeueReusableCellWithIdentifier:forIndexPath:</code>å¤ç”¨cellï¼Œåè€…éœ€è¦æ­é…<code>registerClass/Nib:forCellReuseIdentifier:</code>ä½¿ç”¨ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨é»˜è®¤æ²¡æœ‰cellå¯å¤ç”¨çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„cellå‡ºæ¥ï¼Œæ¨èä½¿ç”¨åè€…ã€‚</li>
<li>å¯¹äºåŠ¨æ€é«˜åº¦çš„cellï¼Œåšå¯¹åº”æ ‡è®°ï¼Œç¼“å­˜è¡Œé«˜ã€‚æ¨èä½¿ç”¨sunnyxxå¤§ç¥çš„<a href="https://github.com/forkingdog/UITableView-FDTemplateLayoutCell" target="_blank" rel="external">UITableView-FDTemplateLayoutCell</a>ã€‚å¦‚æœcellå¯¹åº”çš„æ¨¡å‹æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ä¸åšç›¸åº”çš„è®¡ç®—æ¸²æŸ“å¤„ç†ã€‚</li>
<li>ä½¿ç”¨è‡ªå®šä¹‰è§†å›¾æ„é€ çš„cellï¼Œè¦é¿å…è°ƒç”¨<code>layoutIfNeeded</code>æ¯æ¬¡å¯¹å…¶è¿›è¡Œå¸ƒå±€ã€‚å°½é‡å›ºå®šcellå­è§†å›¾çš„å°ºå¯¸ï¼Œç¡®ä¿æ¯ä¸ªcellæ¸²æŸ“æ‰€éœ€æ—¶é—´æœ€å°åŒ–ã€‚<br>å°½é‡ä½¿ç”¨ä¸é€æ˜çš„å­è§†å›¾ï¼ŒåŒ…æ‹¬cellæœ¬èº«ï¼Œè¿™ç‚¹å·²ç»åœ¨ä¸Šç¯‡åŸºæœ¬æ³•ä¸­æè¿‡ã€‚<br>ç¡®ä¿cellçš„å­è§†å›¾æ•°é‡æœ€å°‘ï¼Œé¿å…è€—è´¹æ€§èƒ½çš„æ“ä½œï¼Œå¦‚å›¾ç‰‡çš„ç¼©æ”¾ã€æ¸å˜ç­‰ã€‚<br>å¦‚æœè‡ªå®šä¹‰cellçš„æ ·å¼åŸºæœ¬ç¡®å®šä¸ä¼šå‘ç”Ÿå¤§çš„å¸ƒå±€å˜åŒ–ï¼Œæˆ–è€…åœ¨æ»‘åŠ¨æ—¶æœ‰æ˜æ˜¾çš„æ€§èƒ½é—®é¢˜ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦å¼‚æ­¥ç»˜åˆ¶è¿™ä¸ªcellï¼Œæˆ‘ä¼šåœ¨è‡ªå®šä¹‰è§†å›¾éƒ¨åˆ†è®²è§£ã€‚</li>
<li>åœ¨å¿«é€Ÿæ»šåŠ¨æ—¶å¦‚æœå‡ºç°äº†å¡é¡¿ï¼Œé‚£ä¹ˆä½ é™¤äº†ä½¿ç”¨å¼‚æ­¥ç»˜åˆ¶cellï¼Œè¿˜å¯ä»¥è€ƒè™‘ä½¿ç”¨â€˜â€˜å ä½â€™â€™cellï¼Œè¿™ç§æ–¹å¼åœ¨å›½å†…çš„Appæ¯”è¾ƒå°‘è§ï¼Œå¦‚å›¾ï¼š<br><img src="http://owgqmweju.bkt.clouddn.com/17-10-26/41893848.jpg" alt="å›¾1"><br>â€˜â€˜å ä½â€™â€™cellç±»ä¼¼äºå ä½å›¾ï¼Œå®ƒå‘Šè¯‰ç”¨æˆ·è¿™éƒ¨åˆ†å³å°†å±•ç¤ºä¸€äº›ä¿¡æ¯ï¼Œå½“æ»šåŠ¨é€Ÿåº¦é™ä½åˆ°ä¸€å®šå€¼æ—¶ï¼Œå†å±•ç¤ºæœ€ç»ˆæ•°æ®ã€‚éƒ¨åˆ†ä»£ç å®ç°å¦‚ä¸‹ï¼š<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</div><div class="line">    <span class="comment">// é€šè¿‡scrollViewçš„panGestureRecognizerè·å–æ»‘åŠ¨é€Ÿç‡</span></div><div class="line">    <span class="keyword">self</span>.velocity = [scrollView.panGestureRecognizer velocityInView:<span class="keyword">self</span>.view];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</div><div class="line">    <span class="comment">// æ ¹æ®æ»‘åŠ¨é€Ÿç‡åšç›¸åº”å†…å®¹å±•ç¤º</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.velocity.y &gt; maxVelocity) &#123;</div><div class="line">        <span class="keyword">return</span> placeholderCell;</div><div class="line">    &#125;<span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> cell;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>è¿˜æœ‰ä¸€ç§saoå¥—è·¯æ˜¯æŒ‰éœ€åŠ è½½cell<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// æŒ‰éœ€åŠ è½½ - å¦‚æœç›®æ ‡è¡Œä¸å½“å‰è¡Œç›¸å·®è¶…è¿‡æŒ‡å®šè¡Œæ•°ï¼Œåªåœ¨ç›®æ ‡æ»šåŠ¨èŒƒå›´çš„å‰åæŒ‡å®š3è¡ŒåŠ è½½ã€‚</span></div><div class="line">- (<span class="keyword">void</span>)scrollViewWillEndDragging:(<span class="built_in">UIScrollView</span> *)scrollView withVelocity:(<span class="built_in">CGPoint</span>)velocity targetContentOffset:(<span class="keyword">inout</span> <span class="built_in">CGPoint</span> *)targetContentOffset&#123;</div><div class="line">    <span class="built_in">NSIndexPath</span> *ip = [<span class="keyword">self</span> indexPathForRowAtPoint:<span class="built_in">CGPointMake</span>(<span class="number">0</span>, targetContentOffset-&gt;y)];</div><div class="line">    <span class="built_in">NSIndexPath</span> *cip = [[<span class="keyword">self</span> indexPathsForVisibleRows] firstObject];</div><div class="line">    <span class="built_in">NSInteger</span> skipCount = <span class="number">8</span>;</div><div class="line">    <span class="keyword">if</span> (labs(cip.row - ip.row) &gt; skipCount) &#123;</div><div class="line">        <span class="built_in">NSArray</span> *temp = [<span class="keyword">self</span> indexPathsForRowsInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, targetContentOffset-&gt;y, <span class="keyword">self</span>.width, <span class="keyword">self</span>.height)];</div><div class="line">        <span class="built_in">NSMutableArray</span> *arr = [<span class="built_in">NSMutableArray</span> arrayWithArray:temp];</div><div class="line">        <span class="keyword">if</span> (velocity.y &lt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="built_in">NSIndexPath</span> *indexPath = [temp lastObject];</div><div class="line">            <span class="keyword">if</span> (indexPath.row + <span class="number">3</span> &lt; datas.count) &#123;</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row+<span class="number">1</span> inSection:<span class="number">0</span>]];</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row+<span class="number">2</span> inSection:<span class="number">0</span>]];</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row+<span class="number">3</span> inSection:<span class="number">0</span>]];</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">NSIndexPath</span> *indexPath = [temp firstObject];</div><div class="line">            <span class="keyword">if</span> (indexPath.row &gt; <span class="number">3</span>) &#123;</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row<span class="number">-3</span> inSection:<span class="number">0</span>]];</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row<span class="number">-2</span> inSection:<span class="number">0</span>]];</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row<span class="number">-1</span> inSection:<span class="number">0</span>]];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        [needLoadArr addObjectsFromArray:arr];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// åœ¨`tableView:cellForRowAtIndexPath:`æ–¹æ³•ä¸­åŠ å…¥åˆ¤æ–­ï¼šï¼Œä¿®æ”¹æ ·å¼</span></div><div class="line"><span class="keyword">if</span> (needLoadArr.count &gt; <span class="number">0</span></div><div class="line">    &amp;&amp;</div><div class="line">    [needLoadArr indexOfObject:indexPath] == <span class="built_in">NSNotFound</span>) &#123;</div><div class="line">        [cell clear];</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>è¯¦è§<a href="https://github.com/johnil/VVeboTableViewDemo" target="_blank" rel="external">VVeboTableViewDemo</a></p>
<h3 id="UIWebViewã€WKWebView"><a href="#UIWebViewã€WKWebView" class="headerlink" title="UIWebViewã€WKWebView"></a>UIWebViewã€WKWebView</h3><p>ç”±äºH5å…·æœ‰åŠ¨æ€åŒ–ï¼Œä¸ç”¨å‘ç‰ˆç­‰ä¼˜åŠ¿ï¼Œè¶Šæ¥è¶Šå¤šçš„H5é¡µé¢å‡ºç°çš„åŸç”ŸAppä¸­ã€‚è‹¹æœæä¾›äº†ä¸¤ç§åŠ è½½H5çš„æ§ä»¶ï¼Œ<code>UIWebView</code>,<code>WKWebView</code>ï¼Œ<code>WKWebView</code>æ˜¯iOS8çš„æ–°ç‰¹æ€§ï¼Œé€šè¿‡ç®€å•çš„æµ‹è¯•å³å¯å‘ç°UIWebViewå ç”¨è¿‡å¤šå†…å­˜ï¼Œä¸”å†…å­˜å³°å€¼æ›´æ˜¯å¤¸å¼ ã€‚WKWebViewç½‘é¡µåŠ è½½é€Ÿåº¦æ›´å¿«ï¼Œå ç”¨å†…å­˜æ›´å°ï¼Œä¸‹é¢åˆ—ä¸¾ä¸€äº›å…¶å®ƒçš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æ”¯æŒæ›´å¤šçš„H5ç‰¹æ€§</li>
<li>60fpsçš„æ»šåŠ¨åˆ·æ–°ç‡åŠå†…ç½®æ‰‹åŠ¿</li>
<li>ä¸Safariç›¸åŒçš„JavaScriptå¼•æ“</li>
<li>å°†<code>UIWebView</code>å’Œ<code>UIWebViewDelegate</code>é‡æ„æˆäº†14ä¸ªç±»ï¼Œ3ä¸ªåè®®ï¼Œå¯ä»¥è®©å¼€å‘è€…è¿›è¡Œæ›´ç»†è‡´çš„é…ç½®</li>
</ul>
<p>ç®€ç›´å®Œçˆ†<code>UIWebView</code>ï¼Œæ‰€ä»¥æƒ³è¦ä¼˜åŒ–ä½ çš„webViewï¼Œé‚£ä¹ˆä»ç°åœ¨å¼€å§‹å¼ƒ<code>UIWebView</code>ï¼Œç”¨<code>WKWebView</code>å§ï¼ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹<code>WKWebView</code>ã€‚  </p>
<h4 id="åŠ è½½é¡µé¢"><a href="#åŠ è½½é¡µé¢" class="headerlink" title="åŠ è½½é¡µé¢"></a>åŠ è½½é¡µé¢</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import<span class="meta-string">&lt;WebKit/WebKit.h&gt;</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)loadRequest &#123;</div><div class="line">    _wkWebView = [[<span class="built_in">WKWebView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds configuration:[<span class="built_in">WKWebViewConfiguration</span> new]]; </div><div class="line">    <span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://www.wonkeyz.com/"</span>]];</div><div class="line">    [_wkWebView loadRequest:request];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="åŸç”Ÿè°ƒç”¨JS"><a href="#åŸç”Ÿè°ƒç”¨JS" class="headerlink" title="åŸç”Ÿè°ƒç”¨JS"></a>åŸç”Ÿè°ƒç”¨JS</h4><p>1.ä½¿ç”¨<code>WKUserScript</code><br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// JSä»£ç </span></div><div class="line"><span class="built_in">NSString</span> *js = <span class="string">@"window.alert('æµ‹è¯•åŸç”Ÿè°ƒç”¨JS');"</span>;</div><div class="line"><span class="comment">// æ ¹æ®JSä»£ç åˆå§‹åŒ–WKUserScriptå¯¹è±¡</span></div><div class="line"><span class="built_in">WKUserScript</span> *script = [[<span class="built_in">WKUserScript</span> alloc] initWithSource:js injectionTime:<span class="built_in">WKUserScriptInjectionTimeAtDocumentEnd</span> forMainFrameOnly:<span class="literal">YES</span>];</div><div class="line"><span class="comment">// æ ¹æ®ç”Ÿæˆçš„WKUserScriptå¯¹è±¡ï¼Œåˆå§‹åŒ–WKWebViewConfiguration</span></div><div class="line"><span class="built_in">WKWebViewConfiguration</span> *config = [<span class="built_in">WKWebViewConfiguration</span> new];</div><div class="line">[config.userContentController addUserScript:script];</div></pre></td></tr></table></figure></p>
<p>2.ç›´æ¥è°ƒç”¨JSä»£ç <br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[_wkWebView evaluateJavaScript:js completionHandler:^(<span class="keyword">id</span> _Nullable, <span class="built_in">NSError</span> * _Nullable error) &#123;</div><div class="line">        <span class="comment">// è·å–jsæ–¹æ³•è¿”å›å€¼ï¼Œå›è°ƒæ“ä½œç­‰</span></div><div class="line">    &#125;];</div></pre></td></tr></table></figure></p>
<h4 id="JSè°ƒç”¨åŸç”Ÿ"><a href="#JSè°ƒç”¨åŸç”Ÿ" class="headerlink" title="JSè°ƒç”¨åŸç”Ÿ"></a>JSè°ƒç”¨åŸç”Ÿ</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// å‘JSæ³¨å…¥OCæ–¹æ³•</span></div><div class="line">[[_webView configuration].userContentController addScriptMessageHandler:<span class="keyword">self</span> name:<span class="string">@"ocMethod"</span>];</div><div class="line"></div><div class="line"><span class="comment">// JSè°ƒç”¨</span></div><div class="line">window.webkit.messageHandlers.ocMethod.postMessage(value);</div><div class="line"></div><div class="line"><span class="comment">// æ¥æ”¶JSè°ƒç”¨</span></div><div class="line">- (<span class="keyword">void</span>)userContentController:(<span class="built_in">WKUserContentController</span> *)userContentController didReceiveScriptMessage:(<span class="built_in">WKScriptMessage</span> *)message &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"JS è°ƒç”¨äº† %@ æ–¹æ³•ï¼Œä¼ å›å‚æ•° %@"</span>,message.name,message.body);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å°±æ˜¯è¿™ä¹ˆç®€å•ï¼ä¸è¿‡<code>WKWebView</code>è¿˜æ˜¯æœ‰ä¸€äº›å‘çš„ï¼Œæœ‰å¾ˆå¤šç›¸å…³æ–‡ç« ï¼Œè¿™é‡Œå¥‰ä¸Šå‡ ç¯‡å¤§ä½¬çš„æ€»ç»“<a href="http://www.jianshu.com/p/403853b63537" target="_blank" rel="external">WKWebViewçš„ä½¿ç”¨å’Œå„ç§å‘çš„è§£å†³æ–¹æ³•ï¼ˆOCï¼‹Swiftï¼‰</a>ï¼Œ<a href="http://www.jianshu.com/p/7bb5f15f1daa" target="_blank" rel="external">WKWebViewå­¦ä¹ ç¬”è®°</a>ã€‚</p>
<h3 id="è‡ªå®šä¹‰è§†å›¾çš„ç»˜åˆ¶"><a href="#è‡ªå®šä¹‰è§†å›¾çš„ç»˜åˆ¶" class="headerlink" title="è‡ªå®šä¹‰è§†å›¾çš„ç»˜åˆ¶"></a>è‡ªå®šä¹‰è§†å›¾çš„ç»˜åˆ¶</h3><p>æˆ‘ä»¬æ¥åšä¸€ä¸ªç®€å•çš„demoï¼Œå¦‚å›¾ï¼š<img src="http://owgqmweju.bkt.clouddn.com/17-10-27/22309726.jpg" alt="å›¾2"><br>æ­£å¸¸ä»£ç å¸ƒå±€å°±ä¸å†™äº†ï¼Œè¿™é‡Œç»™å‡ºç»˜åˆ¶ä»£ç <br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"drink.jpg"</span>];</div><div class="line">        <span class="built_in">CGRect</span> imageFrame = <span class="built_in">CGRectMake</span>(<span class="number">15</span>, <span class="number">15</span>, <span class="number">80</span>, <span class="number">80</span>);</div><div class="line">        [image drawInRect:imageFrame];</div><div class="line">    &#125;</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">NSString</span> *title = <span class="string">@"This is title,This is title,This is title,This is title"</span>;</div><div class="line">        <span class="built_in">UIFont</span> *titleFont = [<span class="built_in">UIFont</span> boldSystemFontOfSize:<span class="number">17</span>];</div><div class="line">        <span class="built_in">NSDictionary</span> *attrs = @&#123;<span class="built_in">NSFontAttributeName</span> : titleFont,</div><div class="line">                                <span class="built_in">NSForegroundColorAttributeName</span> : kTextColor</div><div class="line">                                &#125;;</div><div class="line">        <span class="built_in">CGRect</span> titleFrame = <span class="built_in">CGRectMake</span>(<span class="number">105</span>, <span class="number">10</span>, <span class="keyword">self</span>.width - <span class="number">125</span>, <span class="number">30</span>);</div><div class="line">        [title drawInRect:titleFrame withAttributes:attrs];</div><div class="line">    &#125;</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">NSString</span> *content = <span class="string">@"This is content,This is content,This is content,This is content,This is content"</span>;</div><div class="line">        <span class="built_in">UIFont</span> *contentFont = [<span class="built_in">UIFont</span> boldSystemFontOfSize:<span class="number">13</span>];</div><div class="line">        <span class="built_in">NSDictionary</span> *attrs = @&#123;<span class="built_in">NSFontAttributeName</span> : contentFont,</div><div class="line">                                <span class="built_in">NSForegroundColorAttributeName</span> : kLigthTextColor</div><div class="line">                                &#125;;</div><div class="line">        <span class="built_in">CGRect</span> contentFrame = <span class="built_in">CGRectMake</span>(<span class="number">105</span>, <span class="number">40</span>, <span class="keyword">self</span>.width - <span class="number">125</span>, <span class="number">40</span>);</div><div class="line">        [content drawInRect:contentFrame withAttributes:attrs];</div><div class="line">    &#125;</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">NSString</span> *time = <span class="string">@"This is time"</span>;</div><div class="line">        <span class="built_in">UIFont</span> *timeFont = [<span class="built_in">UIFont</span> boldSystemFontOfSize:<span class="number">12</span>];</div><div class="line">        <span class="built_in">NSDictionary</span> *attrs = @&#123;<span class="built_in">NSFontAttributeName</span> : timeFont,</div><div class="line">                                <span class="built_in">NSForegroundColorAttributeName</span> : kLigthTextColor</div><div class="line">                                &#125;;</div><div class="line">        <span class="built_in">CGRect</span> timeFrame = <span class="built_in">CGRectMake</span>(<span class="number">105</span>, <span class="number">80</span>, <span class="keyword">self</span>.width - <span class="number">125</span>, <span class="number">20</span>);</div><div class="line">        [time drawInRect:timeFrame withAttributes:attrs];</div><div class="line">    &#125;</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line">        <span class="built_in">CGContextSetStrokeColorWithColor</span>(context, kLineBackColor.CGColor);</div><div class="line">        <span class="built_in">CGContextStrokeRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="keyword">self</span>.height - kLineHeight, <span class="keyword">self</span>.width, kLineHeight));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¯¹æ¯”ä¸€ä¸‹æ¸²æŸ“æ—¶é—´ï¼Œå·¦ä¸ºå¤åˆè§†å›¾æ–¹å¼ï¼Œå³ä¸ºç›´æ¥ç»˜åˆ¶<br><img src="http://owgqmweju.bkt.clouddn.com/17-10-27/34929283.jpg" alt="å›¾3"><br>é€šè¿‡å¯¹æ¯”å‘ç°ç»˜åˆ¶å¾—åˆ°çš„cellæ¸²æŸ“æ—¶é—´ç¼©çŸ­æ˜æ˜¾ï¼Œå¯¹äºæ›´å¤æ‚çš„ç•Œé¢æ€§èƒ½ä¼˜åŠ¿å¯æƒ³è€ŒçŸ¥ã€‚å› æ­¤ï¼Œä»æ€§èƒ½è§’åº¦æ¥çœ‹ï¼Œç›´æ¥ç»˜åˆ¶è§†å›¾æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œä½†ä»ç»´æŠ¤è§’åº¦æ¥çœ‹ï¼Œä»£ç ä¼šæ¯”è¾ƒéš¾ç»´æŠ¤è¿­ä»£ï¼Œæ‰€ä»¥åœ¨æŸäº›ç•Œé¢æ ·å¼ç¨³å®šä¸‹æ¥ï¼Œä½ å¯ä»¥è€ƒè™‘é‡æ„æˆç»˜åˆ¶è§†å›¾ã€‚æˆ–è€…ç›´æ¥ä½¿ç”¨ä¸Šæ–‡æåˆ°çš„é«˜æ€§èƒ½æ¡†æ¶<a href="https://github.com/ibireme/YYKit" target="_blank" rel="external">YYkit</a>ã€<a href="https://github.com/TextureGroup/Texture" target="_blank" rel="external">Texture</a>ã€‚</p>
<h3 id="Auto-Layout"><a href="#Auto-Layout" class="headerlink" title="Auto Layout"></a>Auto Layout</h3><p>å†è¡¥å……ä¸€ä¸‹æ¯”è¾ƒå…·æœ‰äº‰è®®æ€§çš„Auto Layoutï¼Œå®ƒç»™æˆ‘ä»¬æ—¥å¸¸å¼€å‘å¸¦æ¥äº†å¾ˆå¤§çš„ä¾¿åˆ©ï¼Œä½†ä¾¿åˆ©çš„ä»£ä»·å°±æ˜¯è€—è´¹æ›´å¤šçš„æ€§èƒ½ã€‚<br>Auto Layoutä½¿ç”¨Cassowaryç®—æ³•ä½œä¸ºçº¦æŸæ±‚è§£å·¥å…·åŒ…ï¼Œä»–çš„å¤æ‚åº¦ä¸ºOï¼ˆNï¼‰ï¼Œå…¶ä¸­Næ˜¯çº¦æŸçš„æ•°ç›®ï¼Œè€Œä¸æ˜¯å…ƒç´ çš„æ•°ç›®ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ºäº†ç¡®å®šè§†å›¾ä¸­æ‰€æœ‰å…ƒç´ çš„ä½ç½®å’Œå¤§å°ï¼Œå¯èƒ½æœ‰å¤§æ¦‚4Nä¸ªæ–¹ç¨‹è¦æ±‚è§£ï¼Œè€Œä¸”æ–¹ç¨‹èŠ±è´¹çš„æ—¶é—´ä¸å…ƒç´ çš„ä¸ªæ•°å’ŒåŒ…å«çš„çº¦æŸä¸ªæ•°æ˜¯ä¸æˆæ¯”ä¾‹çš„ã€‚å½“è§†å›¾æ•°é‡å¢åŠ è‡³å‡ ç™¾ä¸ªï¼Œç›´æ¥è®¾è®¾ç½®ç»“æ„å¤§å°è¦æ¯”ç”¨è‡ªåŠ¨å¸ƒå±€å¿«1000å€å·¦å³ï¼(æµ‹è¯•demo<a href="https://github.com/floriankugler/AutoLayoutProfiling" target="_blank" rel="external">AutoLayoutProfiling</a>)<br>æ›´è¯¦ç»†çš„åˆ†æè¯·è§<a href="https://draveness.me/layout-performance" target="_blank" rel="external">ä» Auto Layout çš„å¸ƒå±€ç®—æ³•è°ˆæ€§èƒ½</a>ã€‚<br>æ‰€ä»¥å½“ä½ ä¸ºæŸä¸ªä½¿ç”¨Auto Layoutçš„ç•Œé¢æ€§èƒ½æ¶ˆè€—è‹¦æ¼æ—¶ï¼Œé‚£ä¹ˆè¯·æ”¹ä¸ºä»£ç å¸ƒå±€å§ğŸ˜‚  </p>
<p>UIç¯‡çš„æ€§èƒ½ä¼˜åŒ–å°±æ€»ç»“åˆ°è¿™ï¼Œèœé¸Ÿç¬¬ä¸€æ¬¡å†™è¿™ç±»æ–‡ç« è¿˜è¯·å„ä½å¤§ä½¬å¤šåŒ…æ¶µï¼Œåªæ±‚åˆ«è¾£åˆ°å„ä½å¤§ä½¬çš„åŒçœ¼ğŸ˜‚</p>
]]></content>
      
        
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
            <tag> UITableView </tag>
            
            <tag> UIWebView </tag>
            
            <tag> WKWebView </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOSæ€§èƒ½ä¼˜åŒ–UIç¯‡ï¼ˆä¸€ï¼‰]]></title>
      <url>/2017/06/24/iOS%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96UI%E7%AF%87%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      <content type="html"><![CDATA[<p> è¿™æ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„è¯é¢˜ï¼Œç¨‹åºçŒ¿çš„ä¸€ç”Ÿé™¤äº†åœ¨ç¼–è¯‘ã€å†™bugã€æ”¹bugï¼Œå°±æ˜¯åœ¨ä¸æ–­åœ°é‡æ„ä¼˜åŒ–ï¼Œä¼˜åŒ–çš„ç‚¹ä¹Ÿå¤šç§å¤šæ ·ï¼Œå…¶ä¸­æœ€ç›´è§‚æœ‰æ•ˆçš„å°±æ˜¯UIéƒ¨åˆ†çš„ä¼˜åŒ–äº†ï¼Œè¿™æ–¹é¢æœ‰å¾ˆå¤šç›¸å…³èµ„æ–™ï¼Œä¹Ÿæœ‰å¦‚<a href="https://github.com/ibireme/YYKit" target="_blank" rel="external">YYkit</a>ã€<a href="https://github.com/TextureGroup/Texture" target="_blank" rel="external">Texture</a>è¿™ç§ç¥çº§æ¡†æ¶ä»æ ¹æºä¸Šè§£å†³äº†å¡é¡¿çš„é—®é¢˜ã€‚ä½œä¸ºèœé¸Ÿçš„æˆ‘æ— æ³•åƒå¤§ä½¬ä»¬ä¸€æ ·ä»æ ¹æºä¸Šåˆ†æè§£å†³UIæ€§èƒ½é—®é¢˜ï¼Œåªèƒ½å†™ä¸€ç¯‡æ¯”è¾ƒåŸºç¡€çš„æ–‡ç« ï¼Œæ€»ç»“ä¸€ä¸‹å¸¸ç”¨çš„æ§ä»¶çš„ä½¿ç”¨æ³¨æ„ç‚¹ï¼Œå¸Œæœ›å¯¹ä½ çš„æ—¥å¸¸å¼€å‘æœ‰å¸®åŠ©~<br> <a id="more"></a></p>
<h3 id="åŸºæœ¬æ³•"><a href="#åŸºæœ¬æ³•" class="headerlink" title="åŸºæœ¬æ³•"></a>åŸºæœ¬æ³•</h3><p>å…ˆæ¥ä¸€æ³¢UIæ“ä½œçš„åŸºæœ¬æ³•åˆ™ï¼š</p>
<ul>
<li>å°½é‡å‡å°‘åœ¨ä¸»çº¿ç¨‹ä¸­çš„æ“ä½œï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚æ‰§è¡Œçš„æ“ä½œè¶Šå¤šå°±æ„å‘³ç€è¶Šé«˜çš„ä¸¢å¸§ç‡ï¼Œä»è€Œå¯¼è‡´ä¸¢å¸§å¡é¡¿ã€‚</li>
<li>å°½é‡ä¿æŒè§†å›¾çš„æ‰å¹³åŒ–ï¼Œé¿å…è§†å›¾çš„å¤šå±‚åµŒå¥—ã€‚<br>åªè¦ç»™è§†å›¾æ·»åŠ å­è§†å›¾ï¼Œæˆ–å…¶å­è§†å›¾å¸ƒå±€å‘ç”Ÿå˜åŒ–éƒ½ä¼šè§¦å‘çˆ¶è§†å›¾çš„<code>layoutSubviews</code>æ–¹æ³•ï¼Œå¦‚æœä¸€ä¸ªè§†å›¾è¢«å¡äº†å¾ˆå¤šå­è§†å›¾ï¼Œæ€§èƒ½æ¶ˆè€—å¯æƒ³è€ŒçŸ¥ã€‚é‚£ä¹ˆè¿™ç§æƒ…å†µå¦‚ä½•é¿å…å‘¢ï¼Ÿæœ€å¥½çš„æ–¹æ³•æ˜¯è‡ªå®šä¹‰è§†å›¾ç»˜åˆ¶ã€‚è¿™æ ·åªä¼šè§¦å‘ä¸€ä¸ªè§†å›¾çš„ç»˜åˆ¶æ–¹æ³•ï¼Œè€Œä¸æ˜¯å¤šä¸ªå­è§†å›¾çš„ï¼ŒåŒæ—¶é¿å…äº†çˆ¶è§†å›¾å¤šæ¬¡è°ƒç”¨<code>layoutSubviews</code>å’Œ<code>drawRect:</code>æ–¹æ³•ï¼Œå…·ä½“æ“ä½œæ–‡ä¸­ä¼šç»™å‡ºdemoã€‚  </li>
<li>å°½é‡ä½¿ç”¨ä¸é€æ˜è§†å›¾ã€‚<br>å½“ä¸€ä¸ªviewæ˜¯é€æ˜çš„ï¼ŒiOSéœ€è¦æ¸²æŸ“ä¸€ä¸ªåƒç´ ä¸¤æ¬¡æˆ–å¤šæ¬¡ï¼Œè¿™æ˜¯å› ä¸ºä¸€ä¸ªåƒç´ åŒæ—¶å±äºå¾ˆå¤šsubviewsã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸è€—æ—¶çš„è¿‡ç¨‹ã€‚ä¸é€æ˜çš„è§†å›¾å¯ä»¥æå¤§åœ°æé«˜æ¸²æŸ“çš„é€Ÿåº¦ã€‚å› æ­¤å¦‚éå¿…è¦ï¼Œå¯ä»¥å°†table cellåŠå…¶å­è§†å›¾çš„<code>opaque</code>å±æ€§è®¾ä¸ºYESï¼ˆé»˜è®¤å€¼ï¼‰ã€‚</li>
<li>ä¸€äº›æƒ…å†µä¸‹é¿å…ä½¿ç”¨å…·æœ‰é€šç”¨ç›®çš„åŠåŠŸèƒ½ä¸°å¯Œçš„æ§ä»¶ï¼Œç³»ç»Ÿæ§ä»¶è™½ç„¶æ–¹ä¾¿ï¼Œä½†æœ‰æ—¶ä¹Ÿä¼šå¸¦æ¥ä¸å¿…è¦çš„æ¶ˆè€—ï¼Œä½ å¯ä»¥é€šè¿‡å°è£…è§†å›¾ç»˜åˆ¶å†…å®¹æ¥ä»£æ›¿ã€‚å¦‚åªæ˜¾ç¤ºå¤§æ®µçº¯æ–‡æœ¬ï¼Œé‚£ä¹ˆä¸å¿…ä½¿ç”¨åŠŸèƒ½å¤æ‚çš„<code>UILabel</code>ã€‚</li>
<li>å°½é‡å»¶è¿ŸåŠ è½½ã€é‡ç”¨å¤æ‚è§†å›¾ã€‚<br>è¿™ç‚¹æˆ‘ç›¸ä¿¡å¤§å®¶åœ¨ä½¿ç”¨<code>UITableView</code>ã€<code>UICollectionView</code>æ—¶éƒ½æ·±æœ‰ä½“ä¼šï¼Œå¦‚æœä½ å¯¹æœºåˆ¶è¶³å¤Ÿäº†è§£ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨<code>UIScrollView</code>æ—¶ä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨é‡ç”¨æœºåˆ¶ã€‚</li>
<li>å°½é‡é¿å…å‡ºç°è¾ƒå¤§çš„xibæˆ–storyboardã€‚sbå›ºç„¶å¼ºå¤§ï¼Œä½†æ•´ä¸ªXMLæ–‡ä»¶åœ¨ä½¿ç”¨ä¹‹å‰å¿…é¡»è¢«è§£æå’ŒåŠ è½½ï¼Œæ‰€ä»¥åº”è¯¥æœ€å°åŒ–sbä¸­çš„å•å…ƒæ•°ç›®ï¼Œåˆ›å»ºå¤šä¸ªsbæˆ–xibï¼Œè¿™æ ·ä¸ä»…æœ‰åŠ©äºå‡å°‘åº”ç”¨å¯åŠ¨æ—¶é—´ï¼Œè¿˜èƒ½é™ä½æ•´ä½“å†…å­˜æ¶ˆè€—ã€‚</li>
</ul>
<p>èŠå®ŒåŸºæœ¬æ³•ï¼Œæˆ‘ä»¬æ¥èŠä¸€ä¸‹å‡ ä¸ªå¸¸è§è§†å›¾ï¼Œçœ‹çœ‹æœ‰å“ªäº›æ€§èƒ½å°æŠ€å·§ã€‚</p>
<h4 id="UILabel"><a href="#UILabel" class="headerlink" title="UILabel"></a>UILabel</h4><p>è¿™ç»å¯¹æ˜¯ä½ ç”¨çš„æœ€å¤šçš„æ§ä»¶ï¼Œçœ‹ä¼¼ç®€å•ï¼Œä½†ä½ çœŸçš„äº†è§£å®ƒçš„æ€§èƒ½æ¶ˆè€—ç‚¹å—ï¼Ÿå…ˆæ¥çœ‹çœ‹ä»–æœ‰å¤šå¤æ‚ã€‚<br><img src="http://owgqmweju.bkt.clouddn.com/17-10-19/50317192.jpg" alt="å›¾1"><br>å›¾ä¸­çš„æ¯ä¸€é¡¹è®¾ç½®éƒ½ä¼šå¢åŠ <code>UILabel</code>çš„æ¸²æŸ“ä»£ä»·ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š<br>1.ä½¿ç”¨å­—ä½“æ ·å¼åŠè¦è¢«æ¸²æŸ“çš„æ–‡æœ¬æ—¶ï¼Œè®¡ç®—éœ€è¦çš„åƒç´ æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¶ˆè€—è¾ƒå¤§çš„è¿‡ç¨‹ï¼Œåº”å°½é‡å°‘åšã€‚<br>2.æ£€æŸ¥è¦è¢«æ¸²æŸ“çš„å®½åº¦ã€‚<br>3.æ£€æŸ¥<code>numberOfLines</code>ï¼Œè®¡ç®—å°†è¦å±•ç¤ºçš„è¡Œæ•°ã€‚<br>4.<code>sizeToFit</code>æ˜¯å¦è¢«è°ƒç”¨ï¼Œè°ƒç”¨åˆ™è®¡ç®—é«˜åº¦ï¼Œæœªè°ƒç”¨åˆ™æ£€æŸ¥å½“å‰å°ºå¯¸æ˜¯å¦èƒ½å±•ç¤ºå®Œæ•´å†…å®¹ã€‚<br>5.å¦‚æœsizeä¸å¤Ÿå±•ç¤ºï¼Œåˆ™ä½¿ç”¨<code>lineBreakMode</code>ç¡®å®šéšè—æˆ–æˆªæ–­çš„ä½ç½®ã€‚<br>6.æ£€æŸ¥å…¶ä»–é…ç½®é€‰é¡¹ï¼Œå¦‚çº¯æ–‡æœ¬orå¯Œæ–‡æœ¬ï¼Œå¯Œæ–‡æœ¬çš„æ ·å¼ï¼Œå¯¹é½æ–¹å¼ï¼Œè‡ªåŠ¨æ”¶ç¼©ç­‰ã€‚<br>7.æœ€åä½¿ç”¨å­—ä½“ã€ç±»å‹åŠé¢œè‰²ç­‰æ¸²æŸ“æœ€ç»ˆæ˜¾ç¤ºçš„æ–‡æœ¬ã€‚<br>æ•´ä¸ªè¿‡ç¨‹ä¸‹æ¥çš„æ¸²æŸ“ä»£ä»·ä¸å®¹å°è§‘ï¼Œæ‰€ä»¥å¹³æ—¶ä½¿ç”¨è¦é¿å…ä¸€äº›ä¸å¿…è¦çš„æ€§èƒ½æµªè´¹ã€‚<br>psï¼šæœ‰æ—¶ä¼šå‘ç°labelçš„æ–‡å­—å˜æ¨¡ç³Šï¼Œé‚£ä¹ˆä½ éœ€è¦æ£€æŸ¥ä¸€ä¸‹labelçš„frameæ˜¯å¦éƒ½ä¸ºæ•´æ•°ã€‚</p>
<h4 id="UIButton"><a href="#UIButton" class="headerlink" title="UIButton"></a>UIButton</h4><p>æŒ‰é’®åŒæ ·æ— å¤„ä¸åœ¨ï¼Œæ ·å¼å¤šå˜ã€åŠŸèƒ½å¼ºå¤§çš„å®ƒæ¸²æŸ“æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å››ç§ï¼š</p>
<ul>
<li>ä½¿ç”¨è‡ªå®šä¹‰æ–‡æœ¬é»˜è®¤æ¸²æŸ“</li>
<li>å…¨å°ºå¯¸èµ„æºæ¸²æŸ“</li>
<li>å¯å˜å°ºå¯¸èµ„æºæ¸²æŸ“</li>
<li>ä½¿ç”¨<code>CALayer</code>å’Œè´å¡å°”æ›²çº¿è‡ªå®šä¹‰ç»˜åˆ¶</li>
</ul>
<p>ä¸‹è¡¨ç®€å•åˆ—å‡ºäº†å‡ ç§æ¸²æŸ“æ–¹å¼çš„åˆ©å¼Šã€‚å…·ä½“è§<a href="https://robots.thoughtbot.com/designing-for-ios-taming-uibutton#advantages-of-bezier-approach" target="_blank" rel="external">Designing for iOS: Taming UIButton</a>ã€‚</p>
<table>
<thead>
<tr>
<th>æ¸²æŸ“æ–¹å¼</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>è‡ªå®šä¹‰æ–‡æœ¬</td>
<td>ç®€å•æ˜“ç”¨</td>
<td>æ ·å¼å•ä¸€</td>
</tr>
<tr>
<td>å…¨å°ºå¯¸èµ„æº</td>
<td>å¯è‡ªå®šä¹‰èƒŒæ™¯å›¾ <br> æ ·å¼å¤šå˜ <br> å¯å®ç°A/Bæµ‹è¯•</td>
<td>å›¾ç‰‡å¯¼è‡´ipaåŒ…å˜å¤§</td>
</tr>
<tr>
<td>å¯å˜å°ºå¯¸èµ„æº</td>
<td>ipaåŒ…å¤§å°å¢é‡è¾ƒå…¨å°ºå¯¸å°</td>
<td>èµ„æºçš„ä»»ä½•æ›´æ”¹å¯èƒ½éƒ½ä¼šé‡æ–°è®¡ç®—<code>UIEdgeInsets</code></td>
</tr>
<tr>
<td>è‡ªå®šä¹‰ç»˜åˆ¶</td>
<td>é«˜åº¦è‡ªå®šä¹‰æ ·å¼</td>
<td>éšç€è¿­ä»£ä»£ç å›è¶Šå‘è‡ƒè‚¿</td>
</tr>
</tbody>
</table>
<p>é€šè¿‡ä¸Šé¢çš„æ¯”è¾ƒï¼Œä½ éœ€è¦æƒè¡¡ä¸€ä¸‹åˆ©å¼Šï¼Œåˆ°åº•æ˜¯è¦æ€§èƒ½èƒ½è¿˜æ˜¯è¦ipaåŒ…ä¿æŒåˆé€‚çš„å¤§å°ã€‚</p>
<h4 id="UIImageView"><a href="#UIImageView" class="headerlink" title="UIImageView"></a>UIImageView</h4><p>å›¾åƒçš„ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œä½†åœ¨æ¸²æŸ“ä»£ä»·è¾ƒå¤§çš„UIå…ƒç´ ä¸­ï¼Œå›¾åƒé¦–å±ˆä¸€æŒ‡ã€‚åœ¨ä½¿ç”¨UIImageã€UIImageViewæ—¶ï¼Œæ³¨æ„ä»¥ä¸‹å‡ ç‚¹æœ‰åŠ©äºæ€§èƒ½æå‡ï¼š</p>
<ul>
<li>åŠ è½½å›¾ç‰‡çš„æ–¹å¼æœ‰ä¸‰ç§<code>imageNamed:</code>ã€<code>imageWithContentsOfFile:</code>ã€<code>imageWithData:</code>ï¼Œæ­£ç¡®é€‰æ‹©å›¾ç‰‡åŠ è½½æ–¹å¼èƒ½å¤Ÿå¯¹å†…å­˜ä¼˜åŒ–èµ·åˆ°å¾ˆå¤§çš„ä½œç”¨ã€‚<br><code>imageNamed:</code>ä¼˜ç‚¹åœ¨äºå¯ä»¥ç¼“å­˜å·²ç»åŠ è½½çš„å›¾ç‰‡ï¼Œç¡®ä¿å†…å®¹åªè¢«åŠ è½½è‡³å†…å­˜ä¸€æ¬¡ï¼Œè¿™å¯¹äºå›¾åƒçš„é‡å¤åˆ©ç”¨æ˜¯éå¸¸æœ‰ä¼˜åŠ¿çš„ã€‚å¯¹äºå¸¸ç”¨çš„å°å›¾æ¨èä½¿ç”¨è¯¥æ–¹æ³•ï¼Œå¯ä»¥èŠ‚çœå‡ºæ¯æ¬¡éƒ½ä»ç£ç›˜åŠ è½½å›¾ç‰‡çš„æ—¶é—´ï¼Œè¿™æ ·èƒ½æ›´å¥½çš„å“åº”ç”¨æˆ·çš„æ“ä½œã€‚<br><code>imageWithContentsOfFile:</code>å’Œ<code>imageWithData:</code>è¿™ä¸¤ç§æ–¹æ³•çš„æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼Œ éƒ½æ˜¯ç®€å•çš„åŠ è½½å›¾ç‰‡ï¼Œå¹¶ä¸ä¼šå°†å›¾ç‰‡ç¼“å­˜èµ·æ¥ï¼Œå›¾åƒä¼šè¢«ç³»ç»Ÿä»¥æ•°æ®æ–¹å¼åŠ è½½åˆ°ç•Œé¢ã€‚ä¸€äº›ä¸å¸¸ç”¨çš„å¤§å›¾æ¨èä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•ï¼Œè¿™æ ·å°±ä¸ä¼šç¼“å­˜è¿™äº›å›¾ç‰‡å ç”¨å†…å­˜ã€‚</li>
<li>å¯¹äºç½‘ç»œå›¾åƒï¼Œä½¿ç”¨é«˜æ€§èƒ½çš„å›¾åƒç¼“å­˜åº“ï¼Œå¦‚<a href="https://github.com/ibireme/YYWebImage" target="_blank" rel="external">YYWebImage</a>ã€<a href="https://github.com/rs/SDWebImage" target="_blank" rel="external">SDWebImage</a>ã€‚</li>
<li>åœ¨å›¾ç‰‡æ ¼å¼çš„é€‰æ‹©ä¸ŠåŒæ ·å¾ˆæœ‰è®²ç©¶ï¼Œé€‰æ‹©åˆé€‚çš„æ ¼å¼èƒ½å¤Ÿä¸ºä½ çš„åº”ç”¨å¸¦æ¥æœ€ä½³ä½“éªŒï¼Œè¿™é‡Œå¥‰ä¸ŠYYå¤§ç¥çš„åšæ–‡<a href="https://blog.ibireme.com/2015/11/02/mobile_image_benchmark/" target="_blank" rel="external">ç§»åŠ¨ç«¯å›¾ç‰‡æ ¼å¼è°ƒç ”</a>ã€‚</li>
<li>è½½å…¥çš„å›¾ç‰‡ä¸<code>UIImageView</code>å°ºå¯¸ç›¸åŒã€‚å› ä¸ºè°ƒæ•´å›¾ç‰‡å°ºå¯¸æ˜¯ä¸€ä¸ªæ€§èƒ½æ¶ˆè€—è¾ƒå¤§çš„æ“ä½œï¼Œå¦‚æœå›¾åƒåœ¨<code>UIScrollView</code>ä¸­ï¼Œåˆ™æ¶ˆè€—æ›´å¤§ã€‚å¦‚æœå›¾ç‰‡æ¥è‡ªç½‘ç»œä¸‹è½½ï¼Œé‚£ä¹ˆå°½é‡åšåˆ°ä¸‹è½½çš„å›¾ç‰‡ä¸è§†å›¾å°ºå¯¸åŒ¹é…ï¼Œæˆ–è€…å¯¹å›¾ç‰‡è¿›è¡Œé¢„å¤„ç†ï¼Œè°ƒæ•´å°ºå¯¸ã€‚</li>
<li>åœ¨éä¸»çº¿ç¨‹ä¸­è§£å‹JPG/PNGå›¾ç‰‡ï¼Œæœ€å¥½åœ¨ä¸€ä¸ªä¸“ç”¨é˜Ÿåˆ—ä¸­æ‰§è¡Œã€‚</li>
<li>åœ¨ä¸€äº›ç•Œé¢çš„å®ç°ä¸Šï¼Œç¡®å®šæ˜¯å¦çœŸçš„éœ€è¦å›¾ç‰‡ã€‚å¦‚å±•ç¤ºä¸€ä¸ªè¯„åˆ†æ§ä»¶<img src="http://owgqmweju.bkt.clouddn.com/17-10-20/33841778.jpg" alt="enter image description here">ï¼Œé‚£ä¹ˆæœ€å¥½é€šè¿‡ç›´æ¥ç»˜åˆ¶ï¼Œè°ƒæ•´é€æ˜åº¦æˆ–è¦†ç›–æ¥å®ç°ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¤šå¼ å›¾ç‰‡ã€‚ç±»ä¼¼æƒ…å†µçš„å–èˆæ—¢å¯ä»¥ä¼˜åŒ–æ€§èƒ½ï¼Œè¿˜èƒ½ç»™å®‰è£…åŒ…ç˜¦èº«ã€‚</li>
</ul>
<p>å…ˆæ€»ç»“åˆ°è¿™é‡Œï¼Œä¸‹ç¯‡æˆ‘ä¼šæ€»ç»“ä¸€äº›å…³äº<code>UITableView</code>ã€<code>WebView</code>å’Œè‡ªå®šä¹‰è§†å›¾çš„æ€§èƒ½ä¼˜åŒ–ç‚¹ï¼Œæ•¬è¯·æœŸå¾…ï¼</p>
]]></content>
      
        
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ä»¿Facebookç‚¹èµåŠ¨ç”»]]></title>
      <url>/2017/06/20/%E4%BB%BFFacebook%E7%82%B9%E8%B5%9E%E5%8A%A8%E7%94%BB/</url>
      <content type="html"><![CDATA[<p>ä¸€ä¸ªç®€å•çš„ç‚¹èµåŠ¨ç”»ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šå®ç°æ–¹å¼ï¼Œä½†è§‰å¾—ä¸å¯¹è·¯ï¼Œäºæ˜¯è‡ªå·±åŠ¨èµ·æ‰‹æ¥å†™äº†ä¸€ä¸ªï¼Œæ•ˆæœå¦‚å›¾ï¼š<br><img src="http://owgqmweju.bkt.clouddn.com/17-10-16/8652901.jpg" alt="å›¾1"></p>
<a id="more"></a>
<h3 id="æ‹†è§£åŠ¨ç”»"><a href="#æ‹†è§£åŠ¨ç”»" class="headerlink" title="æ‹†è§£åŠ¨ç”»"></a>æ‹†è§£åŠ¨ç”»</h3><p>æ— è®ºåŠ¨ç”»å¤šå¤æ‚ï¼ˆè™½ç„¶è¿™ä¸ªå¹¶ä¸å¤æ‚ğŸ˜‚ï¼‰ï¼Œæˆ‘ç›¸ä¿¡éƒ½æ˜¯ç”±è‹¥å¹²ç®€å•çš„åŠ¨ç”»ç»„æˆçš„ï¼Œä¸‹é¢æ¥æ‹†è§£ä¸€ä¸‹è¿™ä¸ªåŠ¨ç”»ï¼Œé€ä¸€å®ç°æ•ˆæœè‡ªç„¶å°±è¾¾åˆ°äº†~</p>
<ul>
<li>æŒ‰é’®ç¼©æ”¾åŠ¨ç”»</li>
<li>ç²’å­çˆ†ç‚¸åŠ¨ç”»</li>
</ul>
<h3 id="ç¼©æ”¾åŠ¨ç”»"><a href="#ç¼©æ”¾åŠ¨ç”»" class="headerlink" title="ç¼©æ”¾åŠ¨ç”»"></a>ç¼©æ”¾åŠ¨ç”»</h3><p>ç¼©æ”¾åŠ¨ç”»å®ç°èµ·æ¥å¾ˆç®€å•ï¼Œè¿™é‡Œç”¨åˆ°äº†å¸§åŠ¨ç”»ï¼Œç›´æ¥ä¸Šä»£ç ï¼Œä¸€ç›®äº†ç„¶~<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#pragma mark - Target Method</span></div><div class="line">- (<span class="keyword">void</span>)clickButtonAction &#123;</div><div class="line">    <span class="keyword">self</span>.selected = !<span class="keyword">self</span>.selected;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.selected) &#123;</div><div class="line">        [<span class="keyword">self</span> popOutside];</div><div class="line">        [_explodeView animate];</div><div class="line">    &#125;<span class="keyword">else</span> &#123;</div><div class="line">        [<span class="keyword">self</span> popInside];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - Animate Methods</span></div><div class="line">- (<span class="keyword">void</span>)popInside &#123;</div><div class="line">    <span class="keyword">self</span>.transform = <span class="built_in">CGAffineTransformIdentity</span>;</div><div class="line">    </div><div class="line">    [<span class="built_in">UIView</span> animateKeyframesWithDuration:<span class="number">.5</span>f delay:<span class="number">0</span> options:<span class="number">0</span> animations:^&#123;</div><div class="line">        </div><div class="line">        [<span class="built_in">UIView</span> addKeyframeWithRelativeStartTime:<span class="number">0</span></div><div class="line">                                relativeDuration:<span class="number">1</span> / <span class="number">2.</span>f</div><div class="line">                                      animations:^&#123;</div><div class="line">                                          <span class="keyword">self</span>.transform = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">.7</span>f, <span class="number">.7</span>f);</div><div class="line">                                      &#125;];</div><div class="line">        [<span class="built_in">UIView</span> addKeyframeWithRelativeStartTime:<span class="number">1</span> / <span class="number">2.</span>f</div><div class="line">                                relativeDuration:<span class="number">1</span> / <span class="number">2.</span>f</div><div class="line">                                      animations:^&#123;</div><div class="line">                                          <span class="keyword">self</span>.transform = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">1.</span>f, <span class="number">1.</span>f);</div><div class="line">                                      &#125;];</div><div class="line">    &#125; completion:<span class="literal">nil</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)popOutside &#123;</div><div class="line">    <span class="keyword">self</span>.transform = <span class="built_in">CGAffineTransformIdentity</span>;</div><div class="line">    </div><div class="line">    [<span class="built_in">UIView</span> animateKeyframesWithDuration:<span class="number">.5</span>f delay:<span class="number">0</span> options: <span class="built_in">UIViewKeyframeAnimationOptionCalculationModeCubicPaced</span> animations: ^&#123;</div><div class="line">        </div><div class="line">        [<span class="built_in">UIView</span> addKeyframeWithRelativeStartTime:<span class="number">0</span></div><div class="line">                                relativeDuration:<span class="number">1</span> / <span class="number">3.</span>f</div><div class="line">                                      animations:^&#123;</div><div class="line">                                          <span class="keyword">self</span>.transform = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">1.5</span>f, <span class="number">1.5</span>f);</div><div class="line">                                      &#125;];</div><div class="line">        [<span class="built_in">UIView</span> addKeyframeWithRelativeStartTime:<span class="number">1</span> / <span class="number">3.</span>f</div><div class="line">                                relativeDuration:<span class="number">1</span> / <span class="number">3.</span>f</div><div class="line">                                      animations:^&#123;</div><div class="line">                                          <span class="keyword">self</span>.transform = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">.8</span>f, <span class="number">.8</span>f);</div><div class="line">                                      &#125;];</div><div class="line">        [<span class="built_in">UIView</span> addKeyframeWithRelativeStartTime:<span class="number">2</span> / <span class="number">3.</span>f</div><div class="line">                                relativeDuration:<span class="number">1</span> / <span class="number">3.</span>f</div><div class="line">                                      animations:^&#123;</div><div class="line">                                          <span class="keyword">self</span>.transform = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">1.</span>f, <span class="number">1.</span>f);</div><div class="line">                                      &#125;];</div><div class="line">    &#125; completion:<span class="literal">nil</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="ç²’å­åŠ¨ç”»"><a href="#ç²’å­åŠ¨ç”»" class="headerlink" title="ç²’å­åŠ¨ç”»"></a>ç²’å­åŠ¨ç”»</h3><p>è¿™ä¸ªçˆ†ç‚¸æ•ˆæœæ˜¯ä¸æ˜¯çœ‹èµ·æ¥å¾ˆçœ¼ç†Ÿï¼Ÿæ²¡é”™å…¶å®å®ƒè·ŸçƒŸèŠ±ã€ä¸‹é›ªçš„åŠ¨ç”»å®ç°æ˜¯ä¸€æ ·çš„ï¼Œéƒ½ç”¨åˆ°äº†<code>CALayer</code>çš„ä¸€ä¸ªé«˜æ€§èƒ½åŸç”Ÿç²’å­å¼•æ“<a href="https://developer.apple.com/documentation/quartzcore/caemitterlayer" target="_blank" rel="external">CAEmitterLayer</a>ã€‚<br>ç®€å•ä»‹ç»ä¸€ä¸‹<code>CAEmitterLayer</code>ï¼Œ<code>CAEmitterLayer</code>ç›¸å½“äº<code>CAEmitterCell</code>çš„å®¹å™¨ï¼Œæ¯ä¸€ä¸ªcellç›¸å½“äºä¸€ä¸ªç²’å­ï¼Œæˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ª<code>CAEmitterCell</code>ç²’å­æ•ˆæœæ¥ä½œä¸ºç²’å­æ ·å¼æ¨¡æ¿ï¼Œæ¯”å¦‚ç²’å­çš„å›¾ç‰‡ã€ç”Ÿæˆç‡ã€ç”Ÿå‘½å‘¨æœŸç­‰å‚æ•°ï¼Œ<code>CAEmitterLayer</code>ä¼šåŸºäºæ¨¡æ¿å®ä¾‹åŒ–è¯¥æ ·å¼çš„ç²’å­æµï¼Œæ ¹æ®è®¾ç½®å¥½çš„å‘å°„ä½ç½®ã€å‘å°„æ¨¡å¼ã€å½¢çŠ¶ä½¿ä»–ä»¬åŠ¨èµ·æ¥ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setupEmitterLayer &#123;</div><div class="line">    <span class="keyword">self</span>.clipsToBounds = <span class="literal">NO</span>;</div><div class="line">    <span class="keyword">self</span>.userInteractionEnabled = <span class="literal">NO</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//åˆ›å»ºç²’å­</span></div><div class="line">    <span class="built_in">CAEmitterCell</span> *emitter = [<span class="built_in">CAEmitterCell</span> emitterCell];</div><div class="line">    emitter.contents        = (<span class="keyword">id</span>)[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"like_dot"</span>].CGImage;</div><div class="line">    emitter.name            = <span class="string">@"emitterCell"</span>;</div><div class="line">    emitter.birthRate       = <span class="number">0</span>;</div><div class="line">    emitter.lifetime        = <span class="number">.7</span>f;</div><div class="line">    emitter.lifetimeRange   = <span class="number">.3</span>f;</div><div class="line">    emitter.alphaRange      = <span class="number">.2</span>f;</div><div class="line">    emitter.alphaSpeed      = <span class="number">-1.</span>f;</div><div class="line">    emitter.velocity        = <span class="number">40.</span>f;</div><div class="line">    emitter.velocityRange   = <span class="number">10.</span>f;</div><div class="line">    emitter.emissionRange   = M_PI_4;</div><div class="line">    emitter.scale           = <span class="number">.05</span>f;</div><div class="line">    emitter.scaleRange      = <span class="number">.02</span>f;</div><div class="line">    </div><div class="line">    <span class="comment">//åˆ›å»ºç²’å­å›¾å±‚</span></div><div class="line">    _emitterLayer = [<span class="built_in">CAEmitterLayer</span> layer];</div><div class="line">    _emitterLayer.name              = <span class="string">@"emitterLayer"</span>;</div><div class="line">    _emitterLayer.frame             = <span class="keyword">self</span>.bounds;</div><div class="line">    _emitterLayer.emitterShape      = kCAEmitterLayerCircle;</div><div class="line">    _emitterLayer.emitterMode       = kCAEmitterLayerOutline;</div><div class="line">    _emitterLayer.emitterPosition   = <span class="keyword">self</span>.center;</div><div class="line">    _emitterLayer.emitterSize       = <span class="built_in">CGSizeMake</span>(<span class="number">25</span>, <span class="number">0</span>);</div><div class="line">    _emitterLayer.renderMode        = kCAEmitterLayerOldestFirst;</div><div class="line">    _emitterLayer.masksToBounds     = <span class="literal">NO</span>;</div><div class="line">    _emitterLayer.emitterCells      = @[emitter];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span>.layer addSublayer: _emitterLayer];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - Public Methods</span></div><div class="line">- (<span class="keyword">void</span>)animate &#123;</div><div class="line">    [_emitterLayer removeAnimationForKey:<span class="string">@"likeAnimation"</span>];</div><div class="line">    dispatch_time_t delay = dispatch_time(DISPATCH_TIME_NOW, <span class="number">.2</span>f * <span class="built_in">NSEC_PER_SEC</span>);</div><div class="line">    dispatch_after(delay, dispatch_get_main_queue(), ^&#123;</div><div class="line">        <span class="keyword">self</span>.emitterLayer.beginTime = <span class="built_in">CACurrentMediaTime</span>();</div><div class="line">        <span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath: <span class="string">@"emitterCells.emitterCell.birthRate"</span>];</div><div class="line">        animation.fromValue = @<span class="number">0</span>;</div><div class="line">        animation.toValue = @<span class="number">600</span>;</div><div class="line">        [_emitterLayer addAnimation:animation forKey:<span class="string">@"likeAnimation"</span>];</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æå®šï¼å¦‚æœå¯¹å¸§åŠ¨ç”»å’Œç²’å­åŠ¨ç”»æœ‰ç–‘é—®å¯ä»¥çœ‹ä¸‹é¢ä¸¤ç¯‡æ–‡ç« ï¼š<br><a href="http://www.jianshu.com/p/a071bba99a1b" target="_blank" rel="external">Transformå’ŒKeyFrameåŠ¨ç”»</a><br><a href="https://segmentfault.com/a/1190000008580771" target="_blank" rel="external">CAEmitterLayerå’ŒCAEmitterCellçš„åŸºæœ¬ç”¨æ³•</a></p>
<p>demoåœ°å€ï¼š<a href="https://github.com/zhangMax/WZLikeButton" target="_blank" rel="external">WZLikeButton</a></p>
]]></content>
      
        
        <tags>
            
            <tag> animation </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Stay hungry, Stay foolish.]]></title>
      <url>/2017/06/13/Stay-hungry-Stay-foolish/</url>
      <content type="html"><![CDATA[<p>åšäº†ä¸€å¹´å¤šiOSå¼€å‘çš„èœé¸Ÿä¸€åªï¼Œå¹³æ—¶å–œæ¬¢çœ‹å„ç§å¤§ä½¬çš„åšå®¢ï¼Œè·ç›Šè‰¯å¤šï¼Œä½†éšç€å¹´é¾„çš„å¢é•¿ï¼Œè®°æ€§è¶Šæ¥è¶Šå·®â€¦çœ‹è¿‡çš„ä¸œè¥¿å¦‚æœä¸è®°åœ¨å°æœ¬æœ¬ä¸Šï¼Œæ€•ä¸æ˜¯è¦å¿˜å…‰â€¦æ‰€ä»¥å¼„äº†ä¸ªåšå®¢ï¼Œè®°å½•å¹³æ—¶å·¥ä½œä¸­é‡åˆ°çš„å‘ï¼Œä»¥åŠæ‹œè¯»å¤§ä½¬åšå®¢çš„ä¸€äº›â€˜â€˜é¢†æ‚Ÿâ€™â€™ï¼Œå¸Œæœ›è‡ªå·±èƒ½åšæŒä¸‹å»ï¼Œä¹Ÿå¸Œæœ›èƒ½ç»™å¤§å®¶å¸¦æ¥ä¸€äº›å¸®åŠ©ã€‚</p>
]]></content>
      
        
        <tags>
            
            <tag> iOS </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
